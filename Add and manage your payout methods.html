<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crowd Help Center - Add and manage your payout methods</title>
    <script src="js/auth-api.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }

        .header {
            background: white;
            border-bottom: 1px solid #e6e6e6;
            padding: 12px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: bold;
            font-size: 18px;
        }

        .help-center-text {
            font-size: 18px;
            color: #333;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding: 10px 16px 10px 40px;
            border: 1px solid #ddd;
            border-radius: 6px;
            width: 300px;
            font-size: 14px;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }

        /* Authentication Elements */
        .auth-section {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #ff6b35;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .login-btn {
            background: #ff6b35;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: none;
        }

        .login-btn:hover {
            background: #e55a2b;
        }

        .user-profile {
            display: none;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            position: relative;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .user-profile:hover {
            background-color: #f5f5f5;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #ff6b35;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }

        .user-name {
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }

        .user-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #e6e6e6;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            min-width: 160px;
            z-index: 1000;
        }

        .user-dropdown.show {
            display: block;
        }

        .dropdown-item {
            padding: 10px 15px;
            cursor: pointer;
            font-size: 14px;
            color: #333;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
        }

        .dropdown-item:last-child {
            border-bottom: none;
            color: #ff6b35;
        }

        .dropdown-item:hover {
            background: #f5f5f5;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .breadcrumb {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px 24px 0;
        }

        .breadcrumb a {
            color: #6c5ce7;
            text-decoration: none;
            font-size: 14px;
        }

        .breadcrumb span {
            color: #666;
            margin: 0 8px;
        }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 40px;
            padding: 20px 24px;
        }

        .content {
            background: white;
            padding: 32px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .sidebar {
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }

        .category-tag {
            background: #f1f3f4;
            color: #666;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            margin-bottom: 16px;
            display: inline-block;
        }

        h1 {
            font-size: 32px;
            margin-bottom: 24px;
            color: #1a1a1a;
            line-height: 1.2;
        }

        .intro-text {
            color: #666;
            margin-bottom: 32px;
            font-size: 16px;
        }

        .toc {
            margin-bottom: 32px;
        }

        .toc h3 {
            font-size: 16px;
            margin-bottom: 16px;
            color: #333;
        }

        .toc ul {
            list-style: none;
        }

        .toc li {
            margin-bottom: 8px;
        }

        .toc a {
            color: #6c5ce7;
            text-decoration: none;
            font-size: 14px;
        }

        .toc a:hover {
            text-decoration: underline;
        }

        .section {
            margin-bottom: 48px;
        }

        .section h2 {
            font-size: 24px;
            margin-bottom: 16px;
            color: #1a1a1a;
        }

        .section h3 {
            font-size: 20px;
            margin-bottom: 16px;
            color: #1a1a1a;
        }

        .section p {
            margin-bottom: 16px;
            color: #666;
            font-size: 16px;
        }

        .info-box {
            background: #f8f9ff;
            border: 1px solid #e0e8ff;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            display: flex;
            gap: 16px;
        }

        .info-box.warning {
            background: #fff8f0;
            border-color: #ffd6b3;
        }

        .info-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #6c5ce7;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }

        .info-icon.warning {
            background: #ff6b35;
        }

        .steps {
            margin: 20px 0;
        }

        .steps ol {
            padding-left: 20px;
        }

        .steps li {
            margin-bottom: 12px;
            color: #666;
            font-size: 16px;
        }

        .steps strong {
            color: #333;
        }

        .bullet-list {
            margin: 16px 0;
        }

        .bullet-list ul {
            padding-left: 20px;
        }

        .bullet-list li {
            margin-bottom: 8px;
            color: #666;
        }

        .sidebar h3 {
            font-size: 18px;
            margin-bottom: 16px;
            color: #333;
        }

        .event-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .event-image {
            width: 100%;
            height: 150px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }

        .event-info {
            padding: 16px;
        }

        .event-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .event-date {
            color: #666;
            font-size: 14px;
            margin-bottom: 12px;
        }

        .manage-btn {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            font-size: 14px;
        }

        .manage-btn:hover {
            background: #e55a2b;
        }

        .manage-events-link {
            color: #6c5ce7;
            text-decoration: none;
            font-size: 14px;
            display: block;
            text-align: center;
            margin-top: 12px;
        }

        .related-articles {
            margin-top: 40px;
        }

        .related-articles h3 {
            font-size: 20px;
            margin-bottom: 16px;
        }

        .related-articles ul {
            list-style: none;
        }

        .related-articles li {
            margin-bottom: 8px;
        }

        .related-articles a {
            color: #6c5ce7;
            text-decoration: none;
            font-size: 14px;
        }

        .contact-section {
            background: white;
            text-align: center;
            padding: 60px 24px;
            margin-top: 40px;
        }

        .contact-section h2 {
            font-size: 28px;
            margin-bottom: 20px;
            color: #333;
        }

        .contact-btn {
            background: #ff6b35;
            color: white;
            padding: 12px 32px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }

        .contact-btn:hover {
            background: #e55a2b;
        }

        .footer {
            background: #2d1b69;
            color: white;
            padding: 40px 0;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 40px;
            padding: 0 24px;
        }

        .footer-section h4 {
            margin-bottom: 16px;
            font-size: 16px;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section li {
            margin-bottom: 8px;
        }

        .footer-section a {
            color: #ccc;
            text-decoration: none;
            font-size: 14px;
        }

        .footer-section a:hover {
            color: white;
        }

        .footer-bottom {
            border-top: 1px solid #4a3a7a;
            margin-top: 32px;
            padding-top: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .footer-links {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .footer-links a {
            color: #ccc;
            text-decoration: none;
            font-size: 12px;
        }

        .country-selector {
            background: transparent;
            border: 1px solid #666;
            color: white;
            padding: 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        .ask-question-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #ff6b35;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .header-content {
                flex-direction: column;
                gap: 16px;
            }

            .search-box input {
                width: 250px;
            }

            .footer-content {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo">crowd</div>
                <span class="help-center-text">Help Center</span>
            </div>
            <div class="header-right">
                <div class="search-box">
                    <span class="search-icon">🔍</span>
                    <input type="text" placeholder="Search help articles">
                </div>
                <div class="auth-section">
                    <!-- Loading Spinner -->
                    <div id="authLoading" class="loading-spinner"></div>

                    <!-- Login Button -->
                    <button class="login-btn" id="loginBtn" onclick="handleLogin()">
                        Log In
                    </button>

                    <!-- User Profile -->
                    <div id="userProfile" class="user-profile" onclick="toggleUserDropdown()">
                        <div id="userAvatar" class="user-avatar">
                            <span id="userInitials">U</span>
                        </div>
                        <span id="userName">User</span>
                        <span>▾</span>

                        <div id="userDropdown" class="user-dropdown">
                            <div class="dropdown-item" onclick="viewProfile()">View Profile</div>
                            <div class="dropdown-item" onclick="accountSettings()">Account Settings</div>
                            <div class="dropdown-item" onclick="organizerDashboard()">Organizer Dashboard</div>
                            <div class="dropdown-item" onclick="handleLogout()">Logout</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="breadcrumb">
        <a href="../Help_center.html" id="helpCenterLink">Help Center</a>
        <span>></span>
        <a href="#">Payouts and taxes</a>
    </div>

    <div class="main-container">
        <main class="content">
            <span class="category-tag">Organizing an event</span>

            <h1>Add and manage your payout methods</h1>

            <p class="intro-text">
                When you host a paid event on Crowd, you need to set up a payout method in order to get paid. To add a
                bank account, go to your Finance workspace. By default, your payout will start processing three days
                after your event ends.
            </p>

            <div class="toc">
                <h3>In this article</h3>
                <ul>
                    <li><a href="#add-payout-method">Add a payout method to your account</a></li>
                    <li><a href="#specific-event">Add a payout method for a specific event</a></li>
                    <li><a href="#delete-unused">Delete unused payout methods</a></li>
                </ul>
            </div>

            <section class="section" id="add-payout-method">
                <h2>Add a payout method to your account</h2>
                <p>You need to add a payout method to your Crowd account before you can receive your event funds. Once
                    added, payout methods can't be edited; if you need to make changes, add a new bank account instead.
                </p>

                <p>For security reasons, you may be asked to re-enter your current payout details when adding a new
                    account.</p>

                <div class="info-box">
                    <div class="info-icon">ℹ️</div>
                    <div>
                        <p>If your bank is located in Australia, Canada, the United Kingdom, or the United States,
                            you'll be required to <a href="#">verify your financial information</a> before you can
                            receive a payout.</p>
                    </div>
                </div>

                <p>To add a payout method:</p>

                <div class="steps">
                    <ol>
                        <li>Go to <strong>Finance</strong> and select <strong>Settings</strong>.</li>
                        <li>Select <strong>Add bank account</strong>.</li>
                        <li>Fill out your bank details. For security reasons, you can't use a P.O. box as your mailing
                            address.</li>
                        <li>(Optional) If you use the same bank account for all of your events, check the box next to
                            "Set bank account as the default for all my events." If you only want to apply this payout
                            method to specific events, leave the box unchecked.</li>
                        <li>Select <strong>Add</strong> to complete the process.</li>
                    </ol>
                </div>

                <p>If you choose to add your payout method as the default, it won't apply to:</p>

                <div class="bullet-list">
                    <ul>
                        <li>Events that ended over 60 days ago</li>
                        <li>Events that already have a payout method selected</li>
                        <li>Events that use a different combination of payout country and currency</li>
                    </ul>
                </div>

                <div class="info-box warning">
                    <div class="info-icon warning">⚠️</div>
                    <div>
                        <p>If you're expecting a payout that hasn't been sent, go to <strong>Payment options</strong> on
                            the event and confirm that the correct payout method is selected.</p>
                    </div>
                </div>
            </section>

            <section class="section" id="specific-event">
                <h2>Add a payout method for a specific event</h2>
                <p>If you only want to apply a payout method to specific events or want to confirm that a payout method
                    has been selected:</p>

                <div class="steps">
                    <ol>
                        <li>Go to <strong>Manage my events</strong> and select your event.</li>
                        <li>Go to <strong>Payments & tax</strong>.</li>
                        <li>Select <strong>Payment options</strong>.</li>
                        <li>Select <strong>Manage payout method</strong>.</li>
                        <li>Choose a payout method or select <strong>Add bank account</strong>.</li>
                    </ol>
                </div>

                <p>You can only choose a payout method that matches the combination of payout country and currency
                    you've set for your event.</p>
            </section>

            <section class="section" id="delete-unused">
                <h2>Delete unused payout methods</h2>
                <p>You can only delete bank accounts that aren't tied to live events, draft events, or completed events
                    with pending payouts. If the bank account you want to delete is set as the default for all events,
                    add a new default payout method first.</p>

                <div class="steps">
                    <ol>
                        <li>Go to <strong>Finance</strong> and select <strong>Settings</strong>.</li>
                        <li>Select <strong>Bank accounts</strong>.</li>
                        <li>Select the three-dot menu next to the bank account you want to remove, then select
                            <strong>Delete</strong>.</li>
                    </ol>
                </div>

                <p>If you can't delete a payout method, you'll need to remove it from any live events, draft events, or
                    completed events with a pending payout:</p>

                <div class="steps">
                    <ol>
                        <li>Select the three-dot menu next to the payout method.</li>
                        <li>Select <strong>View events</strong>.</li>
                        <li>Select <strong>Manage</strong>.</li>
                        <li>On the Event dashboard, select <strong>Manage account</strong> and update the payout method.
                        </li>
                    </ol>
                </div>

                <p>Once the original payout method is no longer associated with these events, you can delete it.</p>
            </section>

            <div class="related-articles">
                <h3>Related articles</h3>
                <ul>
                    <li><a href="#">Verify your financial information through Stripe</a></li>
                    <li><a href="#">Set up a payout schedule</a></li>
                    <li><a href="#">Troubleshoot delayed or missing payouts</a></li>
                </ul>
            </div>
        </main>

        <aside class="sidebar">
            <h3>My events</h3>
            <div class="event-card">
                <div class="event-image">
                    <span>Event Image</span>
                </div>
                <div class="event-info">
                    <div class="event-title">dummy event</div>
                    <div class="event-date">Sun, Sep 14 • 10:00 AM</div>
                    <button class="manage-btn">Manage event</button>
                </div>
            </div>
            <a href="#" class="manage-events-link">Manage my events</a>
        </aside>
    </div>

    <div class="contact-section">
        <h2>Still have questions?</h2>
        <a href="#" class="contact-btn">Contact us</a>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>Use Crowd</h4>
                <ul>
                    <li><a href="#">Create events</a></li>
                    <li><a href="#">Community Guidelines</a></li>
                    <li><a href="#">Pricing</a></li>
                    <li><a href="#">Pricing Calculator</a></li>
                    <li><a href="#">Site status</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Download apps</h4>
                <ul>
                    <li><a href="#">Crowd app for Android</a></li>
                    <li><a href="#">Crowd app for iOS</a></li>
                    <li><a href="#">Crowd Organizer app</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Browse resources</h4>
                <ul>
                    <li><a href="#">Organizer Resource Hub</a></li>
                    <li><a href="#">Reconvene virtual sessions for organizers</a></li>
                    <li><a href="#">Taxes</a></li>
                    <li><a href="#">Webinars for new organizers</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Connect with us</h4>
                <ul>
                    <li><a href="#">Contact support</a></li>
                    <li><a href="#">Facebook</a></li>
                    <li><a href="#">Instagram</a></li>
                    <li><a href="#">X</a></li>
                    <li><a href="#">TikTok</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-content">
            <div class="footer-bottom">
                <div>© 2025 Crowd</div>
                <div class="footer-links">
                    <a href="#">About</a>
                    <a href="#">Blog</a>
                    <a href="#">Help</a>
                    <a href="#">Careers</a>
                    <a href="#">Press</a>
                    <a href="#">Security</a>
                    <a href="#">Developers</a>
                    <a href="#">Terms</a>
                    <a href="#">Privacy</a>
                    <a href="#">Accessibility</a>
                    <a href="#">Cookies</a>
                    <a href="#">Manage Cookie Preferences</a>
                </div>
                <select class="country-selector">
                    <option>United States</option>
                    <option>Canada</option>
                    <option>United Kingdom</option>
                    <option>Australia</option>
                </select>
            </div>
        </div>
    </footer>

    <button class="ask-question-btn">
        💬 Ask a question
    </button>

    <script>
        // Authentication state management
        let isAuthenticated = false;
        let currentUser = null;

        // Initialize auth check on page load
        document.addEventListener('DOMContentLoaded', function () {
            // Check for token in URL parameters (from redirect)
            handleTokenFromURL();
            
            // Check for immediate auth state from localStorage first
            checkLocalAuthState();
            
            // Then check with backend
            checkAuthStatus();

            // Close dropdown when clicking outside
            document.addEventListener('click', function (event) {
                const userProfile = document.getElementById('userProfile');
                const userDropdown = document.getElementById('userDropdown');

                if (!userProfile.contains(event.target) && !userDropdown.contains(event.target)) {
                    userDropdown.classList.remove('show');
                }
            });
        });

        // Check authentication status
        async function checkAuthStatus() {
            try {
                showLoadingSpinner();

                // Get token from localStorage (check both possible keys)
                const token = localStorage.getItem('token') || localStorage.getItem('authToken');
                
                const headers = {
                    'Content-Type': 'application/json'
                };
                
                // Add Authorization header if token exists
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }

                const response = await fetch('/api/auth/check', {
                    method: 'GET',
                    credentials: 'include',
                    headers: headers
                });

                if (response.ok) {
                    const userData = await response.json();
                    if (userData.isAuthenticated && userData.user) {
                        // Store user data in localStorage for faster loading next time
                        localStorage.setItem('currentUser', JSON.stringify(userData.user));
                        setAuthenticatedState(userData.user);
                    } else {
                        clearAuthData();
                        setUnauthenticatedState();
                    }
                } else {
                    clearAuthData();
                    setUnauthenticatedState();
                }
            } catch (error) {
                console.error('Auth check failed:', error);
                // Only clear auth data if we had a token but it failed
                const token = localStorage.getItem('token') || localStorage.getItem('authToken');
                if (token) {
                    clearAuthData();
                }
                setUnauthenticatedState();
            }
        }

        // Set authenticated state
        function setAuthenticatedState(user) {
            isAuthenticated = true;
            currentUser = user;

            document.getElementById('authLoading').style.display = 'none';
            document.getElementById('loginBtn').style.display = 'none';
            document.getElementById('userProfile').style.display = 'flex';

            // Update user information using proper user data structure
            const displayName = user.firstName && user.lastName 
                ? `${user.firstName} ${user.lastName}` 
                : user.firstName || user.lastName || user.email || 'User';
            
            document.getElementById('userName').textContent = displayName;

            const initials = generateInitials(displayName);
            document.getElementById('userInitials').textContent = initials;

            const avatarColor = generateAvatarColor(user._id || user.email);
            document.getElementById('userAvatar').style.backgroundColor = avatarColor;
        }

        // Set unauthenticated state
        function setUnauthenticatedState() {
            isAuthenticated = false;
            currentUser = null;

            document.getElementById('authLoading').style.display = 'none';
            document.getElementById('userProfile').style.display = 'none';
            document.getElementById('loginBtn').style.display = 'block';
        }

        // Show loading spinner
        function showLoadingSpinner() {
            document.getElementById('authLoading').style.display = 'block';
            document.getElementById('loginBtn').style.display = 'none';
            document.getElementById('userProfile').style.display = 'none';
        }

        // Generate initials from name
        function generateInitials(name) {
            if (!name) return 'U';

            const words = name.trim().split(' ');
            if (words.length === 1) {
                return words[0].charAt(0).toUpperCase();
            } else {
                return (words[0].charAt(0) + words[words.length - 1].charAt(0)).toUpperCase();
            }
        }

        // Generate avatar color based on user identifier
        function generateAvatarColor(identifier) {
            const colors = [
                '#ff6b35', '#6c5ce7', '#00b894', '#fdcb6e',
                '#e17055', '#a29bfe', '#00cec9', '#e84393',
                '#2d3436', '#636e72', '#fd79a8', '#0984e3'
            ];

            if (!identifier) return colors[0];

            let hash = 0;
            for (let i = 0; i < identifier.length; i++) {
                hash = identifier.charCodeAt(i) + ((hash << 5) - hash);
            }

            return colors[Math.abs(hash) % colors.length];
        }

        // Clear all authentication data
        function clearAuthData() {
            localStorage.removeItem('token');
            localStorage.removeItem('authToken');
            localStorage.removeItem('currentUser');
        }
        
        // Check local authentication state for immediate UI update
        function checkLocalAuthState() {
            const token = localStorage.getItem('token') || localStorage.getItem('authToken');
            const userStr = localStorage.getItem('currentUser');
            
            if (token && userStr) {
                try {
                    const user = JSON.parse(userStr);
                    // Set UI immediately based on local storage
                    setAuthenticatedState(user);
                    console.log('Local auth state loaded:', user.email || user.name);
                } catch (error) {
                    console.error('Error parsing stored user data:', error);
                    clearAuthData();
                }
            } else {
                setUnauthenticatedState();
            }
        }
        
        // Handle token from URL parameters (e.g., from OAuth redirect)
        function handleTokenFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            
            if (token) {
                localStorage.setItem('token', token);
                // Remove token from URL for security
                window.history.replaceState({}, document.title, window.location.pathname);
                console.log('Token received from URL and stored');
            }
        }

        // Handle login button click
        async function handleLogin() {
            try {
                window.location.href = 'login.html';
            } catch (error) {
                console.error('Login error:', error);
                alert('Login failed. Please try again.');
            }
        }

        // Handle logout
        async function handleLogout() {
            try {
                const token = localStorage.getItem('token') || localStorage.getItem('authToken');
                const headers = {
                    'Content-Type': 'application/json'
                };
                
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }

                const response = await fetch('/api/auth/logout', {
                    method: 'POST',
                    credentials: 'include',
                    headers: headers
                });

                // Always clear token from localStorage on logout
                clearAuthData();
                setUnauthenticatedState();
                
                // Redirect to home page
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Logout error:', error);
                // Force logout on client side even if server request fails
                clearAuthData();
                setUnauthenticatedState();
                window.location.href = 'index.html';
            }

            document.getElementById('userDropdown').classList.remove('show');
        }

        // Toggle user dropdown menu
        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }

        // User profile actions
        function viewProfile() {
            console.log('View profile clicked');
            window.location.href = '/profile';
            document.getElementById('userDropdown').classList.remove('show');
        }

        function accountSettings() {
            console.log('Account settings clicked');
            window.location.href = '/settings';
            document.getElementById('userDropdown').classList.remove('show');
        }

        function organizerDashboard() {
            console.log('Organizer dashboard clicked');
            window.location.href = '/organizer';
            document.getElementById('userDropdown').classList.remove('show');
        }

        // Optional: Refresh auth status periodically
        setInterval(checkAuthStatus, 5 * 60 * 1000);
    </script>
</body>

</html>