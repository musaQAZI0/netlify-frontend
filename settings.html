<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Organization Settings - Crowd</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #f8f9fa;
      color: #333;
      overflow-x: hidden;
    }

    .dashboard-container {
      display: flex;
      min-height: 100vh;
      width: 100%;
    }

    /* Sidebar */
    .sidebar {
      width: 72px;
      background: white;
      border-right: 1px solid #dbdae3;
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px 0;
      z-index: 100;
    }

    .sidebar-logo {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 30px;
      color: #f05537;
      font-weight: 900;
      font-size: 20px;
      cursor: pointer;
    }

    .sidebar-nav {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
      width: 100%;
      padding: 0 12px;
    }

    .sidebar-item {
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      background: transparent;
      border: none;
      text-decoration: none;
    }

    .sidebar-item:hover {
      background: #f8f7fa;
    }

    .sidebar-item.active {
      background: #3659e3;
      color: white;
    }

    .sidebar-item svg {
      width: 24px;
      height: 24px;
      color: #6f7287;
    }

    .sidebar-item.active svg {
      color: white;
    }

    .sidebar-bottom {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 0 12px;
      width: 100%;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: 72px;
      display: flex;
      flex-direction: column;
      width: calc(100% - 72px);
      max-width: calc(100vw - 72px);
    }

    /* Header */
    .header {
      background: white;
      border-bottom: 1px solid #e5e5e5;
      padding: 12px 24px;
      position: sticky;
      top: 0;
      z-index: 50;
      width: 100%;
      box-sizing: border-box;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }

    .header-left .logo {
      display: none;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 16px;
      flex-shrink: 0;
    }

    .create-btn {
      background: #ff5722;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      white-space: nowrap;
    }

    .create-btn:hover {
      background: #e64a19;
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      padding: 4px;
      border-radius: 6px;
      transition: background 0.2s;
      flex-shrink: 0;
    }

    .user-menu:hover {
      background: #f8f9fa;
    }

    .user-avatar {
      width: 32px;
      height: 32px;
      background: #ff5722;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 12px;
      flex-shrink: 0;
    }

    .user-name {
      font-weight: 500;
      font-size: 14px;
      white-space: nowrap;
    }

    /* Page Content */
    .page-content {
      flex: 1;
      padding: 32px 24px;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
      box-sizing: border-box;
    }

    .page-header {
      margin-bottom: 32px;
    }

    .username {
      font-size: 14px;
      color: #666;
      font-weight: 500;
      margin-bottom: 8px;
      letter-spacing: 0.5px;
    }

    .page-header h1 {
      font-size: 48px;
      font-weight: bold;
      color: #1a1a1a;
      margin: 0;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 32px;
      border-bottom: 1px solid #e5e5e5;
      margin-bottom: 40px;
      overflow-x: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .tabs::-webkit-scrollbar {
      display: none;
    }

    .tab {
      background: none;
      border: none;
      padding: 16px 0;
      font-size: 16px;
      font-weight: 500;
      color: #666;
      cursor: pointer;
      position: relative;
      transition: color 0.2s;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .tab:hover {
      color: #333;
    }

    .tab.active {
      color: #1d4fd8;
    }

    .tab.active::after {
      content: "";
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 2px;
      background: #1d4fd8;
    }

    /* Tab Content */
    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Sections */
    .section {
      margin-bottom: 48px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      flex-wrap: wrap;
      gap: 12px;
    }

    .section h2 {
      font-size: 24px;
      font-weight: bold;
      color: #1a1a1a;
      margin-bottom: 8px;
    }

    .section-description {
      color: #666;
      line-height: 1.5;
      margin-bottom: 24px;
    }

    .learn-more {
      color: #1d4fd8;
      text-decoration: none;
    }

    .learn-more:hover {
      text-decoration: underline;
    }

    .add-profile-btn {
      background: white;
      border: 1px solid #d1d5db;
      padding: 8px 16px;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      color: #374151;
      white-space: nowrap;
    }

    .add-profile-btn:hover {
      background: #f9fafb;
    }

    .primary-btn {
      background: #ff5722;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      white-space: nowrap;
    }

    .primary-btn:hover {
      background: #e64a19;
    }

    .secondary-btn {
      background: white;
      border: 1px solid #d1d5db;
      padding: 12px 24px;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      color: #374151;
      white-space: nowrap;
    }

    .secondary-btn:hover {
      background: #f9fafb;
    }

    /* Profile Card */
    .profile-card {
      background: white;
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
      flex-wrap: wrap;
      gap: 16px;
    }

    .profile-info {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
      min-width: 200px;
    }

    .profile-avatar {
      width: 40px;
      height: 40px;
      background: #f3f4f6;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #9ca3af;
      flex-shrink: 0;
    }

    .profile-name {
      font-weight: 500;
      color: #374151;
    }

    .profile-actions {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }

    .edit-btn {
      background: #ff5722;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      white-space: nowrap;
    }

    .edit-btn:hover {
      background: #e64a19;
    }

    .more-btn {
      background: none;
      border: none;
      padding: 8px;
      border-radius: 4px;
      cursor: pointer;
      color: #666;
      flex-shrink: 0;
    }

    .more-btn:hover {
      background: #f3f4f6;
    }

    /* Upload Section */
    .upload-section {
      margin-bottom: 24px;
    }

    .upload-area {
      border: 2px dashed #d1d5db;
      border-radius: 8px;
      padding: 40px;
      text-align: center;
      cursor: pointer;
      transition: border-color 0.2s;
      background: #f9fafb;
    }

    .upload-area:hover {
      border-color: #9ca3af;
    }

    .upload-icon {
      margin-bottom: 16px;
      color: #9ca3af;
    }

    .upload-title {
      font-weight: 500;
      color: #374151;
      margin-bottom: 4px;
    }

    .upload-subtitle {
      font-size: 14px;
      color: #6b7280;
    }

    /* Form Elements */
    .form-group {
      margin-bottom: 24px;
    }

    .form-group label {
      display: block;
      font-weight: 500;
      color: #374151;
      margin-bottom: 6px;
    }

    .form-input {
      width: 100%;
      padding: 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 16px;
      transition: border-color 0.2s;
      box-sizing: border-box;
    }

    .form-input:focus {
      outline: none;
      border-color: #1d4fd8;
      box-shadow: 0 0 0 3px rgba(29, 79, 216, 0.1);
    }

    .form-select {
      width: 100%;
      padding: 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 16px;
      background: white;
      cursor: pointer;
      box-sizing: border-box;
    }

    .char-count {
      text-align: right;
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }

    /* Team Management */
    .team-section {
      background: white;
      border-radius: 8px;
      border: 1px solid #e5e5e5;
      overflow: hidden;
    }

    .team-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 24px;
      border-bottom: 1px solid #e5e5e5;
      flex-wrap: wrap;
      gap: 16px;
    }

    .team-header h2 {
      margin: 0;
      font-size: 24px;
      font-weight: bold;
      color: #1a1a1a;
    }

    .create-role-btn {
      background: #f05537;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      white-space: nowrap;
    }

    .create-role-btn:hover {
      background: #e04527;
    }

    /* Team Content Layout */
    .team-content-wrapper {
      display: flex;
      min-height: 500px;
    }

    /* Team Sidebar */
    .team-sidebar {
      width: 200px;
      background: #f8f9fa;
      border-right: 1px solid #e5e5e5;
      padding: 0;
    }

    .team-sidebar-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 20px;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      font-size: 14px;
      font-weight: 500;
      color: #374151;
    }

    .team-sidebar-item:hover {
      background: #e5e7eb;
    }

    .team-sidebar-item.active {
      background: #f05537;
      color: white;
    }

    .team-sidebar-item i {
      width: 16px;
      font-size: 14px;
    }

    /* Team Main Content */
    .team-main {
      flex: 1;
      padding: 24px;
    }

    /* Team Tab Content */
    .team-tab-content {
      display: none;
    }

    .team-tab-content.active {
      display: block;
    }

    /* Search Container */
    .team-search-container {
      position: relative;
      margin-bottom: 24px;
    }

    .team-search-input {
      width: 100%;
      padding: 12px 16px 12px 40px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 16px;
      background: white;
    }

    .team-search-input:focus {
      outline: none;
      border-color: #f05537;
      box-shadow: 0 0 0 3px rgba(240, 85, 55, 0.1);
    }

    .team-search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #9ca3af;
      font-size: 16px;
    }

    /* Loading State */
    .team-loading {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 40px;
    }

    .team-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #f3f4f6;
      border-top: 3px solid #f05537;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    /* Empty State */
    .team-empty-state {
      text-align: center;
      padding: 80px 20px;
    }

    .team-empty-state-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 24px;
      background: linear-gradient(135deg, #f05537, #ff7043);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 32px;
    }

    .team-empty-state-title {
      font-size: 24px;
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 12px;
    }

    .team-empty-state-description {
      color: #666;
      line-height: 1.5;
      margin-bottom: 32px;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }

    .invite-btn {
      background: #f05537;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
    }

    .invite-btn:hover {
      background: #e04527;
    }

    /* Team List Items */
    .team-list {
      display: block;
    }

    .team-list-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 0;
      border-bottom: 1px solid #f3f4f6;
    }

    .team-list-item:last-child {
      border-bottom: none;
    }

    .team-item-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .team-item-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 14px;
      position: relative;
      cursor: pointer;
    }

    .team-item-avatar.owner {
      background: linear-gradient(135deg, #1e293b, #475569);
    }

    .team-item-avatar.admin {
      background: linear-gradient(135deg, #dc2626, #ef4444);
    }

    .team-item-avatar.member {
      background: linear-gradient(135deg, #7c3aed, #a855f7);
    }

    .team-item-avatar.editor {
      background: linear-gradient(135deg, #059669, #10b981);
    }

    .team-item-avatar.custom {
      background: linear-gradient(135deg, #6b7280, #9ca3af);
    }

    /* Role Icon Styles */
    .team-role-icon {
      font-size: 16px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    /* Role-specific icons */
    .team-item-avatar.owner .team-role-icon::before {
      content: "\f521";
      /* fa-crown */
      font-family: "Font Awesome 6 Free";
      font-weight: 900;
    }

    .team-item-avatar.admin .team-role-icon::before {
      content: "\f505";
      /* fa-user-shield */
      font-family: "Font Awesome 6 Free";
      font-weight: 900;
    }

    .team-item-avatar.member .team-role-icon::before {
      content: "\f007";
      /* fa-user */
      font-family: "Font Awesome 6 Free";
      font-weight: 900;
    }

    .team-item-avatar.editor .team-role-icon::before {
      content: "\f044";
      /* fa-edit */
      font-family: "Font Awesome 6 Free";
      font-weight: 900;
    }

    .team-item-avatar.custom .team-role-icon::before {
      content: "\f0c0";
      /* fa-users */
      font-family: "Font Awesome 6 Free";
      font-weight: 900;
    }

    /* Role hover effects */
    .team-item-avatar:hover {
      transform: scale(1.05);
      transition: all 0.2s ease;
    }

    /* Role details popup */
    .team-role-details-popup {
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 12px 16px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      z-index: 100;
      min-width: 200px;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
      margin-top: 8px;
    }

    .team-role-details-popup.show {
      opacity: 1;
      visibility: visible;
    }

    .team-role-details-popup::before {
      content: "";
      position: absolute;
      top: -6px;
      left: 50%;
      transform: translateX(-50%);
      width: 12px;
      height: 12px;
      background: white;
      border: 1px solid #e5e7eb;
      border-bottom: none;
      border-right: none;
      transform: translateX(-50%) rotate(45deg);
    }

    .team-role-details-title {
      font-weight: 600;
      color: #1f2937;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .team-role-details-description {
      font-size: 12px;
      color: #6b7280;
      line-height: 1.4;
      margin-bottom: 8px;
    }

    .team-role-permissions {
      font-size: 11px;
      color: #9ca3af;
    }

    .team-permission-item {
      display: flex;
      align-items: center;
      gap: 4px;
      margin-bottom: 2px;
    }

    .team-permission-item i {
      width: 12px;
      color: #10b981;
    }

    .team-item-name {
      font-weight: 500;
      color: #374151;
    }

    .team-item-details {
      font-size: 12px;
      color: #666;
      margin-top: 2px;
    }

    .team-item-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .team-role-badge {
      background: #f05537;
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }

    .team-more-btn {
      background: none;
      border: none;
      padding: 8px;
      border-radius: 4px;
      cursor: pointer;
      color: #666;
    }

    .team-more-btn:hover {
      background: #f3f4f6;
    }

    /* Responsive Team Management */
    @media (max-width: 768px) {
      .team-content-wrapper {
        flex-direction: column;
      }

      .team-sidebar {
        width: 100%;
        display: flex;
        overflow-x: auto;
        border-right: none;
        border-bottom: 1px solid #e5e5e5;
      }

      .team-sidebar-item {
        white-space: nowrap;
        flex-shrink: 0;
      }

      .team-header {
        flex-direction: column;
        gap: 16px;
        align-items: stretch;
      }

      .team-main {
        padding: 16px;
      }

      .team-item-info {
        flex: 1;
      }

      .team-item-actions {
        flex-direction: column;
        align-items: flex-end;
        gap: 8px;
      }

      .team-role-details-popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        max-width: calc(100vw - 40px);
        margin: 0;
      }
    }

    /* Ticket Fees */
    .fee-item {
      background: white;
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      padding: 24px;
      margin-bottom: 16px;
    }

    .fee-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .fee-title {
      font-size: 18px;
      font-weight: 600;
      color: #1a1a1a;
    }

    .fee-amount {
      font-size: 18px;
      font-weight: 600;
      color: #1a1a1a;
    }

    .fee-description {
      color: #666;
      font-size: 14px;
      line-height: 1.4;
    }

    .contact-sales-box {
      background: #f8f9fa;
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      padding: 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }

    .contact-sales-content {
      flex: 1;
      min-width: 200px;
    }

    .contact-sales-title {
      font-size: 18px;
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 4px;
    }

    .contact-sales-description {
      color: #666;
      font-size: 14px;
    }

    /* Plan Management */
    .plan-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 32px;
      margin-bottom: 32px;
    }

    .plan-card {
      background: white;
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      padding: 24px;
    }

    .plan-badge {
      background: #1d4fd8;
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      display: inline-block;
      margin-bottom: 16px;
    }

    .plan-title {
      font-size: 24px;
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 8px;
    }

    .plan-description {
      color: #666;
      margin-bottom: 24px;
      line-height: 1.5;
    }

    .payment-method-card {
      background: white;
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      padding: 24px;
      text-align: center;
    }

    .payment-icon {
      width: 60px;
      height: 60px;
      margin: 0 auto 16px;
      background: #f3f4f6;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #9ca3af;
      font-size: 24px;
    }

    .nonprofit-notice {
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
    }

    .nonprofit-notice p {
      color: #1e40af;
      margin: 0;
    }

    .nonprofit-notice a {
      color: #1d4fd8;
      text-decoration: none;
      font-weight: 500;
    }

    .nonprofit-notice a:hover {
      text-decoration: underline;
    }

    .billing-section {
      background: white;
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      padding: 24px;
    }

    .billing-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 0;
      border-bottom: 1px solid #f3f4f6;
    }

    .billing-item:last-child {
      border-bottom: none;
    }

    .billing-content {
      flex: 1;
    }

    .billing-title {
      font-weight: 500;
      color: #1a1a1a;
      margin-bottom: 4px;
    }

    .billing-description {
      color: #666;
      font-size: 14px;
    }

    /* App Extensions */
    .extensions-table {
      background: white;
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      overflow: hidden;
    }

    .table-header {
      background: #f8f9fa;
      padding: 16px 24px;
      display: grid;
      grid-template-columns: 2fr 3fr 1fr 1fr;
      gap: 16px;
      border-bottom: 1px solid #e5e5e5;
      font-weight: 600;
      color: #374151;
      font-size: 14px;
    }

    .table-row {
      padding: 16px 24px;
      display: grid;
      grid-template-columns: 2fr 3fr 1fr 1fr;
      gap: 16px;
      border-bottom: 1px solid #f3f4f6;
      align-items: center;
    }

    .table-row:last-child {
      border-bottom: none;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .sidebar {
        width: 48px;
      }

      .main-content {
        margin-left: 72px;
        width: calc(100% - 72px);
        max-width: calc(100vw - 72px);
      }

      .header {
        padding: 8px 16px;
      }

      .user-name {
        display: none;
      }

      .page-content {
        padding: 16px 12px;
      }

      .page-header h1 {
        font-size: 28px;
      }

      .plan-grid {
        grid-template-columns: 1fr;
      }

      .table-header,
      .table-row {
        grid-template-columns: 1fr;
        gap: 8px;
      }

      .profile-card {
        flex-direction: column;
        align-items: flex-start;
      }

      .profile-actions {
        width: 100%;
        justify-content: flex-end;
      }
    }
  </style>
  <script src="js/config.js"></script>
  <script src="js/auth-api.js"></script>
</head>

<body>
  <div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-logo">
        <img src="logo.jpg" alt="Logo" style="width: 32px; height: 32px; object-fit: contain;">
      </div>

      <nav class="sidebar-nav">
        <a href="dashboard-home.html" class="sidebar-item home" title="Home">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
            <polyline points="9 22 9 12 15 12 15 22" />
          </svg>
        </a>

        <a href="events-calendar.html" class="sidebar-item calendar" title="Events">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
            <line x1="16" y1="2" y2="6" />
            <line x1="8" y1="2" y2="6" />
            <line x1="3" y1="21" y2="10" />
          </svg>
        </a>

        <a href="orders.html" class="sidebar-item" title="Orders">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
            <polyline points="14 2 14 8 20 8" />
            <line x1="16" y1="13" x2="8" y2="13" />
            <line x1="16" y1="17" x2="8" y2="17" />
            <polyline points="10 9 9 9 8 9" />
          </svg>
        </a>

        <a href="marketing.html" class="sidebar-item" title="Marketing">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
          </svg>
        </a>

        <a href="analytics.html" class="sidebar-item" title="Analytics">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="20" x2="18" y2="10" />
            <line x1="12" y1="20" x2="12" y2="4" />
            <line x1="6" y1="20" x2="6" y2="14" />
          </svg>
        </a>

        <a href="finance.html" class="sidebar-item" title="Finance">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="7" width="20" height="14" rx="2" ry="2" />
            <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" />
          </svg>
        </a>
      </nav>

      <div class="sidebar-bottom">
        <a href="settings.html" class="sidebar-item active" title="Settings">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3" />
            <path
              d="M12 1v6m0 6v6m4.22-13.22l4.24 4.24M1.54 1.54l4.24 4.24M20.46 20.46l-4.24-4.24M1.54 20.46l4.24-4.24M21 12h-6m-6 0H3" />
          </svg>
        </a>

        <a href="AppMarketplace.html" class="sidebar-item" title="Apps">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="7" height="7" />
            <rect x="14" y="3" width="7" height="7" />
            <rect x="14" y="14" width="7" height="7" />
            <rect x="3" y="14" width="7" height="7" />
          </svg>
        </a>

        <a href="#" onclick="navigateToHelpCenter()" class="sidebar-item" title="Help">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10" />
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
            <line x1="12" y1="17" x2="12.01" y2="17" />
          </svg>
        </a>
      </div>
    </aside>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Header -->
      <header class="header">
        <div class="header-content">
          <div class="header-left">
            <div class="logo">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="#ff5722">
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
              </svg>
            </div>
          </div>

          <div class="header-right">
            <button class="create-btn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19" />
                <line x1="5" y1="12" x2="19" y2="12" />
              </svg>
              Create
            </button>

            <div class="user-menu">
              <div class="user-avatar" id="userAvatar">MQ</div>
              <span class="user-name" id="userName">Musa Qazi</span>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6,9 12,15 18,9" />
              </svg>
            </div>
          </div>
        </div>
      </header>

      <!-- Page Content -->
      <div class="page-content">
        <div class="page-header">
          <div class="username" id="pageUsername">MUSA QAZI</div>
          <h1>Organization Settings</h1>
        </div>

        <!-- Tabs -->
        <div class="tabs">
          <button class="tab active" data-tab="organizer-profile">Organizer Profile</button>
          <button class="tab" data-tab="team-management">Team Management</button>
          <button class="tab" data-tab="ticket-fees">Ticket Fees</button>
          <button class="tab" data-tab="plan-management">Plan Management</button>
          <button class="tab" data-tab="app-extensions">App Extensions</button>
        </div>

        <!-- Tab Content -->
        <div class="tab-content active" id="organizer-profile">
          <!-- Organizer Profiles Section -->
          <div class="section">
            <div class="section-header">
              <h2>Organizer profiles</h2>
              <button class="add-profile-btn" onclick="addOrganizerProfile()">Add organizer profile</button>
            </div>
            <p class="section-description">
              Each profile describes a unique organizer and shows all of their events on one page. Having a complete
              profile can encourage attendees to follow you.
              <a href="#" class="learn-more">Learn more</a>
            </p>

            <!-- Organizer Profile Card -->
            <div class="profile-card">
              <div class="profile-info">
                <div class="profile-avatar">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                    <circle cx="12" cy="7" r="4" />
                  </svg>
                </div>
                <span class="profile-name" id="organizerName">Unnamed organizer</span>
              </div>
              <div class="profile-actions">
                <button class="edit-btn" onclick="editOrganizerProfile()">Edit</button>
                <button class="more-btn">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="1" />
                    <circle cx="12" cy="5" r="1" />
                    <circle cx="12" cy="19" r="1" />
                  </svg>
                </button>
              </div>
            </div>
          </div>

          <!-- Organization Section -->
          <div class="section">
            <h2>Organization</h2>
            <p class="section-description">Details that apply across your events and venues</p>

            <!-- Organization Logo Upload -->
            <div class="upload-section">
              <div class="upload-area" onclick="document.getElementById('logoUpload').click()">
                <div class="upload-icon">
                  <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                    <circle cx="8.5" cy="8.5" r="1.5" />
                    <polyline points="21,15 16,10 5,21" />
                  </svg>
                </div>
                <div class="upload-text">
                  <div class="upload-title">Drag & drop or click to add organization logo</div>
                  <div class="upload-subtitle">JPEG or PNG, no larger than 10MB</div>
                </div>
              </div>
              <input type="file" id="logoUpload" accept="image/*" style="display: none" />
            </div>

            <!-- Organization Form -->
            <div class="form-group">
              <label for="organizationName">Organization Name</label>
              <input type="text" id="organizationName" class="form-input" placeholder="Organization Name" />
              <div class="char-count"><span id="orgNameCount">0</span>/50</div>
            </div>

            <div class="form-group">
              <label for="preferredCountry">Preferred Country</label>
              <select id="preferredCountry" class="form-select">
                <option value="">Select a country</option>
                <option value="US">United States</option>
                <option value="UK">United Kingdom</option>
                <option value="CA">Canada</option>
                <option value="AU">Australia</option>
                <option value="DE">Germany</option>
                <option value="FR">France</option>
                <option value="IN">India</option>
                <option value="PK">Pakistan</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Team Management Tab -->
        <div class="tab-content" id="team-management">
          <div class="team-section">
            <div class="team-header">
              <h2>Team Management</h2>
              <button class="create-role-btn" onclick="redirectToCreateRole()">Create new role</button>
            </div>

            <div class="team-content-wrapper">
              <!-- Team Sidebar -->
              <div class="team-sidebar">
                <button class="team-sidebar-item active" onclick="switchTeamTab('users')">
                  <i class="fas fa-users"></i>
                  Users
                </button>
                <button class="team-sidebar-item" onclick="switchTeamTab('roles')">
                  <i class="fas fa-shield-alt"></i>
                  Roles
                </button>
              </div>

              <!-- Team Main Content -->
              <div class="team-main">
                <!-- Users Tab Content -->
                <div id="team-users-content" class="team-tab-content active">
                  <div class="team-search-container">
                    <i class="fas fa-search team-search-icon"></i>
                    <input type="text" class="team-search-input" placeholder="Search users..." id="teamUserSearch">
                  </div>

                  <div class="team-loading" id="teamUsersLoading">
                    <div class="team-spinner"></div>
                  </div>

                  <div class="team-empty-state" id="teamUsersEmptyState" style="display: none;">
                    <div class="team-empty-state-icon">
                      <i class="fas fa-envelope"></i>
                    </div>
                    <h3 class="team-empty-state-title">Build your team</h3>
                    <p class="team-empty-state-description">
                      Create new custom roles and assign them to team members, or invite users into an all access role.
                    </p>
                    <button class="invite-btn" onclick="openInviteModal()">Invite users</button>
                  </div>

                  <!-- Users List -->
                  <div id="teamUsersList" class="team-list" style="display: none;">
                    <!-- Users will be populated here -->
                  </div>
                </div>

                <!-- Roles Tab Content -->
                <div id="team-roles-content" class="team-tab-content">
                  <div class="team-search-container">
                    <i class="fas fa-search team-search-icon"></i>
                    <input type="text" class="team-search-input" placeholder="Search roles..." id="teamRoleSearch">
                  </div>

                  <div class="team-loading" id="teamRolesLoading">
                    <div class="team-spinner"></div>
                  </div>

                  <div id="teamRolesList" class="team-list" style="display: none;">
                    <!-- Roles will be populated here -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Ticket Fees Tab -->
        <div class="tab-content" id="ticket-fees">
          <div class="section">
            <h2>Ticket Fees</h2>
            <p class="section-description">
              Choose whether you pay the fees, or pass them along to your attendees. You can change this for each event.
            </p>

            <div class="fee-item">
              <div class="fee-header">
                <div class="fee-title">Service fee</div>
                <div class="fee-amount">3.7% + $1.79 per ticket</div>
              </div>
              <div class="fee-description">This keeps the Eventbrite platform running</div>
            </div>

            <div class="fee-item">
              <div class="fee-header">
                <div class="fee-title">Payment processing fee</div>
                <div class="fee-amount">2.9% per order</div>
              </div>
              <div class="fee-description">This offsets the cost of credit card transactions</div>
            </div>

            <div class="contact-sales-box">
              <div class="contact-sales-content">
                <div class="contact-sales-title">Organizing a large or complex event?</div>
                <div class="contact-sales-description">Get in touch with our sales team for custom pricing.</div>
              </div>
              <button class="secondary-btn" onclick="window.location.href='contact_sales_logged_version.html'">Contact
                sales</button>
            </div>
          </div>
        </div>

        <!-- Plan Management Tab -->
        <div class="tab-content" id="plan-management">
          <div class="plan-grid">
            <div class="plan-card">
              <div class="plan-badge">Current plan</div>
              <h3 class="plan-title">Free</h3>
              <p class="plan-description">Publish unlimited events and tickets for free!</p>
              <button class="secondary-btn" onclick="window.location.href='settings-new.html'">Compare options</button>
            </div>

            <div class="payment-method-card">
              <h3>Payment method</h3>
              <div class="payment-icon">
                <i class="fas fa-credit-card"></i>
              </div>
              <button class="primary-btn" onclick="handleAddPaymentMethod()">+ Add payment method</button>
            </div>
          </div>

          <div class="nonprofit-notice">
            <p>
              Nonprofits get special pricing on Eventbrite Pro. To receive a discount on all Pro plans,
              <a href="#" onclick="redirectToGoodstack(); return false;">verify your nonprofit status. →</a>
            </p>
          </div>

          <!-- Verification Modal -->
          <div id="verificationModal" class="modal" style="display: none;">
            <div class="modal-content">
              <div class="modal-header">
                <h2>Nonprofit Verification</h2>
                <button class="close-btn" onclick="closeVerificationModal()">×</button>
              </div>
              <div class="modal-body">
                <p>Goodstack is our trusted partner for nonprofit verification. To verify your nonprofit, you will need
                  to register with Goodstack and the data you provide is subject to Goodstack's terms and privacy
                  policy. Goodstack will provide Eventbrite with your registration information and information about
                  your organization's nonprofit status.</p>
                <button class="primary-btn" onclick="redirectToGoodstack()">
                  Verify on Goodstack
                  <i class="fas fa-external-link-alt"></i>
                </button>
              </div>
            </div>
          </div>

          <div class="billing-section">
            <h3 style="margin-bottom: 24px;">Billing history</h3>
            <div class="billing-item">
              <div class="billing-content">
                <div class="billing-title">Download your billing history</div>
                <div class="billing-description">View all recent charges for fees and subscriptions</div>
              </div>
              <button class="secondary-btn">
                <i class="fas fa-download" style="margin-right: 8px;"></i>
                Download CSV
              </button>
            </div>
          </div>
        </div>

        <!-- App Extensions Tab -->
        <div class="tab-content" id="app-extensions">
          <div class="section">
            <h2>App Extensions</h2>
            <p class="section-description">Connect third-party apps and services</p>

            <div class="extensions-table">
              <div class="table-header">
                <div>App Name</div>
                <div>Description</div>
                <div>Installed</div>
                <div>Actions</div>
              </div>
              <div class="empty-state">
                <p>No app extensions available at this time.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Organizer Profile Modal -->
  <div id="editModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <button class="back-btn" onclick="closeEditModal()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15,18 9,12 15,6" />
          </svg>
          Organization Settings
        </button>
      </div>

      <div class="modal-body">
        <h1>Edit Organizer Profile</h1>

        <!-- Profile Image Section -->
        <div class="profile-image-section">
          <div class="profile-image-icon">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
              <circle cx="8.5" cy="8.5" r="1.5" />
              <polyline points="21,15 16,10 5,21" />
            </svg>
          </div>
          <div class="profile-image-content">
            <h3>Organizer profile image</h3>
            <p>This is the first image attendees will see at the top of your profile. Use a high quality square image.
            </p>

            <div class="profile-image-upload" onclick="document.getElementById('profileImageUpload').click()">
              <div class="upload-placeholder">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                  <circle cx="8.5" cy="8.5" r="1.5" />
                  <polyline points="21,15 16,10 5,21" />
                </svg>
              </div>
              <div class="upload-text">
                <div>Drag & drop or click to add profile image.</div>
                <div class="upload-subtitle">JPEG or PNG, no larger than 10MB.</div>
              </div>
            </div>
            <input type="file" id="profileImageUpload" accept="image/*" style="display: none" />
          </div>
        </div>

        <!-- About the Organizer Section -->
        <div class="about-organizer-section">
          <div class="section-icon">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
              <circle cx="12" cy="7" r="4" />
            </svg>
          </div>
          <div class="section-content">
            <h3>About the organizer</h3>
            <p>Let attendees know who is hosting events. <a href="#" class="learn-more">Learn More</a></p>

            <div class="form-group">
              <label for="editOrganizerName">Organizer name *</label>
              <input type="text" id="editOrganizerName" class="form-input" placeholder="e.g. Eventbrite Careers" />
            </div>

            <div class="form-group">
              <label for="organizerWebsite">Your website</label>
              <input type="url" id="organizerWebsite" class="form-input"
                placeholder="e.g. https://www.eventbritecareers.com/home" />
            </div>

            <div class="organizer-url-section">
              <h4>Organizer page URL</h4>
              <p>Customizing your URL can help attendees find you when searching for your events. The URL can only
                contain letters, numbers, dashes, and underscores.</p>
              <div class="url-display">
                <span class="url-base">https://www.crowd.com/o/</span>
                <span class="url-custom" id="organizerUrlSlug">113990650841</span>
                <input type="text" id="editUrlSlugInput" class="form-input" style="display: none; flex: 1; margin: 0 8px;" placeholder="Enter custom URL slug">
                <button class="edit-url-btn" onclick="toggleUrlSlugEdit()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                  </svg>
                </button>
                <button class="copy-url-btn" onclick="copyOrganizerUrl()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
                  </svg>
                </button>
                <button class="save-url-btn" style="display: none; background: #10b981; color: white; border: none; padding: 4px 12px; border-radius: 4px; cursor: pointer; margin-left: 8px; font-size: 12px; font-weight: 600;" onclick="saveUrlSlug()">Save</button>
                <button class="cancel-url-btn" style="display: none; background: #6b7280; color: white; border: none; padding: 4px 12px; border-radius: 4px; cursor: pointer; margin-left: 4px; font-size: 12px; font-weight: 600;" onclick="cancelUrlSlugEdit()">Cancel</button>
              </div>
            </div>

            <div class="form-group">
              <h4>Organizer Bio</h4>
              <p>Describe who you are, the types of events you host, or your mission. The bio is displayed on your
                organizer profile. Unfortunately, we can no longer support images, video, or custom HTML in the
                description.</p>
              <div class="rich-text-editor">
                <div class="editor-toolbar">
                  <button type="button" class="toolbar-btn" data-command="bold">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z" />
                      <path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z" />
                    </svg>
                  </button>
                  <button type="button" class="toolbar-btn" data-command="italic">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <line x1="19" y1="4" x2="10" y2="4" />
                      <line x1="14" y1="20" x2="5" y2="20" />
                      <line x1="15" y1="4" x2="9" y2="20" />
                    </svg>
                  </button>
                  <button type="button" class="toolbar-btn" data-command="insertUnorderedList">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <line x1="8" y1="6" x2="21" y2="6" />
                      <line x1="8" y1="12" x2="21" y2="12" />
                      <line x1="8" y1="18" x2="21" y2="18" />
                      <line x1="3" y1="6" x2="3.01" y2="6" />
                      <line x1="3" y1="12" x2="3.01" y2="12" />
                      <line x1="3" y1="18" x2="3.01" y2="18" />
                    </svg>
                  </button>
                  <button type="button" class="toolbar-btn" data-command="insertOrderedList">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <line x1="10" y1="6" x2="21" y2="6" />
                      <line x1="10" y1="12" x2="21" y2="12" />
                      <line x1="10" y1="18" x2="21" y2="18" />
                      <path d="M4 6h1v4" />
                      <path d="M4 10h2" />
                      <path d="M6 18H4c0-1 2-2 2-3s-1-1.5-2-1" />
                    </svg>
                  </button>
                </div>
                <div class="editor-content" contenteditable="true" id="organizerBio"
                  placeholder="Write about yourself..."></div>
              </div>
            </div>

            <!-- Description for Event Pages -->
            <div class="form-group">
              <h4>Description for event pages</h4>
              <p>Write a short description for this organizer to show on all your event pages. Unfortunately, we can no
                longer support images, video, or custom HTML in the description.</p>
              <div class="rich-text-editor">
                <div class="editor-toolbar">
                  <button type="button" class="toolbar-btn" data-command="bold">B</button>
                  <button type="button" class="toolbar-btn" data-command="italic">I</button>
                  <button type="button" class="toolbar-btn" data-command="insertUnorderedList">•</button>
                  <button type="button" class="toolbar-btn" data-command="insertOrderedList">1.</button>
                </div>
                <div class="editor-content" contenteditable="true" id="eventDescription"
                  placeholder="Write a short description..."></div>
              </div>
            </div>

            <!-- Social Media Section -->
            <div class="social-media-section">
              <div class="section-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="2" y="3" width="20" height="14" rx="2" ry="2" />
                  <line x1="8" y1="21" x2="16" y2="21" />
                  <line x1="12" y1="17" x2="12" y2="21" />
                </svg>
              </div>
              <div class="section-content">
                <h3>Social media and marketing</h3>
                <p>Let attendees know how to connect with you</p>

                <div class="form-group">
                  <label for="facebookId">Facebook ID</label>
                  <input type="text" id="facebookId" class="form-input" placeholder="e.g. 1529883090599318" onblur="validateFacebookId(this)" />
                  <span id="facebookIdError" style="color: #dc2626; font-size: 12px; display: none; margin-top: 4px;"></span>
                </div>

                <div class="form-group">
                  <label for="twitterHandle">Twitter</label>
                  <div class="input-with-prefix">
                    <span class="input-prefix">@</span>
                    <input type="text" id="twitterHandle" class="form-input" placeholder="e.g. EventbriteLife"
                      style="padding-left: 32px;" onblur="validateTwitterHandle(this)" />
                  </div>
                  <span id="twitterHandleError" style="color: #dc2626; font-size: 12px; display: none; margin-top: 4px;"></span>
                </div>

                <div class="form-group">
                  <div class="toggle-group">
                    <div class="toggle-switch">
                      <input type="checkbox" id="emailOptIn" checked />
                      <label for="emailOptIn" class="toggle-label"></label>
                    </div>
                    <div class="toggle-content">
                      <div class="toggle-title">Email opt-in: Enabled</div>
                      <div class="toggle-description">Attendees are able to opt-in to receive marketing emails at
                        checkout</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="secondary-btn" onclick="closeEditModal()">Cancel</button>
        <button class="primary-btn" onclick="saveOrganizerProfile()">Save</button>
      </div>
    </div>
  </div>

  <script>
    // Initialize page
    document.addEventListener("DOMContentLoaded", function () {
      initializeSettings();
    });

    async function initializeSettings() {
      console.log('⚙️ Initializing Settings page...');

      // Check authentication first
      if (!window.authAPI) {
        console.error('❌ AuthAPI not available');
        window.location.href = 'login.html';
        return;
      }

      const isAuthenticated = checkAuthentication();
      if (!isAuthenticated) {
        console.log('User not authenticated, redirecting to login');
        localStorage.setItem('redirectAfterLogin', 'settings.html');
        window.location.href = 'login.html';
        return;
      }

      console.log('✅ User authenticated, loading settings...');

      // Initialize components
      initializeTabs();
      initializeTeamTabs();
      initializeFormHandlers();

      // Wait for authAPI to be ready then load data
      setTimeout(async () => {
        await loadUserData();
        checkOrganizerStatus();
        handleUrlParameters();
      }, 500);

      console.log('✅ Settings initialized successfully');
    }

    function checkAuthentication() {
      // Check for authentication data
      const authToken = localStorage.getItem('authToken');
      const currentUser = localStorage.getItem('currentUser');
      return !!(authToken || currentUser);
    }

    function handleUrlParameters() {
      // Get URL parameters to handle direct links from dashboard
      const urlParams = new URLSearchParams(window.location.search);
      const tab = urlParams.get('tab');
      const action = urlParams.get('action');

      // Handle hash-based navigation (e.g., #team-management)
      const hash = window.location.hash.substring(1); // Remove the # symbol

      if (hash) {
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');

        // Remove active from all tabs and contents
        tabs.forEach(t => t.classList.remove('active'));
        tabContents.forEach(tc => tc.classList.remove('active'));

        // Find and activate the target tab
        const targetTab = document.querySelector(`[data-tab="${hash}"]`);
        const targetContent = document.getElementById(hash);

        if (targetTab && targetContent) {
          targetTab.classList.add('active');
          targetContent.classList.add('active');

          // Load team management data when team tab is activated
          if (hash === 'team-management') {
            setTimeout(() => {
              loadTeamManagement();
            }, 500);
          }
        }

        // Clean up hash from URL without reloading page
        setTimeout(() => {
          const cleanUrl = window.location.pathname + window.location.search;
          window.history.replaceState({}, document.title, cleanUrl);
        }, 1000);

        return; // Exit early if hash was processed
      }

      // If redirected from dashboard with specific tab and action
      if (tab === 'organizer-profile') {
        // Switch to organizer profile tab
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');

        tabs.forEach(t => t.classList.remove('active'));
        tabContents.forEach(tc => tc.classList.remove('active'));

        const organizerTab = document.querySelector('[data-tab="organizer-profile"]');
        const organizerContent = document.getElementById('organizer-profile');

        if (organizerTab && organizerContent) {
          organizerTab.classList.add('active');
          organizerContent.classList.add('active');
        }

        // Handle the action
        if (action === 'edit') {
          // Wait a moment for the page to load, then open edit modal
          setTimeout(async () => {
            const currentUser = window.authAPI ? await window.authAPI.getCurrentUser() : null;
            if (currentUser && (currentUser.isOrganizer || currentUser.role === 'organizer')) {
              await editOrganizerProfile();
            } else {
              // User is not an organizer yet, show create profile modal
              await addOrganizerProfile();
            }
          }, 500);
        } else if (action === 'create') {
          // Wait a moment, then open create profile modal
          setTimeout(async () => {
            await addOrganizerProfile();
          }, 500);
        }

        // Clean up URL without reloading page
        const cleanUrl = window.location.pathname;
        window.history.replaceState({}, document.title, cleanUrl);
      }
    }

    async function loadUserData() {
      try {
        if (!window.authAPI) {
          console.error('❌ AuthAPI not available');
          return;
        }

        // Always fetch fresh user data from the database API - NEVER use localStorage
        console.log('🔄 Fetching fresh user data from database...');
        const currentUser = await window.authAPI.getCurrentUser();

        if (!currentUser) {
          console.error('❌ No user data received from API - user may not be logged in');
          // Redirect to login if no user data
          window.location.href = 'login.html';
          return;
        }

        console.log('✅ Fresh user data loaded from database:', currentUser.email);
        updateUserDisplay(currentUser);

        // Optional: Store user data in localStorage for offline access only
        // but ALWAYS prioritize fresh API data
        localStorage.setItem('currentUser', JSON.stringify(currentUser));

      } catch (error) {
        console.error('❌ Error loading fresh user data:', error);

        // If API fails, redirect to login - don't use stale data
        console.log('🔄 Redirecting to login due to API failure');
        window.location.href = 'login.html';
      }
    }

    function updateUserDisplay(currentUser) {
      let firstName = 'User';
      let lastName = '';

      // Handle different user data structures from authAPI
      if (currentUser.firstName && currentUser.lastName) {
        // Capitalize names properly
        firstName = currentUser.firstName.charAt(0).toUpperCase() + currentUser.firstName.slice(1).toLowerCase();
        lastName = currentUser.lastName.charAt(0).toUpperCase() + currentUser.lastName.slice(1).toLowerCase();
      } else if (currentUser.name) {
        // If user has a single name field, split it
        const nameParts = currentUser.name.split(' ');
        firstName = nameParts[0];
        lastName = nameParts.length > 1 ? nameParts[nameParts.length - 1] : '';
      } else if (currentUser.email) {
        // Last resort - use email username
        firstName = currentUser.email.split('@')[0];
      }

      const initials = (firstName.charAt(0) + lastName.charAt(0)).toUpperCase();

      // Update header with user info
      const userAvatar = document.getElementById('userAvatar');
      const userName = document.getElementById('userName');
      const pageUsername = document.getElementById('pageUsername');

      if (userAvatar) {
        userAvatar.textContent = initials;
      }

      if (userName) {
        userName.textContent = `${firstName} ${lastName}`;
      }

      if (pageUsername) {
        const name = `${firstName.toUpperCase()} ${lastName.toUpperCase()}`;
        pageUsername.textContent = currentUser.isOrganizer ? `${name} (ORGANIZER)` : name;
      }
    }

    async function checkOrganizerStatus() {
      try {
        let isOrganizer = false;
        let organizerProfile = null;

        // Always get fresh data from authAPI first
        if (window.authAPI) {
          const currentUser = await window.authAPI.getCurrentUser();
          if (currentUser) {
            isOrganizer = currentUser?.isOrganizer || currentUser?.role === 'organizer';
            organizerProfile = currentUser?.organizerProfile;
          }
        }

        // Only fallback to localStorage if authAPI fails
        if (!isOrganizer && !organizerProfile) {
          console.log('⚠️ Falling back to localStorage for organizer profile (authAPI unavailable)');
          const storedProfile = localStorage.getItem('organizerProfile');
          if (storedProfile) {
            isOrganizer = true;
            organizerProfile = JSON.parse(storedProfile);
          }
        }

        if (isOrganizer && organizerProfile) {
          // Update the organizer profile display
          updateOrganizerDisplay(organizerProfile);

          // Update the organizer name in the profile card
          const organizerNameElement = document.getElementById('organizerName');
          if (organizerNameElement) {
            organizerNameElement.textContent = organizerProfile.name || 'Organizer Profile';
          }
        }

      } catch (error) {
        console.error('Error checking organizer status:', error);
      }
    }

    function initializeTabs() {
      const tabs = document.querySelectorAll(".tab");
      const tabContents = document.querySelectorAll(".tab-content");

      tabs.forEach((tab) => {
        tab.addEventListener("click", function () {
          const targetTab = this.getAttribute("data-tab");

          // Remove active class from all tabs and contents
          tabs.forEach((t) => t.classList.remove("active"));
          tabContents.forEach((tc) => tc.classList.remove("active"));

          // Add active class to clicked tab and corresponding content
          this.classList.add("active");
          document.getElementById(targetTab).classList.add("active");

          // Load team management data when team tab is activated
          if (targetTab === 'team-management') {
            loadTeamManagement();
          }
        });
      });
    }

    function initializeTeamTabs() {
      const teamTabs = document.querySelectorAll(".team-tab");

      teamTabs.forEach((tab) => {
        tab.addEventListener("click", function () {
          teamTabs.forEach((t) => t.classList.remove("active"));
          this.classList.add("active");
        });
      });
    }

    function initializeFormHandlers() {
      // Organization name character counter
      const orgNameInput = document.getElementById("organizationName");
      if (orgNameInput) {
        orgNameInput.addEventListener("input", function () {
          updateCharCount("organizationName", "orgNameCount", 50);
        });
      }

      // Rich text editor functionality
      initializeRichTextEditor();
    }

    function updateCharCount(inputId, countId, maxLength) {
      const input = document.getElementById(inputId);
      const counter = document.getElementById(countId);
      if (input && counter) {
        const currentLength = input.value.length;
        counter.textContent = currentLength;

        if (currentLength > maxLength) {
          counter.style.color = "#dc3545";
        } else {
          counter.style.color = "#666";
        }
      }
    }

    function initializeRichTextEditor() {
      const toolbarButtons = document.querySelectorAll(".toolbar-btn");

      toolbarButtons.forEach((button) => {
        button.addEventListener("click", function (e) {
          e.preventDefault();
          const command = this.getAttribute("data-command");
          document.execCommand(command, false, null);
        });
      });
    }

    async function editOrganizerProfile() {
      document.getElementById("editModal").style.display = "flex";

      // Update modal title and button text for editing
      const modalTitle = document.querySelector('#editModal .modal-body h1');
      const saveButton = document.querySelector('#editModal .primary-btn');

      modalTitle.textContent = 'Edit Organizer Profile';
      saveButton.textContent = 'Save Changes';
      saveButton.onclick = saveOrganizerProfile;

      // Load existing profile data
      await loadExistingProfileData();
    }

    async function loadExistingProfileData() {
      try {
        let profileData = null;

        // Always try to get fresh profile data from authAPI first
        if (window.authAPI) {
          const currentUser = await window.authAPI.getCurrentUser();
          profileData = currentUser ? currentUser.organizerProfile : null;
        }

        // Only fallback to localStorage if authAPI fails
        if (!profileData) {
          console.log('⚠️ Falling back to localStorage for profile data (authAPI unavailable)');
          const storedProfile = localStorage.getItem('organizerProfile');
          profileData = storedProfile ? JSON.parse(storedProfile) : null;
        }

        if (profileData) {
          // Populate form fields with existing data
          document.getElementById("editOrganizerName").value = profileData.name || '';
          document.getElementById("organizerWebsite").value = profileData.website || '';
          document.getElementById("organizerBio").innerHTML = profileData.bio || '';
          document.getElementById("eventDescription").innerHTML = profileData.eventDescription || '';
          document.getElementById("facebookId").value = profileData.facebookId || '';
          document.getElementById("twitterHandle").value = profileData.twitterHandle || '';
          document.getElementById("emailOptIn").checked = profileData.emailOptIn !== false;

          if (profileData.organizationName) {
            document.getElementById("organizationName").value = profileData.organizationName;
          }
          if (profileData.preferredCountry) {
            document.getElementById("preferredCountry").value = profileData.preferredCountry;
          }
        }

      } catch (error) {
        console.error('Error loading profile data:', error);
      }
    }

    function closeEditModal() {
      document.getElementById("editModal").style.display = "none";
    }

    function handleAddPaymentMethod() {
      // Store current page URL in local storage to return after payment setup
      localStorage.setItem('returnToSettings', window.location.href);
      // Navigate to payment method page
      window.location.href = 'payment-method.html';
    }

    function showVerificationModal() {
      document.getElementById('verificationModal').style.display = 'flex';
    }

    function closeVerificationModal() {
      document.getElementById('verificationModal').style.display = 'none';
    }

    function redirectToGoodstack() {
      window.location.href = 'https://validation.goodstack.org/validate/validationinvite_4619bf85-aa01-46f6-b73a-678edc193a3a?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwYXJ0bmVyUHVibGljS2V5IjoicGtfZTYxNjVkMTItZDI4Mi00YjRkLTg0MDctMjk5OTQxZjA1NzljIiwiaWF0IjoxNzU0NTcxMzgyfQ.LvkryZwx_EzcllsOkKPaIimZR2ssOz0XoaY4vcCFvEY';
    }

    function displaySavedPaymentMethod() {
      const savedPayment = localStorage.getItem('paymentMethod');
      if (savedPayment) {
        const paymentData = JSON.parse(savedPayment);
        const lastFour = paymentData.cardNumber.slice(-4);
        const paymentCard = document.querySelector('.payment-method-card');

        paymentCard.innerHTML = `
          <h3>Payment method</h3>
          <div class="payment-icon">
            <i class="fas fa-credit-card"></i>
          </div>
          <div class="saved-card-info">
            <p>Card ending in ${lastFour}</p>
            <p>Expires: ${paymentData.cardExpiry}</p>
          </div>
          <button class="secondary-btn" onclick="handleAddPaymentMethod()">Update payment method</button>
        `;
      }
    }

    // Load organizer profile from backend
    async function loadOrganizerProfile() {
      try {
        const API_BASE_URL = window.Config?.API_BASE_URL ||
          (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:3000'
            : 'https://crowd-backend-zxxp.onrender.com');

        const token = localStorage.getItem('authToken') || localStorage.getItem('token');

        if (!token) {
          console.log('No auth token found, skipping organizer profile load');
          return;
        }

        const response = await fetch(`${API_BASE_URL}/api/organizer/profile`, {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });

        if (!response.ok) {
          console.log('No organizer profile found');
          return;
        }

        const data = await response.json();

        if (data.success && data.organizerProfile) {
          // Update display with loaded profile
          updateOrganizerDisplay(data.organizerProfile);

          // Store in localStorage
          localStorage.setItem('organizerProfile', JSON.stringify(data.organizerProfile));

          console.log('✅ Organizer profile loaded successfully');
        }
      } catch (error) {
        console.error('Error loading organizer profile:', error);
      }
    }

    // Call this when page loads
    document.addEventListener('DOMContentLoaded', function () {
      displaySavedPaymentMethod();
      loadOrganizerProfile();
    });

    async function addOrganizerProfile() {
      // Check if user is authenticated and has necessary permissions
      const currentUser = window.authAPI ? await window.authAPI.getCurrentUser() : null;

      if (!currentUser) {
        alert('Please log in to add an organizer profile.');
        window.location.href = 'login.html';
        return;
      }

      // Show the organizer profile creation modal
      document.getElementById("editModal").style.display = "flex";

      // Update modal title and button text for creation
      const modalTitle = document.querySelector('#editModal .modal-body h1');
      const saveButton = document.querySelector('#editModal .primary-btn');

      modalTitle.textContent = 'Create Organizer Profile';
      saveButton.textContent = 'Create Profile';
      saveButton.onclick = createOrganizerProfile;

      // Clear all form fields for new profile
      clearOrganizerForm();
    }

    function clearOrganizerForm() {
      document.getElementById("editOrganizerName").value = '';
      document.getElementById("organizerWebsite").value = '';
      document.getElementById("organizerBio").innerHTML = '';
      document.getElementById("eventDescription").innerHTML = '';
      document.getElementById("facebookId").value = '';
      document.getElementById("twitterHandle").value = '';
      document.getElementById("emailOptIn").checked = true;
    }

    async function createOrganizerProfile() {
      const profileData = {
        name: document.getElementById("editOrganizerName").value.trim(),
        website: document.getElementById("organizerWebsite").value.trim(),
        bio: document.getElementById("organizerBio").innerHTML.trim(),
        eventDescription: document.getElementById("eventDescription").innerHTML.trim(),
        facebookId: document.getElementById("facebookId").value.trim(),
        twitterHandle: document.getElementById("twitterHandle").value.trim(),
        emailOptIn: document.getElementById("emailOptIn").checked,
        organizationName: document.getElementById("organizationName").value.trim(),
        preferredCountry: document.getElementById("preferredCountry").value,
        createdAt: new Date().toISOString()
      };

      // Validate required fields
      if (!profileData.name) {
        alert('Organizer name is required.');
        return;
      }

      try {
        // Save profile data using authAPI if available
        if (window.authAPI) {
          const currentUser = await window.authAPI.getCurrentUser();

          // Update user to be an organizer
          const updatedUser = {
            ...currentUser,
            isOrganizer: true,
            role: 'organizer',
            organizerProfile: profileData
          };

          // Update user data via API
          await window.authAPI.updateUser(updatedUser);

          // Update the display
          updateOrganizerDisplay(profileData);

          // Show success message
          showSuccessMessage('Organizer profile created successfully! You are now an event organizer.');
        } else {
          // Fallback for when authAPI is not available
          console.log('⚠️ Using localStorage fallback for organizer profile creation');
          localStorage.setItem('organizerProfile', JSON.stringify(profileData));
          updateOrganizerDisplay(profileData);
          showSuccessMessage('Organizer profile created successfully!');
        }

        closeEditModal();

      } catch (error) {
        console.error('Error creating organizer profile:', error);
        alert('Failed to create organizer profile. Please try again.');
      }
    }

    function updateOrganizerDisplay(profileData) {
      // Update the organizer name in the profile card
      const organizerNameElement = document.getElementById("organizerName");
      if (organizerNameElement && profileData.name) {
        organizerNameElement.textContent = profileData.name;
      }

      // Update organization name if provided
      const orgNameInput = document.getElementById("organizationName");
      if (orgNameInput && profileData.organizationName) {
        orgNameInput.value = profileData.organizationName;
      }

      // Update preferred country if provided
      const countrySelect = document.getElementById("preferredCountry");
      if (countrySelect && profileData.preferredCountry) {
        countrySelect.value = profileData.preferredCountry;
      }

      // Update header username to show organizer status
      const usernameElement = document.getElementById('pageUsername');
      if (usernameElement) {
        const currentText = usernameElement.textContent.replace(' (ORGANIZER)', '');
        usernameElement.textContent = currentText + ' (ORGANIZER)';
      }

      // Update team management section
      updateTeamManagement(profileData);
    }

    function showSuccessMessage(message) {
      // Create and show success notification
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #10b981;
        color: white;
        padding: 16px 24px;
        border-radius: 8px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        z-index: 1001;
        font-weight: 500;
        max-width: 400px;
        animation: slideInRight 0.3s ease;
      `;
      notification.textContent = message;

      document.body.appendChild(notification);

      // Add CSS animation
      const style = document.createElement('style');
      style.textContent = `
        @keyframes slideInRight {
          from { transform: translateX(100px); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
      `;
      document.head.appendChild(style);

      setTimeout(() => {
        notification.style.animation = 'slideInRight 0.3s ease reverse';
        setTimeout(() => notification.remove(), 300);
      }, 4000);
    }

    async function saveOrganizerProfile() {
      // Get form data
      const profileData = {
        name: document.getElementById("editOrganizerName").value,
        website: document.getElementById("organizerWebsite").value,
        bio: document.getElementById("organizerBio").innerHTML,
        eventDescription: document.getElementById("eventDescription").innerHTML,
        socialMedia: {
          facebook: document.getElementById("facebookId")?.value || '',
          twitter: document.getElementById("twitterHandle")?.value || ''
        },
        emailOptIn: document.getElementById("emailOptIn")?.checked || false,
        organizationName: document.getElementById("organizationName")?.value || '',
        preferredCountry: document.getElementById("preferredCountry")?.value || ''
      };

      // Validate required fields
      if (!profileData.name || profileData.name.trim() === '') {
        alert('Organizer name is required');
        return;
      }

      try {
        const API_BASE_URL = window.Config?.API_BASE_URL ||
          (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:3000'
            : 'https://crowd-backend-zxxp.onrender.com');

        const token = localStorage.getItem('authToken') || localStorage.getItem('token');

        if (!token) {
          alert('Please log in to update your organizer profile');
          return;
        }

        const response = await fetch(`${API_BASE_URL}/api/organizer/profile`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(profileData)
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.message || 'Failed to update organizer profile');
        }

        console.log('✅ Organizer profile updated:', data);

        // Update organizer name display
        if (profileData.name) {
          document.getElementById("organizerName").textContent = profileData.name;
        }

        // Store in localStorage for quick access
        localStorage.setItem('organizerProfile', JSON.stringify(data.organizerProfile));

        closeEditModal();
        showSuccessMessage("Organizer profile updated successfully!");

      } catch (error) {
        console.error('❌ Error updating organizer profile:', error);
        alert('Failed to update organizer profile: ' + error.message);
      }
    }

    // Handle logo upload
    document.getElementById("logoUpload").addEventListener("change", function (e) {
      const file = e.target.files[0];
      if (file) {
        console.log("Logo uploaded:", file.name);
        alert("Logo upload functionality would be implemented here");
      }
    });

    // Handle profile image upload
    document.getElementById("profileImageUpload").addEventListener("change", function (e) {
      const file = e.target.files[0];
      if (file) {
        console.log("Profile image uploaded:", file.name);
        alert("Profile image upload functionality would be implemented here");
      }
    });

    // Modal styles
    const modalStyles = `
        /* Verification Modal specific styles */
        #verificationModal .modal-content {
          max-width: 600px;
        }

        #verificationModal .modal-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 20px 24px;
        }

        #verificationModal .modal-header h2 {
          margin: 0;
          font-size: 24px;
          color: #1a1a1a;
        }

        #verificationModal .close-btn {
          background: none;
          border: none;
          font-size: 24px;
          color: #666;
          cursor: pointer;
        }

        #verificationModal .modal-body {
          padding: 24px;
        }

        #verificationModal .modal-body p {
          margin-bottom: 24px;
          line-height: 1.5;
          color: #374151;
        }

        #verificationModal .primary-btn {
          display: flex;
          align-items: center;
          gap: 8px;
          padding: 12px 24px;
          font-size: 16px;
          width: 100%;
          justify-content: center;
        }

        #verificationModal .primary-btn i {
          font-size: 14px;
        }

        .modal {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          z-index: 1000;
          align-items: center;
          justify-content: center;
        }

        .modal-content {
          background: white;
          width: 90%;
          max-width: 800px;
          max-height: 90vh;
          border-radius: 8px;
          display: flex;
          flex-direction: column;
          margin: 20px;
        }

        .modal-header {
          padding: 16px 24px;
          border-bottom: 1px solid #e5e5e5;
        }

        .back-btn {
          background: none;
          border: none;
          color: #1d4fd8;
          cursor: pointer;
          display: flex;
          align-items: center;
          gap: 8px;
          font-size: 14px;
        }

        .modal-body {
          flex: 1;
          padding: 24px;
          overflow-y: auto;
        }

        .modal-body h1 {
          font-size: 36px;
          font-weight: bold;
          color: #1a1a1a;
          margin-bottom: 32px;
        }

        .modal-footer {
          padding: 16px 24px;
          border-top: 1px solid #e5e5e5;
          display: flex;
          justify-content: flex-end;
          gap: 12px;
          flex-wrap: wrap;
        }

        .profile-image-section,
        .about-organizer-section,
        .social-media-section {
          display: flex;
          gap: 16px;
          margin-bottom: 40px;
          align-items: flex-start;
        }

        .profile-image-icon,
        .section-icon {
          flex-shrink: 0;
          color: #9ca3af;
        }

        .profile-image-content,
        .section-content {
          flex: 1;
          min-width: 0;
        }

        .profile-image-content h3,
        .section-content h3 {
          font-size: 20px;
          font-weight: 600;
          color: #1a1a1a;
          margin-bottom: 8px;
        }

        .profile-image-content p,
        .section-content p {
          color: #666;
          margin-bottom: 24px;
          line-height: 1.5;
        }

        .section-content h4 {
          font-size: 16px;
          font-weight: 600;
          color: #1a1a1a;
          margin-bottom: 8px;
        }

        .profile-image-upload {
          border: 2px dashed #d1d5db;
          border-radius: 8px;
          padding: 40px;
          text-align: center;
          cursor: pointer;
          background: #f9fafb;
        }

        .upload-placeholder {
          color: #9ca3af;
          margin-bottom: 16px;
        }

        .organizer-url-section {
          margin: 24px 0;
        }

        .url-display {
          display: flex;
          align-items: center;
          background: #f9fafb;
          border: 1px solid #d1d5db;
          border-radius: 6px;
          padding: 12px;
          margin-top: 12px;
          flex-wrap: wrap;
          gap: 8px;
        }

        .url-base {
          color: #666;
        }

        .url-custom {
          color: #1d4fd8;
          font-weight: 500;
        }

        .edit-url-btn,
        .copy-url-btn {
          background: none;
          border: none;
          padding: 4px;
          margin-left: 8px;
          cursor: pointer;
          color: #666;
          border-radius: 4px;
          flex-shrink: 0;
        }

        .edit-url-btn:hover,
        .copy-url-btn:hover {
          background: #e5e7eb;
        }

        .rich-text-editor {
          border: 1px solid #d1d5db;
          border-radius: 6px;
          overflow: hidden;
        }

        .editor-toolbar {
          background: #f9fafb;
          border-bottom: 1px solid #d1d5db;
          padding: 8px 12px;
          display: flex;
          gap: 4px;
          flex-wrap: wrap;
        }

        .toolbar-btn {
          background: none;
          border: none;
          padding: 6px 8px;
          border-radius: 4px;
          cursor: pointer;
          color: #374151;
          font-weight: 500;
        }

        .toolbar-btn:hover {
          background: #e5e7eb;
        }

        .editor-content {
          padding: 12px;
          min-height: 120px;
          outline: none;
          line-height: 1.5;
          width: 100%;
          box-sizing: border-box;
        }

        .editor-content:empty::before {
          content: attr(placeholder);
          color: #9ca3af;
        }

        .input-with-prefix {
          position: relative;
          width: 100%;
        }

        .input-prefix {
          position: absolute;
          left: 12px;
          top: 50%;
          transform: translateY(-50%);
          color: #666;
          font-weight: 500;
        }

        .toggle-group {
          display: flex;
          align-items: flex-start;
          gap: 12px;
        }

        .toggle-switch {
          position: relative;
          flex-shrink: 0;
        }

        .toggle-switch input {
          opacity: 0;
          width: 0;
          height: 0;
        }

        .toggle-label {
          display: block;
          width: 44px;
          height: 24px;
          background: #1d4fd8;
          border-radius: 12px;
          position: relative;
          cursor: pointer;
          transition: background 0.2s;
        }

        .toggle-label::after {
          content: "";
          position: absolute;
          top: 2px;
          left: 2px;
          width: 20px;
          height: 20px;
          background: white;
          border-radius: 50%;
          transition: transform 0.2s;
          transform: translateX(20px);
        }

        .toggle-switch input:not(:checked) + .toggle-label {
          background: #d1d5db;
        }

        .toggle-switch input:not(:checked) + .toggle-label::after {
          transform: translateX(0);
        }

        .toggle-content {
          flex: 1;
          min-width: 0;
        }

        .toggle-title {
          font-weight: 500;
          color: #374151;
          margin-bottom: 4px;
        }

        .toggle-description {
          font-size: 14px;
          color: #666;
          line-height: 1.4;
        }
        
        /* Team Members Styles */
        .team-members-list {
          background: white;
          border: 1px solid #e5e5e5;
          border-radius: 8px;
          padding: 0;
          margin-top: 24px;
          overflow: hidden;
        }
        
        .team-member-item {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 16px 24px;
          border-bottom: 1px solid #f3f4f6;
        }
        
        .team-member-item:last-child {
          border-bottom: none;
        }
        
        .member-info {
          display: flex;
          align-items: center;
          gap: 12px;
        }
        
        .member-avatar {
          width: 40px;
          height: 40px;
          background: #f3f4f6;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          color: #9ca3af;
        }
        
        .member-details {
          display: flex;
          flex-direction: column;
        }
        
        .member-name {
          font-weight: 500;
          color: #374151;
        }
        
        .member-role {
          font-size: 14px;
          color: #666;
        }
        
        .member-status {
          background: #1d4fd8;
          color: white;
          padding: 4px 12px;
          border-radius: 12px;
          font-size: 12px;
          font-weight: 600;
        }
      `;

    // Add modal styles to document
    const styleSheet = document.createElement("style");
    styleSheet.textContent = modalStyles;
    document.head.appendChild(styleSheet);

    // Additional functions for team management and invitations
    function updateTeamManagement(profileData) {
      const teamMembersList = document.getElementById('teamMembersList');
      const teamDescription = document.getElementById('teamDescription');
      const currentUserMember = document.getElementById('currentUserMember');

      if (teamMembersList) {
        teamMembersList.style.display = 'block';

        if (teamDescription) {
          teamDescription.textContent = 'Manage your event organization team. Invite collaborators and assign roles.';
        }

        if (currentUserMember && profileData.name) {
          currentUserMember.textContent = profileData.name;
        }
      }
    }

    async function inviteUsers() {
      const currentUser = window.authAPI ? await window.authAPI.getCurrentUser() : null;

      if (!currentUser || (!currentUser.isOrganizer && currentUser.role !== 'organizer')) {
        showNotification('Please create an organizer profile first to invite team members.', 'info');
        return;
      }

      showInviteModal();
    }

    function showInviteModal() {
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.style.display = 'flex';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 500px;">
          <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; padding: 20px 24px; border-bottom: 1px solid #e5e5e5;">
            <h2 style="margin: 0; font-size: 24px; color: #1a1a1a;">Invite Team Members</h2>
            <button onclick="this.closest('.modal').remove()" style="background:none;border:none;font-size:24px;cursor:pointer;color:#666;">×</button>
          </div>
          <div style="padding: 24px;">
            <div class="form-group">
              <label for="inviteEmail">Email addresses</label>
              <textarea id="inviteEmail" class="form-input" placeholder="Enter email addresses (one per line or separated by commas)" style="min-height: 100px; resize: vertical;"></textarea>
            </div>
            <div class="form-group">
              <label for="inviteRole">Role</label>
              <select id="inviteRole" class="form-select">
                <option value="member">Team Member</option>
                <option value="admin">Administrator</option>
                <option value="editor">Event Editor</option>
              </select>
            </div>
            <div class="form-group">
              <label for="inviteMessage">Personal message (optional)</label>
              <textarea id="inviteMessage" class="form-input" placeholder="Add a personal message..." style="min-height: 80px; resize: vertical;"></textarea>
            </div>
          </div>
          <div style="padding: 16px 24px; border-top: 1px solid #e5e5e5; display: flex; justify-content: flex-end; gap: 12px;">
            <button class="secondary-btn" onclick="this.closest('.modal').remove()">Cancel</button>
            <button class="primary-btn" onclick="sendInvitations()">Send Invitations</button>
          </div>
        </div>
      `;

      document.body.appendChild(modal);
    }

    function sendInvitations() {
      const emailText = document.getElementById('inviteEmail').value.trim();
      const role = document.getElementById('inviteRole').value;

      if (!emailText) {
        alert('Please enter at least one email address.');
        return;
      }

      const emails = emailText.split(/[,\n]/).map(email => email.trim()).filter(email => email);
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      const invalidEmails = emails.filter(email => !emailRegex.test(email));

      if (invalidEmails.length > 0) {
        alert(`Invalid email addresses: ${invalidEmails.join(', ')}`);
        return;
      }

      console.log('Sending invitations:', { emails, role });
      document.querySelector('.modal').remove();
      showSuccessMessage(`Invitations sent to ${emails.length} email${emails.length > 1 ? 's' : ''}!`);
    }

    function showNotification(message, type = 'info') {
      const bgColor = { 'success': '#10b981', 'error': '#ef4444', 'info': '#3b82f6' }[type] || '#3b82f6';

      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed; top: 20px; right: 20px; background: ${bgColor}; color: white;
        padding: 16px 24px; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        z-index: 1001; font-weight: 500; max-width: 400px; animation: slideInRight 0.3s ease;
      `;
      notification.textContent = message;

      document.body.appendChild(notification);
      setTimeout(() => {
        notification.style.animation = 'slideInRight 0.3s ease reverse';
        setTimeout(() => notification.remove(), 300);
      }, 4000);
    }

    // Global function that can be called from other pages
    window.openOrganizerProfileSettings = async function (action = 'edit') {
      const currentUser = window.authAPI ? await window.authAPI.getCurrentUser() : null;

      if (!currentUser) {
        window.location.href = 'login.html';
        return;
      }

      const isOrganizer = currentUser.isOrganizer || currentUser.role === 'organizer';
      const targetAction = isOrganizer ? 'edit' : 'create';

      if (window.location.pathname.includes('settings.html')) {
        // Already on settings page, just handle the action
        if (targetAction === 'edit') {
          setTimeout(async () => await editOrganizerProfile(), 100);
        } else {
          setTimeout(async () => await addOrganizerProfile(), 100);
        }
      } else {
        // Redirect to settings page with parameters
        window.location.href = `settings.html?tab=organizer-profile&action=${targetAction}`;
      }
    };

    // Team Management Functions
    let currentTeamTab = 'users';
    let teamMembers = [];
    let teamRoles = [];

    async function loadTeamManagement() {
      console.log('🔄 Loading team management...');

      // Only load if team management tab is active
      if (document.getElementById('team-management').classList.contains('active')) {
        await loadTeamData();
      }
    }

    async function loadTeamData() {
      if (currentTeamTab === 'users') {
        await loadTeamMembers();
      } else {
        await loadTeamRoles();
      }
    }

    async function loadTeamMembers() {
      try {
        document.getElementById('teamUsersLoading').style.display = 'flex';
        document.getElementById('teamUsersEmptyState').style.display = 'none';
        document.getElementById('teamUsersList').style.display = 'none';

        // Fetch team members from backend
        const API_BASE_URL = window.Config?.API_BASE_URL ||
          (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:3000'
            : 'https://crowd-backend-zxxp.onrender.com');

        const token = localStorage.getItem('authToken') || localStorage.getItem('token');
        const response = await fetch(`${API_BASE_URL}/api/team/members`, {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });

        if (!response.ok) {
          throw new Error(`Team API error: ${response.status}`);
        }

        const data = await response.json();
        teamMembers = data.members || [];

        document.getElementById('teamUsersLoading').style.display = 'none';

        if (teamMembers.length === 0) {
          document.getElementById('teamUsersEmptyState').style.display = 'block';
        } else {
          document.getElementById('teamUsersList').style.display = 'block';
          renderTeamMembers();
        }

      } catch (error) {
        console.error('Error loading team members:', error);
        document.getElementById('teamUsersLoading').style.display = 'none';
        document.getElementById('teamUsersEmptyState').style.display = 'block';
      }
    }

    async function loadTeamRoles() {
      try {
        document.getElementById('teamRolesLoading').style.display = 'flex';
        document.getElementById('teamRolesList').style.display = 'none';

        // Fetch team roles from backend
        const API_BASE_URL = window.Config?.API_BASE_URL ||
          (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:3000'
            : 'https://crowd-backend-zxxp.onrender.com');

        const token = localStorage.getItem('authToken') || localStorage.getItem('token');
        const response = await fetch(`${API_BASE_URL}/api/team/roles`, {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });

        if (!response.ok) {
          throw new Error(`Team API error: ${response.status}`);
        }

        const data = await response.json();
        teamRoles = data.roles || [];

        document.getElementById('teamRolesLoading').style.display = 'none';
        document.getElementById('teamRolesList').style.display = 'block';
        renderTeamRoles();

      } catch (error) {
        console.error('Error loading team roles:', error);
        document.getElementById('teamRolesLoading').style.display = 'none';
        showTeamNotification('Failed to load team roles', 'error');
      }
    }

    function renderTeamMembers() {
      const usersList = document.getElementById('teamUsersList');
      usersList.innerHTML = teamMembers.map(member => {
        const displayName = `${member.firstName || ''} ${member.lastName || ''}`.trim() || member.email.split('@')[0];
        const roleClass = getTeamRoleClass(member.role);

        return `
          <div class="team-list-item">
            <div class="team-item-info">
              <div class="team-item-avatar ${roleClass}" 
                   onclick="showTeamRoleDetails(event, '${member.role}', ${JSON.stringify(member.permissions || {})})">
                <span class="team-role-icon"></span>
                <div class="team-role-details-popup">
                  <div class="team-role-details-title">${getTeamRoleDisplayName(member.role)}</div>
                  <div class="team-role-details-description">${getTeamRoleDescription(member.role)}</div>
                  <div class="team-role-permissions">
                    ${generateTeamPermissionsList(member.permissions || {})}
                  </div>
                </div>
              </div>
              <div>
                <div class="team-item-name">${displayName}</div>
                <div class="team-item-details">${member.email}</div>
              </div>
            </div>
            <div class="team-item-actions">
              <span class="team-role-badge">${getTeamRoleDisplayName(member.role)}</span>
              <button class="team-more-btn" onclick="showTeamUserMenu('${member.id}')">
                <i class="fas fa-ellipsis-v"></i>
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    function renderTeamRoles() {
      const rolesList = document.getElementById('teamRolesList');
      rolesList.innerHTML = teamRoles.map(role => {
        const roleClass = getTeamRoleClass(role.id || role.name.toLowerCase());

        return `
          <div class="team-list-item">
            <div class="team-item-info">
              <div class="team-item-avatar ${roleClass}" 
                   onclick="showTeamRoleDetails(event, '${role.id || role.name.toLowerCase()}', ${JSON.stringify(role.permissions || {})})">
                <span class="team-role-icon"></span>
                <div class="team-role-details-popup">
                  <div class="team-role-details-title">${role.name}</div>
                  <div class="team-role-details-description">${role.description || 'No description'}</div>
                  <div class="team-role-permissions">
                    ${generateTeamPermissionsList(role.permissions || {})}
                  </div>
                </div>
              </div>
              <div>
                <div class="team-item-name">${role.name}</div>
                <div class="team-item-details">${role.description || 'No description'}</div>
              </div>
            </div>
            <div class="team-item-actions">
              ${!role.isSystem ? `
                <span class="team-role-badge" style="background: #6b7280;">Custom</span>
              ` : ''}
              <button class="team-more-btn" onclick="showTeamRoleMenu('${role.id}')">
                <i class="fas fa-ellipsis-v"></i>
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    function switchTeamTab(tabName) {
      currentTeamTab = tabName;

      // Update sidebar active state
      const sidebarItems = document.querySelectorAll('.team-sidebar-item');
      sidebarItems.forEach(item => item.classList.remove('active'));

      const activeItem = Array.from(sidebarItems).find(item =>
        item.textContent.toLowerCase().includes(tabName)
      );
      if (activeItem) {
        activeItem.classList.add('active');
      }

      // Show/hide content
      const usersContent = document.getElementById('team-users-content');
      const rolesContent = document.getElementById('team-roles-content');

      if (tabName === 'users') {
        usersContent.classList.add('active');
        rolesContent.classList.remove('active');
        loadTeamMembers();
      } else {
        usersContent.classList.remove('active');
        rolesContent.classList.add('active');
        loadTeamRoles();
      }
    }

    // Role details functionality
    function showTeamRoleDetails(event, roleId, permissions) {
      event.stopPropagation();

      // Hide all other popups
      document.querySelectorAll('.team-role-details-popup').forEach(popup => {
        popup.classList.remove('show');
      });

      // Show the clicked popup
      const popup = event.target.closest('.team-item-avatar').querySelector('.team-role-details-popup');
      if (popup) {
        popup.classList.add('show');

        // Hide popup when clicking outside
        setTimeout(() => {
          document.addEventListener('click', function hideTeamPopup(e) {
            if (!event.target.closest('.team-item-avatar').contains(e.target)) {
              popup.classList.remove('show');
              document.removeEventListener('click', hideTeamPopup);
            }
          });
        }, 100);
      }
    }

    // Utility functions for team management
    function getTeamRoleClass(role) {
      const roleType = role.toLowerCase();
      if (['owner'].includes(roleType)) return 'owner';
      if (['admin', 'administrator'].includes(roleType)) return 'admin';
      if (['member', 'team member'].includes(roleType)) return 'member';
      if (['editor', 'event editor'].includes(roleType)) return 'editor';
      return 'custom';
    }

    function getTeamRoleDisplayName(role) {
      const displayNames = {
        owner: 'Owner',
        admin: 'Administrator',
        member: 'Team Member',
        editor: 'Event Editor'
      };
      return displayNames[role.toLowerCase()] || role;
    }

    function getTeamRoleDescription(role) {
      const descriptions = {
        owner: 'Full access to all organization features and settings',
        admin: 'Administrative access with team and event management capabilities',
        member: 'Basic team member with event creation and editing permissions',
        editor: 'Event editing and content management permissions'
      };
      return descriptions[role.toLowerCase()] || 'Custom role with specific permissions';
    }

    function generateTeamPermissionsList(permissions) {
      const permissionLabels = {
        canCreateEvents: 'Create Events',
        canEditEvents: 'Edit Events',
        canManageTeam: 'Manage Team',
        canViewAnalytics: 'View Analytics',
        canManageSettings: 'Manage Settings',
        canDeleteOrganization: 'Delete Organization'
      };

      const permissionsList = Object.entries(permissions)
        .filter(([key, value]) => value === true)
        .map(([key, value]) => `
          <div class="team-permission-item">
            <i class="fas fa-check"></i>
            ${permissionLabels[key] || key}
          </div>
        `).join('');

      return permissionsList || '<div class="team-permission-item">No specific permissions</div>';
    }

    function openInviteModal() {
      // Create and show modal
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="modal-header">
            <h3>Invite Team Members</h3>
            <button class="close-btn" onclick="closeTeamModal()">&times;</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label for="inviteEmails">Email addresses</label>
              <textarea id="inviteEmails" class="form-input" placeholder="Enter email addresses (one per line or separated by commas)" style="min-height: 100px; resize: vertical;"></textarea>
            </div>
            <div class="form-group">
              <label for="inviteRole">Role</label>
              <select id="inviteRole" class="form-select">
                <option value="member">Team Member</option>
                <option value="admin">Administrator</option>
                <option value="editor">Event Editor</option>
              </select>
            </div>
            <div class="form-group">
              <label for="inviteMessage">Personal message (optional)</label>
              <textarea id="inviteMessage" class="form-input" placeholder="Add a personal message..." style="min-height: 80px; resize: vertical;"></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn-secondary" onclick="closeTeamModal()">Cancel</button>
            <button class="btn-primary" onclick="sendTeamInvitations()">Send Invitations</button>
          </div>
        </div>
      `;

      document.body.appendChild(modal);
      modal.style.display = 'flex';
    }

    function redirectToCreateRole() {
      window.location.href = 'create-role-interface.html';
    }

    function openCreateRoleModal() {
      // Create and show modal
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="modal-header">
            <h3>Create New Role</h3>
            <button class="close-btn" onclick="closeTeamModal()">&times;</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label for="roleName">Role Name</label>
              <input type="text" id="roleName" class="form-input" placeholder="Enter role name">
            </div>
            <div class="form-group">
              <label for="roleDescription">Description</label>
              <textarea id="roleDescription" class="form-input" placeholder="Describe the role and its responsibilities" style="min-height: 80px; resize: vertical;"></textarea>
            </div>
            <div class="form-group">
              <label>Permissions</label>
              <div style="margin-top: 12px;">
                <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-weight: normal;">
                  <input type="checkbox" id="canCreateEvents"> Can create events
                </label>
                <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-weight: normal;">
                  <input type="checkbox" id="canEditEvents"> Can edit events
                </label>
                <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-weight: normal;">
                  <input type="checkbox" id="canManageTeam"> Can manage team
                </label>
                <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-weight: normal;">
                  <input type="checkbox" id="canViewAnalytics"> Can view analytics
                </label>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn-secondary" onclick="closeTeamModal()">Cancel</button>
            <button class="btn-primary" onclick="createTeamRole()">Create Role</button>
          </div>
        </div>
      `;

      document.body.appendChild(modal);
      modal.style.display = 'flex';
    }

    function closeTeamModal() {
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => {
        modal.remove();
      });
    }

    async function sendTeamInvitations() {
      const emails = document.getElementById('inviteEmails').value.trim();
      const role = document.getElementById('inviteRole').value;
      const message = document.getElementById('inviteMessage').value.trim();

      if (!emails) {
        showTeamNotification('Please enter at least one email address.', 'error');
        return;
      }

      // Parse emails
      const emailList = emails.split(/[,\n]/).map(email => email.trim()).filter(email => email);
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      const invalidEmails = emailList.filter(email => !emailRegex.test(email));

      if (invalidEmails.length > 0) {
        showTeamNotification(`Invalid email addresses: ${invalidEmails.join(', ')}`, 'error');
        return;
      }

      try {
        const API_BASE_URL = window.Config?.API_BASE_URL ||
          (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:3000'
            : 'https://crowd-backend-zxxp.onrender.com');

        const token = localStorage.getItem('authToken') || localStorage.getItem('token');
        const response = await fetch(`${API_BASE_URL}/api/team/invite`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            emails: emailList,
            role: role,
            message: message
          })
        });

        if (!response.ok) {
          throw new Error(`Invite API error: ${response.status}`);
        }

        const data = await response.json();

        closeTeamModal();
        showTeamNotification(`Invitations sent to ${emailList.length} email${emailList.length > 1 ? 's' : ''}!`);

        // Reload team members
        if (currentTeamTab === 'users') {
          await loadTeamMembers();
        }

      } catch (error) {
        console.error('Error sending invitations:', error);
        showTeamNotification('Failed to send invitations', 'error');
      }
    }

    async function createTeamRole() {
      const name = document.getElementById('roleName').value.trim();
      const description = document.getElementById('roleDescription').value.trim();

      if (!name) {
        showTeamNotification('Please enter a role name.', 'error');
        return;
      }

      // Get permissions
      const permissions = {
        canCreateEvents: document.getElementById('canCreateEvents').checked,
        canEditEvents: document.getElementById('canEditEvents').checked,
        canManageTeam: document.getElementById('canManageTeam').checked,
        canViewAnalytics: document.getElementById('canViewAnalytics').checked
      };

      try {
        const API_BASE_URL = window.Config?.API_BASE_URL ||
          (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:3000'
            : 'https://crowd-backend-zxxp.onrender.com');

        const token = localStorage.getItem('authToken') || localStorage.getItem('token');
        const response = await fetch(`${API_BASE_URL}/api/team/roles`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            name: name,
            description: description,
            permissions: permissions
          })
        });

        if (!response.ok) {
          throw new Error(`Role API error: ${response.status}`);
        }

        const data = await response.json();

        closeTeamModal();
        showTeamNotification(`Role "${name}" created successfully!`);

        // Reload team roles
        if (currentTeamTab === 'roles') {
          await loadTeamRoles();
        }

      } catch (error) {
        console.error('Error creating role:', error);
        showTeamNotification('Failed to create role', 'error');
      }
    }

    function showTeamRoleMenu(roleId) {
      console.log('Show role menu for:', roleId);
      // TODO: Implement role menu functionality
    }

    function showTeamUserMenu(userId) {
      console.log('Show user menu for:', userId);
      // TODO: Implement user menu functionality
    }

    function showTeamNotification(message, type = 'success') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'error' ? '#dc2626' : '#10b981'};
        color: white;
        padding: 16px 24px;
        border-radius: 8px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        z-index: 1001;
        font-weight: 500;
        max-width: 400px;
        transform: translateX(100px);
        opacity: 0;
        transition: all 0.3s ease;
      `;
      notification.textContent = message;

      document.body.appendChild(notification);

      // Trigger animation
      setTimeout(() => {
        notification.style.transform = 'translateX(0)';
        notification.style.opacity = '1';
      }, 100);

      // Remove notification after 4 seconds
      setTimeout(() => {
        notification.style.transform = 'translateX(100px)';
        notification.style.opacity = '0';
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 4000);
    }

    // Help Center Navigation
    function navigateToHelpCenter() {
      console.log('Navigating to help center from settings page...');
      // Set organizer context flag
      localStorage.setItem('organizerContext', 'true');
      // Navigate to logged-in help center directly
      window.location.href = 'Help_center_logged_in.html';
    }

    // Enhanced Profile Management Functions
    async function showProfileOptions() {
      try {
        const currentUser = window.authAPI ? await window.authAPI.getCurrentUser() : null;
        
        if (!currentUser) {
          alert('Please log in to manage your profile.');
          window.location.href = 'login.html';
          return;
        }

        // Check if user has existing organizer profile
        const existingProfile = await fetchOrganizerProfile(currentUser.id);
        
        if (existingProfile) {
          // Show options: Edit existing or Create new
          showProfileOptionsModal(existingProfile);
        } else {
          // No existing profile, go straight to create
          await createNewOrganizerProfile();
        }
      } catch (error) {
        console.error('Error checking profile:', error);
        showNotification('Error checking profile status', 'error');
      }
    }

    function showProfileOptionsModal(existingProfile) {
      const modal = createProfileOptionsModal(existingProfile);
      document.body.appendChild(modal);
    }

    function createProfileOptionsModal(existingProfile) {
      const modalHtml = `
        <div class="profile-options-modal" style="
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 1000;
        ">
          <div class="profile-options-content" style="
            background: white;
            border-radius: 12px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
          ">
            <h2 style="margin-bottom: 16px; color: #1a1a1a;">Profile Options</h2>
            <p style="color: #666; margin-bottom: 24px;">You have an existing organizer profile "${existingProfile.name}". Choose an option:</p>
            
            <div class="profile-option-buttons" style="display: flex; flex-direction: column; gap: 12px;">
              <button class="profile-option-btn" onclick="editExistingProfile('${existingProfile.id}')" style="
                background: #ff5722;
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 8px;
                font-weight: 600;
                cursor: pointer;
                font-size: 14px;
              ">
                Edit Existing Profile
              </button>
              
              <button class="profile-option-btn" onclick="createNewOrganizerProfile()" style="
                background: white;
                color: #374151;
                border: 1px solid #d1d5db;
                padding: 12px 24px;
                border-radius: 8px;
                font-weight: 600;
                cursor: pointer;
                font-size: 14px;
              ">
                Create New Profile
              </button>
              
              <button class="profile-option-btn" onclick="closeProfileOptionsModal()" style="
                background: none;
                color: #666;
                border: none;
                padding: 8px;
                cursor: pointer;
                font-size: 14px;
              ">
                Cancel
              </button>
            </div>
          </div>
        </div>
      `;
      
      const modalElement = document.createElement('div');
      modalElement.innerHTML = modalHtml;
      modalElement.className = 'profile-options-modal-wrapper';
      
      return modalElement.firstElementChild;
    }

    function closeProfileOptionsModal() {
      const modal = document.querySelector('.profile-options-modal');
      if (modal) {
        modal.remove();
      }
    }

    async function editExistingProfile(profileId) {
      closeProfileOptionsModal();
      try {
        // Load existing profile data
        const profileData = await fetchOrganizerProfile(profileId);
        if (profileData) {
          populateEditForm(profileData);
          document.getElementById("editModal").style.display = "flex";
          
          // Update modal for editing mode
          const modalTitle = document.querySelector('#editModal .modal-body h1');
          const saveButton = document.querySelector('#editModal .primary-btn');
          
          modalTitle.textContent = 'Edit Organizer Profile';
          saveButton.textContent = 'Save Changes';
          saveButton.setAttribute('data-profile-id', profileId);
        }
      } catch (error) {
        console.error('Error loading profile for editing:', error);
        showNotification('Error loading profile data', 'error');
      }
    }

    async function createNewOrganizerProfile() {
      closeProfileOptionsModal();
      
      // Clear form and show modal
      clearEditForm();
      document.getElementById("editModal").style.display = "flex";
      
      // Update modal for create mode
      const modalTitle = document.querySelector('#editModal .modal-body h1');
      const saveButton = document.querySelector('#editModal .primary-btn');
      
      modalTitle.textContent = 'Create Organizer Profile';
      saveButton.textContent = 'Create Profile';
      saveButton.removeAttribute('data-profile-id');
    }

    function populateEditForm(profileData) {
      // Populate form fields with existing data
      if (profileData.name) document.getElementById("editOrganizerName").value = profileData.name;
      if (profileData.website) document.getElementById("organizerWebsite").value = profileData.website;
      if (profileData.bio) document.getElementById("organizerBio").innerHTML = profileData.bio;
      if (profileData.eventDescription) document.getElementById("eventDescription").innerHTML = profileData.eventDescription;
      if (profileData.facebookId) document.getElementById("facebookId").value = profileData.facebookId;
      if (profileData.twitterHandle) document.getElementById("twitterHandle").value = profileData.twitterHandle;
      if (profileData.organizationName) document.getElementById("organizationName").value = profileData.organizationName;
      
      // Handle checkbox
      document.getElementById("emailOptIn").checked = profileData.emailOptIn || false;
    }

    function clearEditForm() {
      // Clear all form fields
      document.getElementById("editOrganizerName").value = '';
      document.getElementById("organizerWebsite").value = '';
      document.getElementById("organizerBio").innerHTML = '';
      document.getElementById("eventDescription").innerHTML = '';
      document.getElementById("facebookId").value = '';
      document.getElementById("twitterHandle").value = '';
      document.getElementById("organizationName").value = '';
      document.getElementById("emailOptIn").checked = true;
    }

    async function fetchOrganizerProfile(userId) {
      try {
        const response = await fetch(`${window.Config?.API_BASE_URL || 'http://localhost:5000/api'}/organizer/profile/${userId}`, {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('authToken')}`,
            'Content-Type': 'application/json'
          }
        });

        if (response.ok) {
          const data = await response.json();
          return data.profile;
        } else if (response.status === 404) {
          return null; // No profile exists
        } else {
          throw new Error('Failed to fetch profile');
        }
      } catch (error) {
        console.error('Error fetching organizer profile:', error);
        return null;
      }
    }

    // Enhanced saveOrganizerProfile function
    async function saveOrganizerProfileEnhanced() {
      const saveButton = document.querySelector('#editModal .primary-btn');
      const profileId = saveButton.getAttribute('data-profile-id');
      const isEditing = !!profileId;
      
      // Show loading state
      const originalText = saveButton.textContent;
      saveButton.textContent = isEditing ? 'Saving...' : 'Creating...';
      saveButton.disabled = true;

      try {
        // Get form data
        const profileData = {
          name: document.getElementById("editOrganizerName").value,
          website: document.getElementById("organizerWebsite").value,
          bio: document.getElementById("organizerBio").innerHTML,
          eventDescription: document.getElementById("eventDescription").innerHTML,
          facebookId: document.getElementById("facebookId").value,
          twitterHandle: document.getElementById("twitterHandle").value,
          emailOptIn: document.getElementById("emailOptIn").checked,
          organizationName: document.getElementById("organizationName").value,
          preferredCountry: document.getElementById("preferredCountry").value
        };

        // Validation
        if (!profileData.name.trim()) {
          throw new Error('Organizer name is required');
        }

        const url = isEditing 
          ? `${window.Config?.API_BASE_URL || 'http://localhost:5000/api'}/organizer/profile/${profileId}`
          : `${window.Config?.API_BASE_URL || 'http://localhost:5000/api'}/organizer/profile`;
          
        const method = isEditing ? 'PUT' : 'POST';

        const response = await fetch(url, {
          method: method,
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('authToken')}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(profileData)
        });

        if (response.ok) {
          const result = await response.json();
          
          // Update UI
          const organizerNameDisplay = document.getElementById('organizerName');
          if (organizerNameDisplay) {
            organizerNameDisplay.textContent = profileData.name;
          }
          
          // Close modal
          document.getElementById("editModal").style.display = "none";
          
          // Show success message
          showNotification(
            isEditing ? 'Profile updated successfully!' : 'Profile created successfully!', 
            'success'
          );
          
          // Refresh organizer status
          await checkOrganizerStatus();
          
        } else {
          const error = await response.json();
          throw new Error(error.message || 'Failed to save profile');
        }
        
      } catch (error) {
        console.error('Error saving profile:', error);
        showNotification(error.message || 'Error saving profile', 'error');
      } finally {
        // Reset button state
        saveButton.textContent = originalText;
        saveButton.disabled = false;
      }
    }

    // Update the existing edit button to use the enhanced function
    async function editOrganizerProfile() {
      await showProfileOptions();
    }

    // Update the existing add button to use the enhanced function
    async function addOrganizerProfile() {
      await createNewOrganizerProfile();
    }

    // Override the existing save function
    async function saveOrganizerProfile() {
      await saveOrganizerProfileEnhanced();
    }

    // URL Slug Management Functions
    function toggleUrlSlugEdit() {
      const urlSlugSpan = document.getElementById('organizerUrlSlug');
      const urlSlugInput = document.getElementById('editUrlSlugInput');
      const editBtn = document.querySelector('.edit-url-btn');
      const copyBtn = document.querySelector('.copy-url-btn');
      const saveBtn = document.querySelector('.save-url-btn');
      const cancelBtn = document.querySelector('.cancel-url-btn');

      if (urlSlugInput.style.display === 'none') {
        // Enter edit mode
        urlSlugInput.value = urlSlugSpan.textContent;
        urlSlugSpan.style.display = 'none';
        urlSlugInput.style.display = 'inline-block';
        editBtn.style.display = 'none';
        copyBtn.style.display = 'none';
        saveBtn.style.display = 'inline-block';
        cancelBtn.style.display = 'inline-block';
        urlSlugInput.focus();
      }
    }

    function cancelUrlSlugEdit() {
      const urlSlugSpan = document.getElementById('organizerUrlSlug');
      const urlSlugInput = document.getElementById('editUrlSlugInput');
      const editBtn = document.querySelector('.edit-url-btn');
      const copyBtn = document.querySelector('.copy-url-btn');
      const saveBtn = document.querySelector('.save-url-btn');
      const cancelBtn = document.querySelector('.cancel-url-btn');

      // Exit edit mode
      urlSlugSpan.style.display = 'inline';
      urlSlugInput.style.display = 'none';
      editBtn.style.display = 'inline-block';
      copyBtn.style.display = 'inline-block';
      saveBtn.style.display = 'none';
      cancelBtn.style.display = 'none';
    }

    async function saveUrlSlug() {
      const urlSlugInput = document.getElementById('editUrlSlugInput');
      const urlSlugSpan = document.getElementById('organizerUrlSlug');
      const newSlug = urlSlugInput.value.trim();

      // Validate URL slug
      const slugRegex = /^[a-zA-Z0-9-_]+$/;
      if (!newSlug) {
        showNotification('URL slug cannot be empty', 'error');
        return;
      }

      if (!slugRegex.test(newSlug)) {
        showNotification('URL slug can only contain letters, numbers, dashes, and underscores', 'error');
        return;
      }

      try {
        const API_BASE_URL = window.Config?.API_BASE_URL ||
          (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:3000'
            : 'https://crowd-backend-zxxp.onrender.com');

        const token = localStorage.getItem('authToken') || localStorage.getItem('token');

        // Check if slug is available
        const checkResponse = await fetch(`${API_BASE_URL}/api/organizer/check-slug/${newSlug}`, {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        });

        const checkData = await checkResponse.json();

        if (!checkData.available) {
          showNotification('This URL slug is already taken. Please choose another.', 'error');
          return;
        }

        // Update URL slug
        const updateResponse = await fetch(`${API_BASE_URL}/api/organizer/profile`, {
          method: 'PUT',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ urlSlug: newSlug })
        });

        if (!updateResponse.ok) {
          throw new Error('Failed to update URL slug');
        }

        // Update display
        urlSlugSpan.textContent = newSlug;
        cancelUrlSlugEdit();
        showNotification('URL slug updated successfully!', 'success');

      } catch (error) {
        console.error('Error updating URL slug:', error);
        showNotification('Failed to update URL slug: ' + error.message, 'error');
      }
    }

    async function copyOrganizerUrl() {
      const urlSlug = document.getElementById('organizerUrlSlug').textContent;
      const fullUrl = `https://www.crowd.com/o/${urlSlug}`;

      try {
        await navigator.clipboard.writeText(fullUrl);

        // Visual feedback
        const copyBtn = document.querySelector('.copy-url-btn');
        const originalHTML = copyBtn.innerHTML;

        copyBtn.innerHTML = `
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
        `;

        showNotification('URL copied to clipboard!', 'success');

        setTimeout(() => {
          copyBtn.innerHTML = originalHTML;
        }, 2000);

      } catch (error) {
        console.error('Failed to copy URL:', error);

        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = fullUrl;
        textArea.style.position = 'fixed';
        textArea.style.left = '-999999px';
        document.body.appendChild(textArea);
        textArea.select();

        try {
          document.execCommand('copy');
          showNotification('URL copied to clipboard!', 'success');
        } catch (err) {
          showNotification('Failed to copy URL. Please copy manually.', 'error');
        }

        document.body.removeChild(textArea);
      }
    }

    // Image Upload Functionality
    async function handleImageUpload(file, uploadType) {
      if (!file) return null;

      // Validate file
      const validTypes = ['image/jpeg', 'image/png', 'image/jpg'];
      const maxSize = 10 * 1024 * 1024; // 10MB

      if (!validTypes.includes(file.type)) {
        showNotification('Please upload a JPEG or PNG image', 'error');
        return null;
      }

      if (file.size > maxSize) {
        showNotification('Image size must be less than 10MB', 'error');
        return null;
      }

      try {
        // Convert to base64 for now (in production, upload to cloud storage)
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = (e) => resolve(e.target.result);
          reader.onerror = reject;
          reader.readAsDataURL(file);
        });
      } catch (error) {
        console.error('Error uploading image:', error);
        showNotification('Failed to upload image', 'error');
        return null;
      }
    }

    // Update logo upload handler
    document.getElementById("logoUpload").addEventListener("change", async function (e) {
      const file = e.target.files[0];
      if (file) {
        const logoData = await handleImageUpload(file, 'logo');
        if (logoData) {
          // Store logo data (in production, this would be uploaded to cloud storage)
          console.log("Logo uploaded successfully");
          showNotification("Logo uploaded successfully! Save your profile to apply changes.", 'success');
          // You can store it temporarily and upload it when saving the profile
          window.tempLogoData = logoData;
        }
      }
    });

    // Update profile image upload handler
    document.getElementById("profileImageUpload").addEventListener("change", async function (e) {
      const file = e.target.files[0];
      if (file) {
        const imageData = await handleImageUpload(file, 'profileImage');
        if (imageData) {
          // Show preview
          const uploadPlaceholder = document.querySelector('.upload-placeholder');
          if (uploadPlaceholder) {
            uploadPlaceholder.innerHTML = `<img src="${imageData}" style="max-width: 200px; max-height: 200px; border-radius: 8px;">`;
          }
          console.log("Profile image uploaded successfully");
          showNotification("Profile image uploaded! Save your profile to apply changes.", 'success');
          // Store temporarily
          window.tempProfileImageData = imageData;
        }
      }
    });

    // Social Media Validation Functions
    function validateFacebookId(input) {
      const value = input.value.trim();
      const errorSpan = document.getElementById('facebookIdError');

      if (!value) {
        errorSpan.style.display = 'none';
        return true;
      }

      // Facebook ID can be numeric or alphanumeric
      const facebookRegex = /^[a-zA-Z0-9.]+$/;

      if (!facebookRegex.test(value)) {
        errorSpan.textContent = 'Invalid Facebook ID format';
        errorSpan.style.display = 'block';
        input.style.borderColor = '#dc2626';
        return false;
      }

      errorSpan.style.display = 'none';
      input.style.borderColor = '#d1d5db';
      return true;
    }

    function validateTwitterHandle(input) {
      const value = input.value.trim();
      const errorSpan = document.getElementById('twitterHandleError');

      if (!value) {
        errorSpan.style.display = 'none';
        return true;
      }

      // Twitter handle: alphanumeric and underscore, 1-15 characters, no @ prefix needed
      const twitterRegex = /^[a-zA-Z0-9_]{1,15}$/;

      // Remove @ if user included it
      const cleanValue = value.replace(/^@/, '');
      input.value = cleanValue;

      if (!twitterRegex.test(cleanValue)) {
        errorSpan.textContent = 'Twitter handle must be 1-15 characters, letters, numbers, and underscores only';
        errorSpan.style.display = 'block';
        input.style.borderColor = '#dc2626';
        return false;
      }

      errorSpan.style.display = 'none';
      input.style.borderColor = '#d1d5db';
      return true;
    }

    // Website URL Validation
    function validateWebsiteUrl(input) {
      const value = input.value.trim();

      if (!value) {
        return true;
      }

      try {
        new URL(value);
        input.style.borderColor = '#d1d5db';
        return true;
      } catch (e) {
        input.style.borderColor = '#dc2626';
        showNotification('Please enter a valid URL (e.g., https://example.com)', 'error');
        return false;
      }
    }

    // Add validation to website field
    const websiteInput = document.getElementById('organizerWebsite');
    if (websiteInput) {
      websiteInput.addEventListener('blur', function() {
        validateWebsiteUrl(this);
      });
    }
  </script>

  <!-- Team Management Modal Styles -->
  <style>
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: white;
      width: 90%;
      max-width: 500px;
      border-radius: 8px;
      overflow: hidden;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 24px;
      border-bottom: 1px solid #e5e5e5;
    }

    .modal-header h3 {
      margin: 0;
      font-size: 20px;
      color: #1a1a1a;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 24px;
      color: #666;
      cursor: pointer;
    }

    .modal-body {
      padding: 24px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-weight: 500;
      color: #374151;
      margin-bottom: 6px;
    }

    .form-input {
      width: 100%;
      padding: 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 16px;
      transition: border-color 0.2s;
    }

    .form-input:focus {
      outline: none;
      border-color: #f05537;
      box-shadow: 0 0 0 3px rgba(240, 85, 55, 0.1);
    }

    .form-select {
      width: 100%;
      padding: 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 16px;
      background: white;
      cursor: pointer;
    }

    .modal-footer {
      padding: 16px 24px;
      border-top: 1px solid #e5e5e5;
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    .btn-secondary {
      background: white;
      border: 1px solid #d1d5db;
      padding: 12px 24px;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      color: #374151;
    }

    .btn-secondary:hover {
      background: #f9fafb;
    }

    .btn-primary {
      background: #f05537;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
    }

    .btn-primary:hover {
      background: #e04527;
    }
  </style>
</body>

</html>