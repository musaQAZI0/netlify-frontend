<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reporting - Crowd</title>
    <link rel="stylesheet" href="reporting-styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/data-manager.js"></script>
  </head>
  <body>
    <div class="dashboard-container">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <div class="logo">
            <img src="logo.jpg" alt="Crowd Logo" class="logo-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div style="display: none; align-items: center; gap: 0.25rem;">
              <span class="logo-icon">üéüÔ∏è</span>
              <span class="logo-text">crowd</span>
            </div>
          </div>
        </div>

        <nav class="sidebar-nav">
          <a href="dashboard-home.html" class="nav-item">
            <i class="fas fa-home"></i>
          </a>
          <a href="events-calendar.html" class="nav-item">
            <i class="fas fa-calendar"></i>
          </a>
          <a href="orders.html" class="nav-item">
            <i class="fas fa-file-alt"></i>
          </a>
          <a href="marketing.html" class="nav-item">
            <i class="fas fa-bullhorn"></i>
          </a>
          <a href="analytics.html" class="nav-item">
            <i class="fas fa-chart-bar"></i>
          </a>
          <a href="finance.html" class="nav-item active">
            <i class="fas fa-university"></i>
          </a>
          <a href="settings.html" class="nav-item">
            <i class="fas fa-cog"></i>
          </a>
        </nav>

        <div class="sidebar-footer">
          <a href="#" class="nav-item">
            <i class="fas fa-th"></i>
          </a>
          <a href="#" class="nav-item">
            <i class="fas fa-question-circle"></i>
          </a>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Header -->
        <header class="header">
          <div class="header-content">
            <div class="header-left">
              <div class="logo-text">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="#f97316">
                  <path
                    d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"
                  />
                </svg>
                <span>crowd</span>
              </div>
            </div>
            <div class="header-right">
              <button
                class="create-btn"
                onclick="window.location.href='event-builder.html'"
              >
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <line x1="12" x2="12" y1="5" y2="19" />
                  <line x1="5" x2="19" y1="12" y2="12" />
                </svg>
                Create
              </button>
              <div class="user-menu">
                <div class="user-avatar" id="userAvatar">AA</div>
                <span class="user-name" id="userName">abdul ahad</span>
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="currentColor"
                >
                  <path d="M7 10l5 5 5-5z" />
                </svg>
              </div>
            </div>
          </div>
        </header>

        <!-- Content Area -->
        <div class="content-area">
          <!-- Empty State -->
          <div class="empty-state" id="emptyState">
            <div class="empty-illustration">
              <svg width="120" height="120" viewBox="0 0 120 120" fill="none">
                <circle
                  cx="60"
                  cy="45"
                  r="25"
                  fill="none"
                  stroke="#9ca3af"
                  stroke-width="2"
                />
                <circle cx="52" cy="40" r="2" fill="#9ca3af" />
                <circle cx="68" cy="40" r="2" fill="#9ca3af" />
                <path
                  d="M52 52 Q60 58 68 52"
                  fill="none"
                  stroke="#9ca3af"
                  stroke-width="2"
                  stroke-linecap="round"
                />
                <path
                  d="M35 70 Q35 45 60 45 Q85 45 85 70 L85 95 Q82 92 79 95 Q76 98 73 95 Q70 92 67 95 Q64 98 61 95 Q58 92 55 95 Q52 98 49 95 Q46 92 43 95 Q40 98 37 95 Q35 92 35 95 Z"
                  fill="none"
                  stroke="#9ca3af"
                  stroke-width="2"
                />
                <circle cx="45" cy="105" r="1" fill="#d1d5db" />
                <circle cx="55" cy="108" r="1" fill="#d1d5db" />
                <circle cx="65" cy="105" r="1" fill="#d1d5db" />
                <circle cx="75" cy="108" r="1" fill="#d1d5db" />
              </svg>
            </div>
            <h2>Nothing to report</h2>
            <p>Your reports will be available after you sell some tickets.</p>
          </div>

          <!-- Reporting Dashboard -->
          <div
            class="reporting-dashboard"
            id="reportingDashboard"
            style="display: none"
          >
            <!-- Page Header -->
            <div class="page-header">
              <h1>Reporting</h1>
              <div class="header-controls">
                <select class="time-filter" id="timeFilter">
                  <option value="7">Last 7 days</option>
                  <option value="30" selected>Last 30 days</option>
                  <option value="90">Last 90 days</option>
                  <option value="365">Last year</option>
                </select>
                <button class="refresh-btn" onclick="refreshData()">
                  <svg
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                  >
                    <path
                      d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"
                    />
                    <path d="M21 3v5h-5" />
                    <path
                      d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"
                    />
                    <path d="M8 16H3v5" />
                  </svg>
                  Refresh
                </button>
              </div>
            </div>

            <!-- Summary Cards -->
            <div class="summary-cards">
              <div class="summary-card">
                <div class="card-header">
                  <h3>Total Revenue</h3>
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="#10b981"
                  >
                    <path
                      d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"
                    />
                  </svg>
                </div>
                <div class="card-value" id="totalRevenue">$0</div>
                <div class="card-change" id="revenueChange">
                  No previous data
                </div>
              </div>

              <div class="summary-card">
                <div class="card-header">
                  <h3>Tickets Sold</h3>
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="#3b82f6"
                  >
                    <path d="M9 12l2 2 4-4" />
                    <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3" />
                    <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3" />
                  </svg>
                </div>
                <div class="card-value" id="totalTickets">0</div>
                <div class="card-change" id="ticketsChange">
                  No previous data
                </div>
              </div>

              <div class="summary-card">
                <div class="card-header">
                  <h3>Total Events</h3>
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="#f59e0b"
                  >
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                    <line x1="16" x2="16" y1="2" y2="6" />
                    <line x1="8" x2="8" y1="2" y2="6" />
                    <line x1="3" x2="21" y1="10" y2="10" />
                  </svg>
                </div>
                <div class="card-value" id="totalEvents">0</div>
                <div class="card-change" id="eventsChange">0 published</div>
              </div>

              <div class="summary-card">
                <div class="card-header">
                  <h3>Avg. Ticket Price</h3>
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="#8b5cf6"
                  >
                    <path d="M3 3v18h18" />
                    <path d="M7 12l3-3 4 4 5-5" />
                  </svg>
                </div>
                <div class="card-value" id="avgTicketPrice">$0</div>
                <div class="card-change" id="priceChange">
                  Across all events
                </div>
              </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-section">
              <!-- Sales by Month -->
              <div class="chart-container">
                <div class="chart-header">
                  <h3>Sales by Month</h3>
                  <select class="year-filter" id="yearFilter">
                    <option value="2024">2024</option>
                    <option value="2025" selected>2025</option>
                  </select>
                </div>
                <div class="chart-wrapper">
                  <canvas id="salesByMonthChart"></canvas>
                </div>
              </div>

              <!-- Top Performing Events -->
              <div class="chart-container">
                <div class="chart-header">
                  <h3>Top Performing Events</h3>
                  <div class="chart-controls">
                    <button class="metric-toggle active" data-metric="tickets">
                      Tickets
                    </button>
                    <button class="metric-toggle" data-metric="revenue">
                      Revenue
                    </button>
                  </div>
                </div>
                <div class="chart-wrapper">
                  <canvas id="topEventsChart"></canvas>
                </div>
              </div>
            </div>

            <!-- Revenue Breakdown -->
            <div class="charts-section">
              <div class="chart-container">
                <div class="chart-header">
                  <h3>Revenue by Ticket Type</h3>
                </div>
                <div class="chart-wrapper">
                  <canvas id="revenueBreakdownChart"></canvas>
                </div>
              </div>

              <!-- Event Performance Table -->
              <div class="table-container">
                <div class="table-header">
                  <h3>Event Performance</h3>
                  <div class="table-controls">
                    <input
                      type="text"
                      placeholder="Search events..."
                      class="search-input"
                      id="eventSearch"
                    />
                    <select class="status-filter" id="statusFilter">
                      <option value="">All Status</option>
                      <option value="published">Published</option>
                      <option value="draft">Draft</option>
                    </select>
                  </div>
                </div>
                <div class="table-wrapper">
                  <table class="events-table" id="eventsTable">
                    <thead>
                      <tr>
                        <th>Event</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Tickets Sold</th>
                        <th>Revenue</th>
                        <th>Conversion</th>
                      </tr>
                    </thead>
                    <tbody id="eventsTableBody">
                      <!-- Table rows will be populated by JavaScript -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script>
      let salesChart, topEventsChart, revenueChart;
      let currentMetric = "tickets";
      let reportingData = {
        totalRevenue: 0,
        totalTickets: 0,
        totalEvents: 0,
        publishedEvents: 0,
        avgTicketPrice: 0,
        monthlyData: [],
        topEvents: [],
        revenueBreakdown: [],
      };

      document.addEventListener("DOMContentLoaded", function () {
        // Check authentication
        if (!window.dataManager.isAuthenticated()) {
          window.location.href = "login.html";
          return;
        }

        loadUserData();
        loadReportingData();
        setupEventListeners();
      });

      function loadUserData() {
        const currentUser = window.dataManager.getCurrentUser();
        if (currentUser) {
          const initials = (
            currentUser.firstName.charAt(0) + currentUser.lastName.charAt(0)
          ).toUpperCase();
          document.getElementById("userAvatar").textContent = initials;
          document.getElementById(
            "userName"
          ).textContent = `${currentUser.firstName} ${currentUser.lastName}`;
        }
      }

      function loadReportingData() {
        const orders = window.dataManager.getOrdersForOrganizer();
        const events = window.dataManager.getUserEvents();
        const timeFilter = parseInt(
          document.getElementById("timeFilter").value
        );

        // Filter orders by time period
        const cutoffDate = new Date();
        cutoffDate.setDate(cutoffDate.getDate() - timeFilter);
        const filteredOrders = orders.filter(
          (order) => new Date(order.orderDate) >= cutoffDate
        );

        if (
          filteredOrders.length === 0 &&
          events.filter((e) => e.status === "published").length === 0
        ) {
          showEmptyState();
        } else {
          showReportingDashboard();
          calculateReportingData(filteredOrders, events);
          updateSummaryCards();
          createCharts();
          populateEventsTable(events, orders);
        }
      }

      function calculateReportingData(orders, events) {
        // Calculate totals from actual data
        reportingData.totalRevenue = orders.reduce(
          (sum, order) => sum + (order.total || 0),
          0
        );
        reportingData.totalTickets = orders.reduce(
          (sum, order) => sum + (order.ticketQuantity || 0),
          0
        );
        reportingData.totalEvents = events.length;
        reportingData.publishedEvents = events.filter(
          (e) => e.status === "published"
        ).length;
        reportingData.avgTicketPrice =
          reportingData.totalTickets > 0
            ? reportingData.totalRevenue / reportingData.totalTickets
            : 0;

        // Calculate monthly data
        reportingData.monthlyData = calculateMonthlyData(orders);

        // Calculate top events
        reportingData.topEvents = calculateTopEvents(events, orders);

        // Calculate revenue breakdown
        reportingData.revenueBreakdown = calculateRevenueBreakdown(orders);
      }

      function calculateMonthlyData(orders) {
        const monthlyData = {};
        const months = [
          "Jan",
          "Feb",
          "Mar",
          "Apr",
          "May",
          "Jun",
          "Jul",
          "Aug",
          "Sep",
          "Oct",
          "Nov",
          "Dec",
        ];

        // Initialize all months with 0
        months.forEach((month) => {
          monthlyData[month] = { tickets: 0, revenue: 0 };
        });

        orders.forEach((order) => {
          const date = new Date(order.orderDate);
          const month = months[date.getMonth()];
          monthlyData[month].tickets += order.ticketQuantity || 0;
          monthlyData[month].revenue += order.total || 0;
        });

        return Object.entries(monthlyData).map(([month, data]) => ({
          month,
          tickets: data.tickets,
          revenue: data.revenue,
        }));
      }

      function calculateTopEvents(events, orders) {
        const eventStats = {};

        events.forEach((event) => {
          eventStats[event.id] = {
            id: event.id,
            name: event.title,
            date: event.date,
            status: event.status,
            tickets: 0,
            revenue: 0,
            capacity: event.capacity || 0,
          };
        });

        orders.forEach((order) => {
          if (eventStats[order.eventId]) {
            eventStats[order.eventId].tickets += order.ticketQuantity || 0;
            eventStats[order.eventId].revenue += order.total || 0;
          }
        });

        return Object.values(eventStats)
          .sort((a, b) => b.tickets - a.tickets)
          .slice(0, 10);
      }

      function calculateRevenueBreakdown(orders) {
        const breakdown = {};

        orders.forEach((order) => {
          const ticketType = order.ticketType || "General";
          if (!breakdown[ticketType]) {
            breakdown[ticketType] = 0;
          }
          breakdown[ticketType] += order.total || 0;
        });

        const total = Object.values(breakdown).reduce(
          (sum, val) => sum + val,
          0
        );

        return Object.entries(breakdown).map(([type, revenue]) => ({
          type,
          revenue,
          percentage: total > 0 ? ((revenue / total) * 100).toFixed(1) : 0,
        }));
      }

      function showEmptyState() {
        document.getElementById("emptyState").style.display = "flex";
        document.getElementById("reportingDashboard").style.display = "none";
      }

      function showReportingDashboard() {
        document.getElementById("emptyState").style.display = "none";
        document.getElementById("reportingDashboard").style.display = "block";
      }

      function updateSummaryCards() {
        document.getElementById(
          "totalRevenue"
        ).textContent = `$${reportingData.totalRevenue.toFixed(2)}`;
        document.getElementById("totalTickets").textContent =
          reportingData.totalTickets.toLocaleString();
        document.getElementById("totalEvents").textContent =
          reportingData.totalEvents.toString();
        document.getElementById(
          "avgTicketPrice"
        ).textContent = `$${reportingData.avgTicketPrice.toFixed(2)}`;

        // Update change indicators
        document.getElementById("revenueChange").textContent =
          reportingData.totalRevenue > 0
            ? `From ${reportingData.totalTickets} ticket sales`
            : "No sales yet";
        document.getElementById("ticketsChange").textContent =
          reportingData.totalTickets > 0
            ? `Across ${reportingData.publishedEvents} published events`
            : "No tickets sold";
        document.getElementById(
          "eventsChange"
        ).textContent = `${reportingData.publishedEvents} published`;
        document.getElementById("priceChange").textContent =
          "Across all events";
      }

      function createCharts() {
        createSalesByMonthChart();
        createTopEventsChart();
        createRevenueBreakdownChart();
      }

      function createSalesByMonthChart() {
        const ctx = document
          .getElementById("salesByMonthChart")
          .getContext("2d");

        const ticketData = reportingData.monthlyData.map((d) => d.tickets);
        const revenueData = reportingData.monthlyData.map((d) => d.revenue);
        const labels = reportingData.monthlyData.map((d) => d.month);

        if (salesChart) salesChart.destroy();

        salesChart = new Chart(ctx, {
          type: "line",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Tickets Sold",
                data: ticketData,
                borderColor: "#3b82f6",
                backgroundColor: "rgba(59, 130, 246, 0.1)",
                tension: 0.4,
                fill: true,
              },
              {
                label: "Revenue ($)",
                data: revenueData,
                borderColor: "#10b981",
                backgroundColor: "rgba(16, 185, 129, 0.1)",
                tension: 0.4,
                fill: true,
                yAxisID: "y1",
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "top",
              },
            },
            scales: {
              y: {
                type: "linear",
                display: true,
                position: "left",
                title: {
                  display: true,
                  text: "Tickets",
                },
              },
              y1: {
                type: "linear",
                display: true,
                position: "right",
                title: {
                  display: true,
                  text: "Revenue ($)",
                },
                grid: {
                  drawOnChartArea: false,
                },
              },
            },
          },
        });
      }

      function createTopEventsChart() {
        const ctx = document.getElementById("topEventsChart").getContext("2d");

        const topEventsData = reportingData.topEvents.slice(0, 5);
        const labels = topEventsData.map((e) =>
          e.name.length > 20 ? e.name.substring(0, 20) + "..." : e.name
        );
        const data = topEventsData.map((e) => e[currentMetric]);

        if (topEventsChart) topEventsChart.destroy();

        topEventsChart = new Chart(ctx, {
          type: "bar",
          data: {
            labels: labels,
            datasets: [
              {
                label:
                  currentMetric === "tickets" ? "Tickets Sold" : "Revenue ($)",
                data: data,
                backgroundColor: "#f97316",
                borderColor: "#ea580c",
                borderWidth: 1,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false,
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: currentMetric === "tickets" ? "Tickets" : "Revenue ($)",
                },
              },
            },
          },
        });
      }

      function createRevenueBreakdownChart() {
        const ctx = document
          .getElementById("revenueBreakdownChart")
          .getContext("2d");

        if (reportingData.revenueBreakdown.length === 0) {
          // Show empty chart message
          ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
          ctx.font = "16px Arial";
          ctx.fillStyle = "#64748b";
          ctx.textAlign = "center";
          ctx.fillText(
            "No revenue data available",
            ctx.canvas.width / 2,
            ctx.canvas.height / 2
          );
          return;
        }

        const labels = reportingData.revenueBreakdown.map((r) => r.type);
        const data = reportingData.revenueBreakdown.map((r) => r.revenue);
        const colors = ["#f97316", "#3b82f6", "#10b981", "#f59e0b", "#8b5cf6"];

        if (revenueChart) revenueChart.destroy();

        revenueChart = new Chart(ctx, {
          type: "doughnut",
          data: {
            labels: labels,
            datasets: [
              {
                data: data,
                backgroundColor: colors.slice(0, labels.length),
                borderWidth: 2,
                borderColor: "#ffffff",
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "bottom",
                labels: {
                  padding: 20,
                  usePointStyle: true,
                },
              },
            },
          },
        });
      }

      function populateEventsTable(events, orders) {
        const tbody = document.getElementById("eventsTableBody");
        tbody.innerHTML = "";

        if (events.length === 0) {
          const row = document.createElement("tr");
          row.innerHTML = `
                    <td colspan="6" style="text-align: center; padding: 40px; color: #64748b;">
                        No events found. <a href="event-builder.html" style="color: #f97316;">Create your first event</a>
                    </td>
                `;
          tbody.appendChild(row);
          return;
        }

        events.forEach((event) => {
          const eventOrders = orders.filter((o) => o.eventId === event.id);
          const ticketsSold = eventOrders.reduce(
            (sum, o) => sum + (o.ticketQuantity || 0),
            0
          );
          const revenue = eventOrders.reduce(
            (sum, o) => sum + (o.total || 0),
            0
          );
          const capacity = event.capacity || 0;
          const conversion =
            capacity > 0 ? ((ticketsSold / capacity) * 100).toFixed(1) : "0.0";

          const row = document.createElement("tr");
          row.innerHTML = `
                    <td>
                        <div class="event-cell">
                            <div class="event-title">${event.title}</div>
                            <div class="event-location">${
                              event.location || "Location TBD"
                            }</div>
                        </div>
                    </td>
                    <td>${new Date(event.date).toLocaleDateString()}</td>
                    <td>
                        <span class="status-badge ${event.status}">
                            ${
                              event.status.charAt(0).toUpperCase() +
                              event.status.slice(1)
                            }
                        </span>
                    </td>
                    <td>${ticketsSold}${
            capacity > 0 ? ` / ${capacity}` : ""
          }</td>
                    <td>$${revenue.toFixed(2)}</td>
                    <td>${conversion}%</td>
                `;
          tbody.appendChild(row);
        });
      }

      function setupEventListeners() {
        // Time filter
        document
          .getElementById("timeFilter")
          .addEventListener("change", function () {
            loadReportingData();
          });

        // Year filter
        document
          .getElementById("yearFilter")
          .addEventListener("change", function () {
            loadReportingData();
          });

        // Metric toggle for top events
        document.querySelectorAll(".metric-toggle").forEach((button) => {
          button.addEventListener("click", function () {
            document
              .querySelectorAll(".metric-toggle")
              .forEach((b) => b.classList.remove("active"));
            this.classList.add("active");
            currentMetric = this.dataset.metric;
            createTopEventsChart();
          });
        });

        // Search and filter for events table
        document
          .getElementById("eventSearch")
          .addEventListener("input", filterEventsTable);
        document
          .getElementById("statusFilter")
          .addEventListener("change", filterEventsTable);
      }

      function filterEventsTable() {
        const searchTerm = document
          .getElementById("eventSearch")
          .value.toLowerCase();
        const statusFilter = document.getElementById("statusFilter").value;
        const rows = document.querySelectorAll("#eventsTableBody tr");

        rows.forEach((row) => {
          const eventTitle =
            row.querySelector(".event-title")?.textContent.toLowerCase() || "";
          const status =
            row.querySelector(".status-badge")?.textContent.toLowerCase() || "";

          const matchesSearch = eventTitle.includes(searchTerm);
          const matchesStatus =
            !statusFilter || status.includes(statusFilter.toLowerCase());

          row.style.display = matchesSearch && matchesStatus ? "" : "none";
        });
      }

      function refreshData() {
        loadReportingData();
        showNotification("Data refreshed successfully!", "success");
      }

      function showNotification(message, type = "info") {
        const notification = document.createElement("div");
        notification.className = `notification ${type}`;
        notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${
                  type === "success"
                    ? "#10b981"
                    : type === "error"
                    ? "#ef4444"
                    : "#3b82f6"
                };
                color: white;
                padding: 16px 24px;
                border-radius: 8px;
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
                z-index: 1000;
                font-weight: 500;
                max-width: 400px;
                animation: slideIn 0.3s ease;
            `;
        notification.textContent = message;

        document.body.appendChild(notification);

        setTimeout(() => {
          notification.style.animation = "slideOut 0.3s ease";
          setTimeout(() => notification.remove(), 300);
        }, 3000);
      }

      // Auto-refresh data every 30 seconds
      setInterval(() => {
        loadReportingData();
      }, 30000);
    </script>
  </body>
</html>
