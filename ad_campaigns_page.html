<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create Ad Campaign - Eventbrite</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background-color: #f8fafc;
      color: #1e293b;
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 32px;
    }

    .header {
      text-align: center;
      margin-bottom: 48px;
    }

    .header h1 {
      font-size: 48px;
      font-weight: 700;
      color: #2d1b69;
      margin-bottom: 16px;
    }

    .header p {
      color: #64748b;
      font-size: 18px;
      max-width: 600px;
      margin: 0 auto;
    }

    /* Progress Steps */
    .workflow-steps {
      display: flex;
      justify-content: center;
      margin-bottom: 48px;
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .step {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 24px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .step.active .step-number {
      background: #1877f2;
      color: white;
    }

    .step.active span {
      color: #1877f2;
      font-weight: 600;
    }

    .step-number {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #e5e7eb;
      color: #6b7280;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s ease;
    }

    .step-divider {
      width: 60px;
      height: 2px;
      background: #e5e7eb;
      margin: 20px 0;
      align-self: center;
    }

    /* Workflow Steps */
    .workflow-step {
      display: none;
      background: white;
      border-radius: 12px;
      padding: 32px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      margin-bottom: 24px;
    }

    .workflow-step.active {
      display: block;
    }

    .step-header {
      text-align: center;
      margin-bottom: 32px;
    }

    .step-header h2 {
      font-size: 28px;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 8px;
    }

    .step-header p {
      color: #64748b;
      font-size: 16px;
    }

    /* Event Selection */
    .event-selector {
      margin-bottom: 32px;
    }

    .search-container {
      position: relative;
      margin-bottom: 24px;
    }

    .search-container svg {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
    }

    .search-input {
      width: 100%;
      padding: 16px 16px 16px 48px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 16px;
    }

    .start-btn {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: #f97316;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
    }

    .event-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 48px;
    }

    .event-card {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .event-card:hover {
      border-color: #f97316;
      box-shadow: 0 4px 12px rgba(249, 115, 22, 0.1);
    }

    .event-card.selected {
      border-color: #1877f2;
      background: #f0f9ff;
    }

    .event-info {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .event-avatar {
      width: 60px;
      height: 60px;
      background: linear-gradient(45deg, #ff6b6b, #ffa500);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 12px;
      font-weight: 600;
      flex-shrink: 0;
    }

    .event-details {
      flex: 1;
    }

    .event-date {
      color: #f97316;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .event-title {
      color: #1e293b;
      font-size: 16px;
      font-weight: 500;
    }

    /* Audience Builder - Eventbrite Style */
    .audience-builder {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 32px;
      margin-bottom: 24px;
    }

    .audience-source {
      margin-bottom: 32px;
    }

    .audience-source h3 {
      font-size: 18px;
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 16px;
    }

    .audience-option {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .audience-option:hover {
      border-color: #1877f2;
      background: #f8fafc;
    }

    .audience-option input[type="checkbox"] {
      width: 18px;
      height: 18px;
    }

    .audience-icon {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .audience-content {
      flex: 1;
    }

    .audience-title {
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 4px;
    }

    .audience-description {
      color: #64748b;
      font-size: 14px;
    }

    .audience-count {
      color: #059669;
      font-weight: 600;
      font-size: 14px;
    }

    /* Smart Targeting */
    .smart-targeting {
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      border: 1px solid #0ea5e9;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 32px;
    }

    .smart-targeting h4 {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #0c4a6e;
      font-weight: 600;
      margin-bottom: 12px;
    }

    .smart-targeting p {
      color: #0369a1;
      font-size: 14px;
    }

    /* Budget Section - More Eventbrite-like */
    .budget-section {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 32px;
      margin-bottom: 24px;
    }

    .budget-input-group {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 24px;
    }

    .budget-input {
      flex: 1;
      padding: 12px 16px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 500;
    }

    .budget-type-toggle {
      display: flex;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      overflow: hidden;
    }

    .budget-type-option {
      padding: 12px 16px;
      background: white;
      border: none;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
    }

    .budget-type-option.active {
      background: #1877f2;
      color: white;
    }

    /* Estimated Performance */
    .performance-estimate {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 24px;
      margin-top: 24px;
    }

    .performance-metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 24px;
    }

    .metric {
      text-align: center;
    }

    .metric-value {
      font-size: 24px;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 4px;
    }

    .metric-label {
      color: #64748b;
      font-size: 14px;
    }

    /* Ad Creation */
    .ad-creator {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 32px;
      margin-bottom: 32px;
    }

    .ad-form {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 24px;
    }

    .ad-preview-section {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 24px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 8px;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 12px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 14px;
    }

    .form-group textarea {
      min-height: 80px;
      resize: vertical;
    }

    .char-count {
      text-align: right;
      color: #64748b;
      font-size: 12px;
      margin-top: 4px;
    }

    /* Live Ad Preview */
    .ad-preview {
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 16px;
      background: #f8fafc;
    }

    .preview-platform-tabs {
      display: flex;
      margin-bottom: 16px;
      border-bottom: 1px solid #e2e8f0;
    }

    .platform-tab {
      padding: 8px 16px;
      border: none;
      background: none;
      cursor: pointer;
      color: #64748b;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }

    .platform-tab.active {
      color: #1877f2;
      border-bottom-color: #1877f2;
    }

    .mock-feed-post {
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .post-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
    }

    .post-avatar {
      width: 32px;
      height: 32px;
      background: #1877f2;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 14px;
      font-weight: 600;
    }

    .post-info {
      flex: 1;
    }

    .post-name {
      font-weight: 600;
      font-size: 14px;
      color: #1e293b;
    }

    .post-sponsored {
      font-size: 12px;
      color: #64748b;
    }

    .post-image {
      width: 100%;
      height: 200px;
      background: #f1f5f9;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #64748b;
      font-size: 14px;
    }

    .post-content {
      padding: 12px;
    }

    .post-text {
      margin-bottom: 8px;
      color: #1e293b;
      font-size: 14px;
      line-height: 1.4;
    }

    .post-headline {
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 8px;
    }

    .post-cta {
      background: #1877f2;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      width: 100%;
    }

    /* Campaign Summary */
    .summary-card {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .summary-section {
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px solid #f1f5f9;
    }

    .summary-section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .summary-title {
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 8px;
    }

    .summary-details {
      color: #64748b;
      font-size: 14px;
      line-height: 1.5;
    }

    /* Action Buttons */
    .step-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 32px;
      padding-top: 24px;
      border-top: 1px solid #e5e7eb;
    }

    .btn {
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      font-size: 14px;
    }

    .btn-secondary {
      background: transparent;
      border: 1px solid #d1d5db;
      color: #6b7280;
    }

    .btn-primary {
      background: #1877f2;
      color: white;
    }

    .btn-success {
      background: #059669;
      color: white;
    }

    .btn-group {
      display: flex;
      gap: 12px;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .container {
        padding: 16px;
      }

      .ad-creator {
        grid-template-columns: 1fr;
      }

      .workflow-steps {
        overflow-x: auto;
      }

      .step {
        flex-shrink: 0;
      }
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
  <script src="js/auth-api.js"></script>
  <script src="js/upload-manager.js"></script>
</head>

<body>
  <div class="container">
    <!-- Header -->
    <div class="header" style="position: relative;">
      <!-- User Profile Section -->
      <div id="user-profile" style="position: absolute; top: 0; right: 0; display: flex; align-items: center; gap: 12px; background: white; padding: 12px 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <div id="user-avatar" style="width: 40px; height: 40px; background: #f97316; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 16px;">
          U
        </div>
        <div>
          <div id="user-name" style="font-weight: 600; color: #1e293b; font-size: 14px;">Loading...</div>
          <div id="user-email" style="color: #64748b; font-size: 12px;">user@example.com</div>
        </div>
      </div>
      <h1>Facebook & Instagram Ads</h1>
      <p>Quickly create ads that get your event in front of more people using Eventbrite's automated ad creation tools.</p>
    </div>

    <!-- Progress Steps -->
    <div class="workflow-steps">
      <div class="step active" data-step="1">
        <div class="step-number">1</div>
        <span>Select Event</span>
      </div>
      <div class="step-divider"></div>
      <div class="step" data-step="2">
        <div class="step-number">2</div>
        <span>Build Audience</span>
      </div>
      <div class="step-divider"></div>
      <div class="step" data-step="3">
        <div class="step-number">3</div>
        <span>Set Budget</span>
      </div>
      <div class="step-divider"></div>
      <div class="step" data-step="4">
        <div class="step-number">4</div>
        <span>Create Ads</span>
      </div>
      <div class="step-divider"></div>
      <div class="step" data-step="5">
        <div class="step-number">5</div>
        <span>Review & Launch</span>
      </div>
    </div>

    <!-- Step 1: Select Event -->
    <div class="workflow-step active" id="step-1">
      <div class="step-header">
        <h2>Select an event to advertise</h2>
        <p>Choose which event you'd like to create ads for</p>
      </div>

      <div class="event-selector">
        <div class="search-container">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="#666">
            <circle cx="11" cy="11" r="8" />
            <path d="M21 21l-4.35-4.35" />
          </svg>
          <input type="text" class="search-input" placeholder="Select an event" />
          <button class="start-btn">Start</button>
        </div>

        <h4 style="font-size: 18px; font-weight: 600; color: #1e293b; margin-bottom: 24px;">Or choose one of your upcoming events</h4>

        <div class="event-grid">
          <div class="event-card" onclick="selectEvent(this, 'event-1')">
            <div class="event-info">
              <div class="event-avatar">MUSA</div>
              <div class="event-details">
                <div class="event-date">Tue, Sep 9 at 10:00 am</div>
                <div class="event-title">Tech Conference 2024</div>
              </div>
            </div>
          </div>

          <div class="event-card" onclick="selectEvent(this, 'event-2')">
            <div class="event-info">
              <div class="event-avatar">FEST</div>
              <div class="event-details">
                <div class="event-date">Fri, Sep 12 at 6:00 pm</div>
                <div class="event-title">Summer Music Festival</div>
              </div>
            </div>
          </div>

          <div class="event-card" onclick="selectEvent(this, 'event-3')">
            <div class="event-info">
              <div class="event-avatar">FOOD</div>
              <div class="event-details">
                <div class="event-date">Sat, Sep 20 at 2:00 pm</div>
                <div class="event-title">Food & Wine Expo</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="step-actions">
        <button class="btn btn-secondary" disabled>Back</button>
        <button class="btn btn-primary" onclick="nextStep()" disabled id="next-btn-1">Continue</button>
      </div>
    </div>

    <!-- Step 2: Build Audience -->
    <div class="workflow-step" id="step-2">
      <div class="step-header">
        <h2>Build your audience</h2>
        <p>Select who you want to reach with your ads</p>
      </div>

      <div class="smart-targeting">
        <h4>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
          Smart Targeting Enabled
        </h4>
        <p>Eventbrite will automatically optimize your audience based on people most likely to attend events like yours.</p>
      </div>

      <div class="audience-builder">
        <div class="audience-source">
          <h3>Choose your audience sources</h3>
          
          <div class="audience-option" onclick="toggleAudience(this)">
            <input type="checkbox" />
            <div class="audience-icon" style="background: #f0f9ff;">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="#3b82f6">
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
              </svg>
            </div>
            <div class="audience-content">
              <div class="audience-title">Website visitors and engaged users</div>
              <div class="audience-description">People who visited your event page or engaged with your content</div>
              <div class="audience-count">~8,500 people</div>
            </div>
          </div>

          <div class="audience-option" onclick="toggleAudience(this)">
            <input type="checkbox" />
            <div class="audience-icon" style="background: #f0fdf4;">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="#059669">
                <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
              </svg>
            </div>
            <div class="audience-content">
              <div class="audience-title">Past attendees of 2+ events</div>
              <div class="audience-description">People who have attended multiple events in your category</div>
              <div class="audience-count">~12,300 people</div>
            </div>
          </div>

          <div class="audience-option" onclick="toggleAudience(this)">
            <input type="checkbox" />
            <div class="audience-icon" style="background: #fef3c7;">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="#d97706">
                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                <polyline points="22,6 12,13 2,6"/>
              </svg>
            </div>
            <div class="audience-content">
              <div class="audience-title">Email subscribers</div>
              <div class="audience-description">People subscribed to your email lists</div>
              <div class="audience-count">~3,200 people</div>
            </div>
          </div>

          <div class="audience-option" onclick="toggleAudience(this)">
            <input type="checkbox" />
            <div class="audience-icon" style="background: #f3e8ff;">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="#7c3aed">
                <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
              </svg>
            </div>
            <div class="audience-content">
              <div class="audience-title">Facebook page fans and similar audiences</div>
              <div class="audience-description">People who like your Facebook page and similar users</div>
              <div class="audience-count">~25,600 people</div>
            </div>
          </div>

          <div class="audience-option" onclick="toggleAudience(this)">
            <input type="checkbox" />
            <div class="audience-icon" style="background: #fef2f2;">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="#dc2626">
                <circle cx="12" cy="12" r="10"/>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                <line x1="12" y1="17" x2="12.01" y2="17"/>
              </svg>
            </div>
            <div class="audience-content">
              <div class="audience-title">Lookalike audiences</div>
              <div class="audience-description">People similar to your best customers</div>
              <div class="audience-count">~1.2M people</div>
            </div>
          </div>
        </div>

        <div style="margin-top: 32px; padding: 20px; background: #f8fafc; border-radius: 8px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <span style="font-weight: 600; color: #374151;">Total audience size</span>
            <span style="color: #059669; font-weight: 600;" id="audience-size">Select audiences above</span>
          </div>
          <div style="background: #e5e7eb; height: 8px; border-radius: 4px; margin-bottom: 8px;">
            <div style="background: linear-gradient(to right, #ef4444, #f59e0b, #10b981); width: 0%; height: 100%; border-radius: 4px; transition: width 0.3s;" id="audience-bar"></div>
          </div>
          <p style="color: #6b7280; font-size: 14px; margin: 0;" id="audience-description">Select one or more audience sources to see estimated reach</p>
        </div>
      </div>

      <div class="step-actions">
        <button class="btn btn-secondary" onclick="prevStep()">Back</button>
        <button class="btn btn-primary" onclick="nextStep()">Continue</button>
      </div>
    </div>

    <!-- Step 3: Set Budget -->
    <div class="workflow-step" id="step-3">
      <div class="step-header">
        <h2>Set your advertising budget</h2>
        <p>Choose how much you want to spend on your campaign</p>
      </div>

      <div class="budget-section">
        <h3 style="margin-bottom: 24px; color: #1e293b;">Daily Budget</h3>
        
        <div class="budget-input-group">
          <div style="position: relative; flex: 1;">
            <span style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: #6b7280; font-weight: 600;">$</span>
            <input type="number" class="budget-input" value="20" min="5" style="padding-left: 32px;" oninput="updateBudgetEstimate(this.value)" />
          </div>
          <div class="budget-type-toggle">
            <button class="budget-type-option active" onclick="setBudgetType(this, 'daily')">Per Day</button>
            <button class="budget-type-option" onclick="setBudgetType(this, 'lifetime')">Total Budget</button>
          </div>
        </div>

        <div style="color: #64748b; font-size: 14px; margin-bottom: 24px;">
          <strong>Recommended:</strong> Start with $20-50 per day for optimal results
        </div>

        <div class="performance-estimate">
          <h4 style="margin-bottom: 16px; color: #1e293b;">Estimated daily performance</h4>
          <div class="performance-metrics">
            <div class="metric">
              <div class="metric-value" id="estimated-reach">2,100 - 5,600</div>
              <div class="metric-label">People reached</div>
            </div>
            <div class="metric">
              <div class="metric-value" id="estimated-clicks">42 - 112</div>
              <div class="metric-label">Link clicks</div>
            </div>
            <div class="metric">
              <div class="metric-value" id="estimated-cost">$0.18 - $0.48</div>
              <div class="metric-label">Cost per click</div>
            </div>
            <div class="metric">
              <div class="metric-value" id="estimated-tickets">8 - 22</div>
              <div class="metric-label">Estimated ticket sales</div>
            </div>
          </div>
        </div>
      </div>

      <div class="step-actions">
        <button class="btn btn-secondary" onclick="prevStep()">Back</button>
        <button class="btn btn-primary" onclick="nextStep()">Continue</button>
      </div>
    </div>

    <!-- Step 4: Create Ads -->
    <div class="workflow-step" id="step-4">
      <div class="step-header">
        <h2>Create your ads</h2>
        <p>Eventbrite will automatically generate multiple ad variations for optimal performance</p>
      </div>

      <div class="ad-creator">
        <div class="ad-form">
          <h3 style="margin-bottom: 20px; color: #1e293b;">Ad Content</h3>
          
          <div class="form-group">
            <label for="headline">Headline</label>
            <input type="text" id="headline" placeholder="Eye-catching event headline..." maxlength="40" oninput="updatePreview(); updateCharCount('headline', 40)" />
            <div class="char-count"><span id="headline-count">0</span>/40</div>
          </div>

          <div class="form-group">
            <label for="description">Description</label>
            <textarea id="description" placeholder="Describe what makes your event special..." maxlength="125" oninput="updatePreview(); updateCharCount('description', 125)"></textarea>
            <div class="char-count"><span id="description-count">0</span>/125</div>
          </div>

          <div class="form-group">
            <label for="cta">Call to Action</label>
            <select id="cta" onchange="updatePreview()">
              <option value="Get Tickets">Get Tickets</option>
              <option value="Learn More">Learn More</option>
              <option value="Sign Up">Sign Up</option>
              <option value="Register Now">Register Now</option>
              <option value="Book Now">Book Now</option>
            </select>
          </div>

          <div class="form-group">
            <label>Event Image</label>
            <div style="border: 2px dashed #d1d5db; border-radius: 8px; padding: 32px; text-align: center; background: #fafbfc; cursor: pointer;" onclick="document.getElementById('image-upload').click()">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="#9ca3af" style="margin-bottom: 12px;">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                <circle cx="9" cy="9" r="2"/>
                <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>
              </svg>
              <p style="color: #6b7280; margin: 0;">Upload event image or use existing</p>
              <button style="background: #f3f4f6; border: 1px solid #d1d5db; color: #374151; padding: 8px 16px; border-radius: 6px; margin-top: 12px; cursor: pointer;">Browse Files</button>
            </div>
            <input type="file" id="image-upload" accept="image/*" style="display: none;" onchange="handleImageUpload(this)" />
            <div style="color: #64748b; font-size: 12px; margin-top: 8px;">Recommended: 1200 x 628 pixels, JPG or PNG</div>
          </div>

          <div style="background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px; padding: 16px; margin-top: 20px;">
            <h4 style="color: #0c4a6e; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
              Smart Ad Generation
            </h4>
            <p style="color: #0369a1; font-size: 14px; margin: 0;">Eventbrite will create multiple ad variations using your content to find the best performing combinations.</p>
          </div>
        </div>

        <div class="ad-preview-section">
          <h3 style="margin-bottom: 16px; color: #1e293b;">Live Preview</h3>
          
          <div class="preview-platform-tabs">
            <button class="platform-tab active" onclick="switchPlatform(this, 'facebook')">Facebook</button>
            <button class="platform-tab" onclick="switchPlatform(this, 'instagram')">Instagram</button>
          </div>

          <div class="ad-preview">
            <div class="mock-feed-post" id="facebook-preview">
              <div class="post-header">
                <div class="post-avatar">E</div>
                <div class="post-info">
                  <div class="post-name">Your Event</div>
                  <div class="post-sponsored">Sponsored</div>
                </div>
              </div>
              <div class="post-image" id="preview-image">
                <span>Your event image will appear here</span>
              </div>
              <div class="post-content">
                <div class="post-headline" id="preview-headline">Your headline will appear here</div>
                <div class="post-text" id="preview-description">Your description will appear here...</div>
                <button class="post-cta" id="preview-cta">Get Tickets</button>
              </div>
            </div>

            <div class="mock-feed-post" id="instagram-preview" style="display: none;">
              <div class="post-header">
                <div class="post-avatar">E</div>
                <div class="post-info">
                  <div class="post-name">your_event</div>
                  <div class="post-sponsored">Sponsored</div>
                </div>
              </div>
              <div class="post-image" id="preview-image-ig">
                <span>Your event image will appear here</span>
              </div>
              <div class="post-content">
                <div class="post-text" id="preview-description-ig">Your description will appear here...</div>
                <button class="post-cta" id="preview-cta-ig">Get Tickets</button>
              </div>
            </div>
          </div>

          <div style="margin-top: 16px; padding: 12px; background: #f8fafc; border-radius: 8px; border-left: 4px solid #4f46e5;">
            <div style="font-size: 12px; color: #64748b; margin-bottom: 4px;">Performance Tip</div>
            <div style="font-size: 14px; color: #374151;">Use action words in your headline and focus on what attendees will gain from your event.</div>
          </div>
        </div>
      </div>

      <div class="step-actions">
        <button class="btn btn-secondary" onclick="prevStep()">Back</button>
        <button class="btn btn-primary" onclick="nextStep()">Continue</button>
      </div>
    </div>

    <!-- Step 5: Review & Launch -->
    <div class="workflow-step" id="step-5">
      <div class="step-header">
        <h2>Review and launch your campaign</h2>
        <p>Double-check your settings before launching your ads</p>
      </div>

      <div class="summary-card">
        <h3 style="margin-bottom: 24px; color: #1e293b;">Campaign Summary</h3>
        
        <div class="summary-section">
          <div class="summary-title">Event</div>
          <div class="summary-details" id="summary-event">No event selected</div>
        </div>

        <div class="summary-section">
          <div class="summary-title">Audience</div>
          <div class="summary-details" id="summary-audience">
            <div>• Website visitors and engaged users (~8,500 people)</div>
            <div>• Past attendees of 2+ events (~12,300 people)</div>
            <div>• <strong>Total estimated reach: 15,000 - 45,000 people</strong></div>
          </div>
        </div>

        <div class="summary-section">
          <div class="summary-title">Budget & Schedule</div>
          <div class="summary-details">
            <div>Daily budget: <strong>$20.00</strong></div>
            <div>Campaign duration: <strong>Until manually stopped</strong></div>
            <div>Estimated spend: <strong>$140 - $600 per week</strong></div>
          </div>
        </div>

        <div class="summary-section">
          <div class="summary-title">Ad Creative</div>
          <div class="summary-details">
            <div>Headline: <strong id="summary-headline">"Your headline will appear here"</strong></div>
            <div>Description: <strong id="summary-description">"Your description will appear here..."</strong></div>
            <div>Call to action: <strong id="summary-cta">"Get Tickets"</strong></div>
            <div>Platforms: <strong>Facebook and Instagram</strong></div>
          </div>
        </div>

        <div class="summary-section">
          <div class="summary-title">Expected Results (Weekly)</div>
          <div class="summary-details">
            <div>• <strong>14,700 - 39,200</strong> people reached</div>
            <div>• <strong>294 - 784</strong> link clicks</div>
            <div>• <strong>56 - 154</strong> estimated ticket sales</div>
            <div>• <strong>$1.26 - $3.36</strong> average cost per click</div>
          </div>
        </div>
      </div>

      <!-- Eventbrite's Terms and Info -->
      <div style="background: #fef9e7; border: 1px solid #f59e0b; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
        <h4 style="color: #92400e; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
          Eventbrite Ads Boost
        </h4>
        <ul style="color: #78350f; font-size: 14px; margin: 0; padding-left: 20px;">
          <li>24/7 automated optimization powered by machine learning</li>
          <li>Performance monitoring with automatic bid adjustments</li>
          <li>Cross-platform management (Facebook + Instagram)</li>
          <li>Real-time reporting and analytics dashboard</li>
          <li>Dedicated support from our advertising specialists</li>
        </ul>
      </div>

      <!-- Payment Info -->
      <div class="summary-card">
        <h3 style="margin-bottom: 16px; color: #1e293b;">Billing Information</h3>
        <div style="display: flex; align-items: center; justify-content: space-between; padding: 16px; background: #f9fafb; border-radius: 8px;">
          <div style="display: flex; align-items: center; gap: 12px;">
            <div style="width: 40px; height: 24px; background: #1a1f71; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: 600;">VISA</div>
            <span>•••• •••• •••• 1234</span>
          </div>
          <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;">Change</button>
        </div>
        <div style="margin-top: 12px; font-size: 14px; color: #64748b;">
          You'll only be charged for actual ad performance. Campaigns can be paused or stopped at any time.
        </div>
      </div>

      <div class="step-actions">
        <button class="btn btn-secondary" onclick="prevStep()">Back</button>
        <div class="btn-group">
          <button class="btn btn-secondary" onclick="saveDraft()">Save Draft</button>
          <button class="btn btn-success" onclick="launchCampaign()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px;">
              <path d="M8 5v14l11-7z"/>
            </svg>
            Launch Campaign
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Enhanced Campaign Data Object matching Eventbrite's structure
    const campaignData = {
      event: {
        id: null,
        title: '',
        date: '',
        imageUrl: null
      },
      audience: {
        sources: [],
        estimatedReach: { min: 0, max: 0 },
        smartTargeting: true
      },
      budget: {
        type: 'daily', // 'daily' or 'lifetime'
        amount: 20,
        currency: 'USD',
        estimatedPerformance: {
          reach: { min: 2100, max: 5600 },
          clicks: { min: 42, max: 112 },
          costPerClick: { min: 0.18, max: 0.48 },
          ticketSales: { min: 8, max: 22 }
        }
      },
      creative: {
        headline: '',
        description: '',
        callToAction: 'Get Tickets',
        imageFile: null,
        variations: []
      },
      targeting: {
        platforms: ['facebook', 'instagram'],
        placements: ['feed'],
        optimization: 'link_clicks'
      },
      status: 'draft',
      createdAt: null,
      launchedAt: null
    };

    let currentStep = 1;
    let selectedEventId = null;

    // Step Navigation
    function showStep(stepNumber) {
      // Hide all steps
      document.querySelectorAll('.workflow-step').forEach(step => {
        step.classList.remove('active');
      });

      // Show selected step
      const selectedStep = document.getElementById(`step-${stepNumber}`);
      if (selectedStep) {
        selectedStep.classList.add('active');
      }

      // Update step indicators
      updateStepIndicators(stepNumber);
      currentStep = stepNumber;

      // Update summary if on review step
      if (stepNumber === 5) {
        updateSummary();
      }
    }

    function updateStepIndicators(activeStep) {
      const steps = document.querySelectorAll('.step');
      steps.forEach((step, index) => {
        const stepNum = index + 1;
        const stepNumber = step.querySelector('.step-number');
        const stepText = step.querySelector('span');

        if (stepNum <= activeStep) {
          step.classList.add('active');
          stepNumber.style.background = '#1877f2';
          stepNumber.style.color = 'white';
          stepText.style.color = '#1877f2';
          stepText.style.fontWeight = '600';
        } else {
          step.classList.remove('active');
          stepNumber.style.background = '#e5e7eb';
          stepNumber.style.color = '#6b7280';
          stepText.style.color = '#6b7280';
          stepText.style.fontWeight = '400';
        }
      });
    }

    function nextStep() {
      if (validateCurrentStep()) {
        collectStepData(currentStep);
        if (currentStep < 5) {
          showStep(currentStep + 1);
        }
      }
    }

    function prevStep() {
      if (currentStep > 1) {
        showStep(currentStep - 1);
      }
    }

    // Event Selection
    function selectEvent(element, eventId) {
      // Remove selection from other cards
      document.querySelectorAll('.event-card').forEach(card => {
        card.classList.remove('selected');
      });
      
      // Select current card
      element.classList.add('selected');
      selectedEventId = eventId;
      
      // Enable continue button
      document.getElementById('next-btn-1').disabled = false;
      
      // Store event data
      const eventTitle = element.querySelector('.event-title').textContent;
      const eventDate = element.querySelector('.event-date').textContent;
      
      campaignData.event.id = eventId;
      campaignData.event.title = eventTitle;
      campaignData.event.date = eventDate;
    }

    // Audience Building
    function toggleAudience(element) {
      const checkbox = element.querySelector('input[type="checkbox"]');
      checkbox.checked = !checkbox.checked;
      
      updateAudienceSize();
    }

    function updateAudienceSize() {
      const selectedAudiences = document.querySelectorAll('.audience-option input[type="checkbox"]:checked');
      let totalMin = 0;
      let totalMax = 0;
      
      // Simplified calculation - in real implementation, this would be more complex
      selectedAudiences.forEach(checkbox => {
        const audienceOption = checkbox.closest('.audience-option');
        const countText = audienceOption.querySelector('.audience-count').textContent;
        
        // Extract numbers from text like "~8,500 people"
        const count = parseInt(countText.replace(/[^\d]/g, ''));
        totalMin += Math.floor(count * 0.8);
        totalMax += Math.floor(count * 1.5);
      });
      
      const sizeElement = document.getElementById('audience-size');
      const barElement = document.getElementById('audience-bar');
      const descElement = document.getElementById('audience-description');
      
      if (selectedAudiences.length > 0) {
        sizeElement.textContent = `${totalMin.toLocaleString()} - ${totalMax.toLocaleString()} people`;
        barElement.style.width = Math.min(100, (selectedAudiences.length / 5) * 100) + '%';
        descElement.textContent = `Good audience size for effective advertising`;
        
        // Store in campaign data
        campaignData.audience.estimatedReach = { min: totalMin, max: totalMax };
        campaignData.audience.sources = Array.from(selectedAudiences).map(cb => 
          cb.closest('.audience-option').querySelector('.audience-title').textContent
        );
      } else {
        sizeElement.textContent = 'Select audiences above';
        barElement.style.width = '0%';
        descElement.textContent = 'Select one or more audience sources to see estimated reach';
      }
    }

    // Budget Management
    function setBudgetType(element, type) {
      // Update button states
      document.querySelectorAll('.budget-type-option').forEach(btn => {
        btn.classList.remove('active');
      });
      element.classList.add('active');
      
      campaignData.budget.type = type;
      
      // Update labels and calculations
      const inputLabel = type === 'daily' ? 'Per Day' : 'Total Budget';
      updateBudgetEstimate(document.querySelector('.budget-input').value);
    }

    function updateBudgetEstimate(amount) {
      campaignData.budget.amount = parseFloat(amount);
      
      // Calculate estimated performance based on budget
      const multiplier = amount / 20; // Base calculation on $20 baseline
      
      const reach = {
        min: Math.round(2100 * multiplier),
        max: Math.round(5600 * multiplier)
      };
      
      const clicks = {
        min: Math.round(42 * multiplier),
        max: Math.round(112 * multiplier)
      };
      
      const tickets = {
        min: Math.round(8 * multiplier),
        max: Math.round(22 * multiplier)
      };
      
      // Update display
      document.getElementById('estimated-reach').textContent = `${reach.min.toLocaleString()} - ${reach.max.toLocaleString()}`;
      document.getElementById('estimated-clicks').textContent = `${clicks.min} - ${clicks.max}`;
      document.getElementById('estimated-tickets').textContent = `${tickets.min} - ${tickets.max}`;
      
      // Store in campaign data
      campaignData.budget.estimatedPerformance = { reach, clicks, costPerClick: { min: 0.18, max: 0.48 }, ticketSales: tickets };
    }

    // Ad Creation
    function updateCharCount(fieldId, maxLength) {
      const field = document.getElementById(fieldId);
      const counter = document.getElementById(fieldId + '-count');
      counter.textContent = field.value.length;
      
      // Color coding
      if (field.value.length > maxLength * 0.9) {
        counter.style.color = '#dc2626';
      } else if (field.value.length > maxLength * 0.7) {
        counter.style.color = '#d97706';
      } else {
        counter.style.color = '#64748b';
      }
    }

    function updatePreview() {
      const headline = document.getElementById('headline').value || 'Your headline will appear here';
      const description = document.getElementById('description').value || 'Your description will appear here...';
      const cta = document.getElementById('cta').value;
      
      // Update Facebook preview
      document.getElementById('preview-headline').textContent = headline;
      document.getElementById('preview-description').textContent = description;
      document.getElementById('preview-cta').textContent = cta;
      
      // Update Instagram preview (different format)
      document.getElementById('preview-description-ig').textContent = `${headline}\n\n${description}`;
      document.getElementById('preview-cta-ig').textContent = cta;
      
      // Store in campaign data
      campaignData.creative.headline = headline;
      campaignData.creative.description = description;
      campaignData.creative.callToAction = cta;
    }

    function switchPlatform(element, platform) {
      // Update tab states
      document.querySelectorAll('.platform-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      element.classList.add('active');
      
      // Show appropriate preview
      if (platform === 'facebook') {
        document.getElementById('facebook-preview').style.display = 'block';
        document.getElementById('instagram-preview').style.display = 'none';
      } else {
        document.getElementById('facebook-preview').style.display = 'none';
        document.getElementById('instagram-preview').style.display = 'block';
      }
    }

    async function handleImageUpload(input) {
      if (input.files && input.files[0]) {
        const file = input.files[0];
        
        try {
          // Show loading state
          const uploadButton = document.querySelector('[onclick*="image-upload"]');
          const originalText = uploadButton.innerHTML;
          uploadButton.innerHTML = '<div style="display: flex; align-items: center; gap: 8px;"><div style="width: 16px; height: 16px; border: 2px solid #d1d5db; border-top-color: #3b82f6; border-radius: 50%; animation: spin 1s linear infinite;"></div>Uploading...</div>';
          
          // Upload using the upload manager
          const result = await uploadManager.uploadImage(file, {
            type: 'campaign_image',
            campaignId: campaignData.id || 'temp_' + Date.now()
          });
          
          // Update preview images
          document.getElementById('preview-image').innerHTML = `<img src="${result.url}" style="width: 100%; height: 100%; object-fit: cover;" />`;
          document.getElementById('preview-image-ig').innerHTML = `<img src="${result.url}" style="width: 100%; height: 100%; object-fit: cover;" />`;
          
          // Store in campaign data
          campaignData.creative.imageFile = file;
          campaignData.creative.imageUrl = result.url;
          campaignData.creative.imageId = result.imageId;
          campaignData.creative.uploadMethod = result.method;
          
          // Show success message
          showUploadSuccess(result.method);
          
          // Restore button
          uploadButton.innerHTML = originalText;
          
        } catch (error) {
          console.error('Upload failed:', error);
          alert(`Upload failed: ${error.message}`);
          
          // Restore button
          const uploadButton = document.querySelector('[onclick*="image-upload"]');
          uploadButton.innerHTML = originalText;
        }
      }
    }
    
    function showUploadSuccess(method) {
      const message = document.createElement('div');
      message.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #10b981;
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 1000;
        font-size: 14px;
      `;
      message.textContent = `Image uploaded successfully using ${method === 'server' ? 'server storage' : 'local storage'}`;
      document.body.appendChild(message);
      
      setTimeout(() => {
        message.remove();
      }, 3000);
    }

    // Validation
    function validateCurrentStep() {
      switch(currentStep) {
        case 1:
          if (!selectedEventId) {
            alert('Please select an event to advertise');
            return false;
          }
          return true;
        case 2:
          const selectedAudiences = document.querySelectorAll('.audience-option input[type="checkbox"]:checked');
          if (selectedAudiences.length === 0) {
            alert('Please select at least one audience source');
            return false;
          }
          return true;
        case 3:
          const budget = parseFloat(document.querySelector('.budget-input').value);
          if (!budget || budget < 5) {
            alert('Please set a budget of at least $5');
            return false;
          }
          return true;
        case 4:
          if (!campaignData.creative.headline.trim()) {
            alert('Please enter a headline for your ad');
            return false;
          }
          if (!campaignData.creative.description.trim()) {
            alert('Please enter a description for your ad');
            return false;
          }
          return true;
        default:
          return true;
      }
    }

    function collectStepData(step) {
      // Data is collected in real-time through event handlers
      // This function could be used for additional processing
      console.log(`Step ${step} data collected:`, campaignData);
    }

    // Summary Updates
    function updateSummary() {
      document.getElementById('summary-event').textContent = campaignData.event.title || 'No event selected';
      document.getElementById('summary-headline').textContent = `"${campaignData.creative.headline || 'Your headline will appear here'}"`;
      document.getElementById('summary-description').textContent = `"${campaignData.creative.description || 'Your description will appear here...'}"`;
      document.getElementById('summary-cta').textContent = `"${campaignData.creative.callToAction}"`;
    }

    // Campaign Actions
    async function saveDraft() {
      campaignData.status = 'draft';
      campaignData.createdAt = new Date().toISOString();
      
      try {
        const response = await fetch('/api/marketing/campaigns/draft', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${window.authAPI.token}`
          },
          body: JSON.stringify(campaignData)
        });
        
        if (response.ok) {
          const result = await response.json();
          alert('Campaign saved as draft successfully!');
          console.log('Draft saved:', result);
        } else {
          const errorData = await response.json();
          throw new Error(errorData.error || 'Failed to save draft');
        }
      } catch (error) {
        console.error('Error saving draft:', error);
        alert('Error saving draft. Please try again.');
      }
    }

    async function launchCampaign() {
      if (!validateAllSteps()) {
        return;
      }
      
      campaignData.status = 'active';
      campaignData.launchedAt = new Date().toISOString();
      
      try {
        const response = await fetch('/api/marketing/campaigns/launch', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${window.authAPI.token}`
          },
          body: JSON.stringify(campaignData)
        });
        
        if (response.ok) {
          const result = await response.json();
          
          // Show success message with campaign confirmation
          showLaunchSuccess(result);
        } else {
          const errorData = await response.json();
          throw new Error(errorData.error || 'Failed to launch campaign');
        }
      } catch (error) {
        console.error('Error launching campaign:', error);
        alert('Error launching campaign. Please try again.');
      }
    }

    function validateAllSteps() {
      if (!campaignData.event.id) {
        alert('Please select an event');
        showStep(1);
        return false;
      }
      
      if (campaignData.audience.sources.length === 0) {
        alert('Please select audience sources');
        showStep(2);
        return false;
      }
      
      if (!campaignData.budget.amount || campaignData.budget.amount < 5) {
        alert('Please set a valid budget');
        showStep(3);
        return false;
      }
      
      if (!campaignData.creative.headline.trim() || !campaignData.creative.description.trim()) {
        alert('Please complete your ad creative');
        showStep(4);
        return false;
      }
      
      return true;
    }

    function showLaunchSuccess(result) {
      const successHtml = `
        <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;">
          <div style="background: white; border-radius: 12px; padding: 32px; max-width: 500px; text-align: center;">
            <div style="width: 64px; height: 64px; background: #059669; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px;">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="white">
                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </div>
            <h2 style="color: #1e293b; margin-bottom: 16px;">Campaign Launched Successfully! 🎉</h2>
            <p style="color: #64748b; margin-bottom: 24px;">Your ads are now live on Facebook and Instagram. You'll receive email updates on performance.</p>
            <div style="display: flex; gap: 12px; justify-content: center;">
              <button onclick="window.location.href='marketing.html'" style="background: #1877f2; color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; margin-right: 12px;">View Campaigns</button>
              <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background: transparent; border: 1px solid #d1d5db; color: #6b7280; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer;">Close</button>
            </div>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', successHtml);
    }

    function getAuthToken() {
      return window.authAPI?.token || localStorage.getItem('authToken');
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      // Step indicator click handlers
      document.querySelectorAll('.step').forEach((step, index) => {
        step.addEventListener('click', () => {
          if (index + 1 <= currentStep || validateStepsUpTo(index + 1)) {
            showStep(index + 1);
          }
        });
      });

      // Initialize with first step
      showStep(1);
      
      // Set up real-time preview updates
      updatePreview();
    });

    function validateStepsUpTo(stepNumber) {
      for (let i = 1; i < stepNumber; i++) {
        const tempStep = currentStep;
        currentStep = i;
        if (!validateCurrentStep()) {
          currentStep = tempStep;
          return false;
        }
      }
      return true;
    }

    // Auto-save functionality
    function enableAutoSave() {
      setInterval(() => {
        if (campaignData.status === 'draft') {
          localStorage.setItem('eventbriteDraftCampaign', JSON.stringify(campaignData));
        }
      }, 30000);
    }

    // Load saved draft
    window.addEventListener('load', function() {
      const savedDraft = localStorage.getItem('eventbriteDraftCampaign');
      if (savedDraft) {
        const shouldRestore = confirm('Found a saved draft campaign. Would you like to restore it?');
        if (shouldRestore) {
          Object.assign(campaignData, JSON.parse(savedDraft));
          restoreFormData();
        }
      }
    });

    function restoreFormData() {
      // Restore event selection
      if (campaignData.event.id) {
        const eventCard = document.querySelector(`[onclick*="${campaignData.event.id}"]`);
        if (eventCard) {
          selectEvent(eventCard, campaignData.event.id);
        }
      }

      // Restore budget
      if (campaignData.budget.amount) {
        document.querySelector('.budget-input').value = campaignData.budget.amount;
        updateBudgetEstimate(campaignData.budget.amount);
      }

      // Restore creative
      if (campaignData.creative.headline) {
        document.getElementById('headline').value = campaignData.creative.headline;
        updateCharCount('headline', 40);
      }
      if (campaignData.creative.description) {
        document.getElementById('description').value = campaignData.creative.description;
        updateCharCount('description', 125);
      }
      if (campaignData.creative.callToAction) {
        document.getElementById('cta').value = campaignData.creative.callToAction;
      }

      updatePreview();
    }

    // Enhanced Campaign API integration
    const CampaignAPI = {
      // Get smart audience suggestions for an event
      getSmartAudienceSuggestions: async function(eventId) {
        try {
          const response = await fetch(`/api/marketing/campaigns/audience-suggestions/${eventId}`, {
            headers: { 
              'Authorization': `Bearer ${window.authAPI.token}`,
              'Content-Type': 'application/json'
            }
          });
          
          if (!response.ok) throw new Error('Failed to get audience suggestions');
          return await response.json();
        } catch (error) {
          console.error('Error fetching audience suggestions:', error);
          return [];
        }
      },

      // Get real-time budget estimates
      getBudgetEstimates: async function(eventId, audienceData, budget) {
        try {
          const response = await fetch('/api/marketing/campaigns/estimates', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${window.authAPI.token}`
            },
            body: JSON.stringify({ eventId, audienceData, budget })
          });
          
          if (!response.ok) throw new Error('Failed to get budget estimates');
          return await response.json();
        } catch (error) {
          console.error('Error fetching budget estimates:', error);
          return null;
        }
      },

      // Generate ad variations using AI
      generateAdVariations: async function(eventData, baseCreative) {
        try {
          const response = await fetch('/api/marketing/campaigns/generate-variations', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${window.authAPI.token}`
            },
            body: JSON.stringify({ eventData, baseCreative })
          });
          
          if (!response.ok) throw new Error('Failed to generate variations');
          return await response.json();
        } catch (error) {
          console.error('Error generating ad variations:', error);
          return [];
        }
      },

      // Get user's campaign history
      getUserCampaigns: async function() {
        try {
          const response = await fetch('/api/marketing/campaigns', {
            headers: { 
              'Authorization': `Bearer ${window.authAPI.token}`,
              'Content-Type': 'application/json'
            }
          });
          
          if (!response.ok) throw new Error('Failed to get campaigns');
          return await response.json();
        } catch (error) {
          console.error('Error fetching user campaigns:', error);
          return [];
        }
      }
    };

    // Initialize auto-save
    enableAutoSave();

    // Add keyboard shortcuts for power users
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey || e.metaKey) {
        switch(e.key) {
          case 's':
            e.preventDefault();
            saveDraft();
            break;
          case 'Enter':
            if (e.shiftKey) {
              e.preventDefault();
              if (currentStep < 5) {
                nextStep();
              } else {
                launchCampaign();
              }
            }
            break;
        }
      }
    });

    // Performance tracking for optimization
    const trackEvent = (action, data = {}) => {
      // This would integrate with Eventbrite's analytics
      if (typeof gtag !== 'undefined') {
        gtag('event', action, {
          event_category: 'campaign_creation',
          event_label: data.label || '',
          value: data.value || 0
        });
      }
      
      // Also send to internal analytics
      fetch('/api/analytics/track', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${window.authAPI.token}`
        },
        body: JSON.stringify({
          action,
          step: currentStep,
          timestamp: new Date().toISOString(),
          page: 'ad_campaigns',
          ...data
        })
      }).catch(console.error);
    };

    // Track step completions
    const originalNextStep = nextStep;
    nextStep = function() {
      trackEvent('step_completed', { step: currentStep });
      originalNextStep();
    };

    // Track campaign launches
    const originalLaunchCampaign = launchCampaign;
    launchCampaign = function() {
      trackEvent('campaign_launch_attempted', {
        budget: campaignData.budget.amount,
        audiences: campaignData.audience.sources.length,
        event_id: campaignData.event.id
      });
      originalLaunchCampaign();
    };

    console.log('Eventbrite Ad Campaign Creator initialized');

    // Authentication and User Profile Management
    async function initializeAuth() {
      try {
        console.log('🔄 Checking authentication...');
        
        if (!window.authAPI) {
          console.error('❌ AuthAPI not available');
          window.location.href = 'login.html';
          return;
        }

        const currentUser = await window.authAPI.getCurrentUser();
        
        if (!currentUser) {
          console.log('❌ User not authenticated, redirecting to login');
          localStorage.setItem('redirectAfterLogin', 'ad_campaigns_page.html');
          window.location.href = 'login.html';
          return;
        }
        
        console.log('✅ User authenticated:', currentUser.email);
        updateUserProfile(currentUser);
        await loadUserEvents();
        
      } catch (error) {
        console.error('❌ Authentication error:', error);
        window.location.href = 'login.html';
      }
    }

    function updateUserProfile(user) {
      // Update user avatar with initials
      const avatar = document.getElementById('user-avatar');
      const userName = document.getElementById('user-name');
      const userEmail = document.getElementById('user-email');
      
      let initials = 'U';
      let displayName = 'User';
      
      if (user.firstName && user.lastName) {
        initials = (user.firstName.charAt(0) + user.lastName.charAt(0)).toUpperCase();
        displayName = `${user.firstName} ${user.lastName}`;
      } else if (user.name) {
        const nameParts = user.name.split(' ');
        initials = nameParts.length > 1 ? 
          (nameParts[0].charAt(0) + nameParts[nameParts.length - 1].charAt(0)).toUpperCase() :
          user.name.charAt(0).toUpperCase();
        displayName = user.name;
      } else if (user.email) {
        initials = user.email.charAt(0).toUpperCase();
        displayName = user.email.split('@')[0];
      }
      
      avatar.textContent = initials;
      userName.textContent = displayName;
      userEmail.textContent = user.email || 'user@example.com';
      
      // Store user data for campaign creation
      campaignData.user = {
        id: user.id || user._id,
        name: displayName,
        email: user.email,
        firstName: user.firstName,
        lastName: user.lastName
      };
    }

    async function loadUserEvents() {
      try {
        console.log('🔄 Loading user events...');
        
        const response = await fetch('/api/events/user', {
          headers: {
            'Authorization': `Bearer ${window.authAPI.token}`,
            'Content-Type': 'application/json'
          }
        });
        
        if (!response.ok) {
          throw new Error('Failed to load events');
        }
        
        const events = await response.json();
        updateEventGrid(events);
        
      } catch (error) {
        console.error('❌ Error loading events:', error);
        // Show fallback events or empty state
        updateEventGrid([]);
      }
    }

    function updateEventGrid(events) {
      const eventGrid = document.querySelector('.event-grid');
      
      if (events.length === 0) {
        eventGrid.innerHTML = `
          <div style="grid-column: 1 / -1; text-align: center; padding: 40px; background: white; border-radius: 12px; border: 2px dashed #e2e8f0;">
            <div style="width: 60px; height: 60px; background: #f1f5f9; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="#94a3b8">
                <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/>
              </svg>
            </div>
            <h3 style="color: #1e293b; margin-bottom: 8px;">No events found</h3>
            <p style="color: #64748b; margin-bottom: 16px;">Create your first event to start advertising</p>
            <button onclick="window.location.href='create-events.html'" style="background: #f97316; color: white; border: none; padding: 8px 16px; border-radius: 6px; font-weight: 500; cursor: pointer;">Create Event</button>
          </div>
        `;
        return;
      }
      
      eventGrid.innerHTML = events.map((event, index) => `
        <div class="event-card" onclick="selectEvent(this, '${event.id || event._id}')">
          <div class="event-info">
            <div class="event-avatar">${getEventInitials(event.title)}</div>
            <div class="event-details">
              <div class="event-date">${formatEventDate(event.date || event.startDate)}</div>
              <div class="event-title">${event.title}</div>
            </div>
          </div>
        </div>
      `).join('');
    }

    function getEventInitials(title) {
      if (!title) return 'E';
      const words = title.split(' ');
      if (words.length >= 2) {
        return (words[0].charAt(0) + words[1].charAt(0)).toUpperCase();
      }
      return title.charAt(0).toUpperCase();
    }

    function formatEventDate(dateString) {
      if (!dateString) return 'Date TBD';
      
      try {
        const date = new Date(dateString);
        const options = { 
          weekday: 'short', 
          month: 'short', 
          day: 'numeric',
          hour: 'numeric',
          minute: '2-digit',
          hour12: true
        };
        return date.toLocaleDateString('en-US', options);
      } catch (error) {
        return 'Date TBD';
      }
    }

    // Initialize authentication when page loads
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize auth first, then existing functionality
      initializeAuth();
    });
  </script>
</body>

</html>
              