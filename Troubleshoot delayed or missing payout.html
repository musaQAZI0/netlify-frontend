<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CROWD Help Center - Troubleshoot Delayed or Missing Payouts</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }

        /* Header */
        .header {
            background: white;
            padding: 12px 20px;
            border-bottom: 1px solid #e6e6e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #d1410c;
        }

        .help-center-text {
            color: #666;
            font-size: 16px;
        }

        .search-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .search-bar {
            position: relative;
        }

        .search-input {
            padding: 8px 12px 8px 35px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 300px;
            font-size: 14px;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }

        /* User Section Styles */
        .user-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* Loading Spinner */
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #d1410c;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Login Button */
        .login-btn {
            background: #d1410c;
            color: white;
            padding: 8px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        .login-btn:hover {
            background: #b8360a;
        }

        /* User Profile */
        .user-profile {
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .user-profile:hover {
            background: #f5f5f5;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #d1410c;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }

        /* User Dropdown */
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #e6e6e6;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            min-width: 160px;
            z-index: 1000;
            display: none;
        }

        .user-dropdown.show {
            display: block;
        }

        .user-dropdown a {
            display: block;
            padding: 10px 15px;
            color: #333;
            text-decoration: none;
            font-size: 14px;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
        }

        .user-dropdown a:last-child {
            border-bottom: none;
        }

        .user-dropdown a:hover {
            background: #f5f5f5;
        }

        /* Main Content */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .breadcrumb {
            margin-bottom: 20px;
        }

        .breadcrumb a {
            color: #d1410c;
            text-decoration: none;
            font-size: 14px;
        }

        .breadcrumb::before {
            content: "< ";
            color: #d1410c;
        }

        .main-title {
            font-size: 32px;
            font-weight: bold;
            color: #39364f;
            margin-bottom: 40px;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 40px;
        }

        /* Sidebar */
        .sidebar {
            background: transparent;
        }

        .sidebar-section {
            margin-bottom: 30px;
        }

        .sidebar-title {
            font-size: 16px;
            font-weight: 600;
            color: #39364f;
            margin-bottom: 15px;
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 0;
            color: #d1410c;
            text-decoration: none;
            font-size: 14px;
        }

        .sidebar-item:hover {
            color: #b8360a;
        }

        .sidebar-item.active {
            font-weight: 600;
        }

        .sidebar-icon {
            width: 16px;
            height: 16px;
        }

        /* Main Content Area */
        .main-content {
            background: white;
            padding: 40px;
            border-radius: 8px;
        }

        /* Article styling */
        .organizing-tag {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            margin-bottom: 20px;
            display: inline-block;
        }

        .article-title {
            font-size: 28px;
            font-weight: bold;
            color: #39364f;
            margin-bottom: 20px;
        }

        .article-intro {
            background: #f8f9ff;
            border-left: 4px solid #d1410c;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
            font-size: 16px;
            line-height: 1.6;
        }

        .article-nav {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .article-nav h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #39364f;
        }

        .article-nav ul {
            list-style: none;
        }

        .article-nav li {
            margin-bottom: 8px;
        }

        .article-nav a {
            color: #d1410c;
            text-decoration: none;
            font-size: 14px;
        }

        .article-nav a:hover {
            text-decoration: underline;
        }

        h2 {
            font-size: 22px;
            font-weight: 600;
            color: #39364f;
            margin: 30px 0 20px 0;
        }

        p {
            margin-bottom: 16px;
            color: #666;
            line-height: 1.6;
        }

        .warning-box {
            background: #fff9e6;
            border: 2px solid #ffd700;
            border-radius: 8px;
            padding: 16px;
            margin: 20px 0;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .warning-box::before {
            content: "⚠️";
            font-size: 18px;
            flex-shrink: 0;
        }

        .payout-statuses {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .status-item {
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e6e6e6;
        }

        .status-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .status-label {
            font-weight: bold;
            color: #39364f;
            margin-bottom: 4px;
        }

        .status-description {
            color: #666;
        }

        .steps-list {
            counter-reset: step-counter;
            list-style: none;
            padding: 0;
            margin: 20px 0;
        }

        .steps-list li {
            counter-increment: step-counter;
            margin-bottom: 12px;
            padding-left: 40px;
            position: relative;
        }

        .steps-list li::before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            background: #d1410c;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        ul {
            margin: 16px 0 16px 24px;
        }

        ul li {
            margin-bottom: 8px;
            color: #666;
        }

        /* Contact Section */
        .contact-section {
            text-align: center;
            margin: 60px 0;
            background: white;
            padding: 40px;
            border-radius: 8px;
        }

        .contact-title {
            font-size: 24px;
            font-weight: 600;
            color: #39364f;
            margin-bottom: 30px;
        }

        .contact-btn {
            background: #d1410c;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }

        .contact-btn:hover {
            background: #b8360a;
        }

        /* Footer */
        .footer {
            background: #39364f;
            color: white;
            padding: 40px 20px 20px;
            margin-top: 60px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 40px;
            margin-bottom: 30px;
        }

        .footer-section h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section li {
            margin-bottom: 8px;
        }

        .footer-section a {
            color: #ccc;
            text-decoration: none;
            font-size: 14px;
        }

        .footer-section a:hover {
            color: white;
        }

        .footer-bottom {
            max-width: 1200px;
            margin: 0 auto;
            padding-top: 20px;
            border-top: 1px solid #555;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #ccc;
        }

        .footer-links {
            display: flex;
            gap: 20px;
        }

        .country-selector {
            background: transparent;
            border: 1px solid #555;
            color: #ccc;
            padding: 5px 10px;
            border-radius: 4px;
        }

        .ask-question-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #d1410c;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(209, 65, 12, 0.3);
        }

        .ask-question-btn:hover {
            background: #b8360a;
        }

        @media (max-width: 768px) {
            .content-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .footer-content {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
            
            .search-input {
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo-section">
            <div class="logo"><img src="logo.jpg" alt="Logo" style="height: 24px; width: auto; vertical-align: middle;"></div>
            <div class="help-center-text">Help Center</div>
        </div>
        <div class="search-section">
            <div class="search-bar">
                <span class="search-icon">🔍</span>
                <input type="text" class="search-input" placeholder="Search help articles">
            </div>
            <div class="user-section">
                <!-- Loading Spinner (shown during auth check) -->
                <div id="authLoading" class="loading-spinner"></div>

                <!-- Login Button (shown when not authenticated) -->
                <button id="loginBtn" class="login-btn" onclick="handleLogin()" style="display: none;">
                    Login
                </button>

                <!-- User Profile (shown when authenticated) -->
                <div id="userProfile" class="user-profile" onclick="toggleUserDropdown()" style="display: none;">
                    <div id="userAvatar" class="user-avatar">
                        <span id="userInitials">U</span>
                    </div>
                    <span id="userName">User</span>
                    <span>▼</span>

                    <!-- User Dropdown Menu -->
                    <div id="userDropdown" class="user-dropdown">
                        <a href="#" onclick="viewProfile()">View Profile</a>
                        <a href="#" onclick="accountSettings()">Account Settings</a>
                        <a href="#" onclick="organizerDashboard()">Organizer Dashboard</a>
                        <a href="#" onclick="handleLogout()">Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <div class="breadcrumb">
            <a href="../Help_center.html">Help Center</a>
        </div>

        <h1 class="main-title">Troubleshoot delayed or missing payouts</h1>

        <div class="content-grid">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="sidebar-section">
                    <div class="sidebar-title">Organizing an event topics</div>
                    
                    <a href="#" class="sidebar-item">
                        <span class="sidebar-icon">📅</span>
                        Creating an event
                    </a>
                    
                    <a href="Add images and video to your event.html" class="sidebar-item">
                        <span class="sidebar-icon">🖼️</span>
                        Add images and video
                    </a>
                    
                    <a href="Create and edit ticket types.html" class="sidebar-item">
                        <span class="sidebar-icon">🎫</span>
                        Create and edit ticket types
                    </a>
                    
                    <a href="Managing orders.html" class="sidebar-item">
                        <span class="sidebar-icon">📋</span>
                        Managing orders
                    </a>
                    
                    <a href="Marketing_an_event_help_center.html" class="sidebar-item">
                        <span class="sidebar-icon">📢</span>
                        Marketing an event
                    </a>
                    
                    <a href="Payouts and taxes.html" class="sidebar-item">
                        <span class="sidebar-icon">💰</span>
                        Payouts and taxes
                    </a>
                    
                    <a href="#" class="sidebar-item active">
                        <span class="sidebar-icon">🚨</span>
                        Troubleshoot payouts
                    </a>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <div class="organizing-tag">Organizing an event</div>
                
                <h1 class="article-title">Troubleshoot delayed or missing payouts</h1>
                
                <div class="article-intro">
                    <p>After you host your event, your payout will typically arrive in your bank account within 5-7 business days. If your payout is delayed, check your inbox for an email from CROWD about any issues preventing your payout. Then, go to <strong>Finance</strong> to confirm your payout status.</p>
                </div>

                <div class="article-nav">
                    <h3>In this article</h3>
                    <ul>
                        <li><a href="#timeline">Review your payout timeline</a></li>
                        <li><a href="#email">Check your email</a></li>
                        <li><a href="#status">Check your payout status</a></li>
                        <li><a href="#bank-info">Review the bank account information for the event</a></li>
                        <li><a href="#organization">Complete your Organization Profile</a></li>
                        <li><a href="#cancelled">If your event is cancelled or postponed</a></li>
                        <li><a href="#trace-id">Contact your bank with the trace ID (U.S. only)</a></li>
                        <li><a href="#resend">Resend your check payout (USD only)</a></li>
                    </ul>
                </div>

                <h2 id="timeline">Review your payout timeline</h2>
                <p>CROWD sends your payout three days after your event completes. Once sent, your bank deposits the money in your account within 3-5 business days for U.S. payouts and 5-7 business days for payouts in other countries.</p>
                
                <p>Contact your bank if you have any questions about when they will deposit the funds. <a href="#" style="color: #d1410c;">Confirm your payout schedule</a> if you're expecting payouts before your event ends.</p>
                
                <p>If it's been over 60 days since your event ended, your payout won't automatically send. <a href="#" style="color: #d1410c;">Contact us</a> to verify your payout's eligibility and manually release your payout.</p>
                
                <h2 id="email">Check your email</h2>
                <p>Check the email associated with your CROWD account. If there's an issue that requires you to take action, CROWD sends an email. This generally happens when your account is missing required information or CROWD needs more information about you and your event. Check your junk and spam folders, too.</p>
                
                <div class="warning-box">
                    <div>
                        <p><strong>Important:</strong> CROWD emails always come from an @crowd.com email address. Verify the sender before replying.</p>
                    </div>
                </div>
                
                <h2 id="status">Check your payout status</h2>
                <p>Go to <strong>Finance</strong> and select <strong>Payouts</strong>. Then, locate the payout. You should find one of the following statuses:</p>
                
                <div class="payout-statuses">
                    <div class="status-item">
                        <div class="status-label">Processing:</div>
                        <div class="status-description">CROWD will send your payout on the next business day.</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Sent:</div>
                        <div class="status-description">Your payout is on its way to the payout method you selected.</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Returned:</div>
                        <div class="status-description">The bank didn't accept the payment. <a href="#" style="color: #d1410c;">Follow these steps to reissue your payout.</a></div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Cancelled:</div>
                        <div class="status-description">When you reissue a payout, the original payout is cancelled.</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Expired (U.S. only):</div>
                        <div class="status-description">Your check payout wasn't deposited within 90 days. <a href="#" style="color: #d1410c;">Follow these steps to reissue your payout.</a></div>
                    </div>
                </div>
                
                <p>If you can't find a payout that should be listed, then it hasn't begun processing yet. Review the other information in this article to check why it might be delayed.</p>
                
                <h2 id="bank-info">Review the bank account information for the event</h2>
                <p>There are a few reasons why your event might not have a payout method. If your event has ended and the payout isn't processing, make sure you've <a href="#" style="color: #d1410c;">added a bank account for the event</a>:</p>
                
                <ol class="steps-list">
                    <li>Go to <strong>Events</strong> and select your event.</li>
                    <li>Go to <strong>Payments & tax</strong>.</li>
                    <li>Go to <strong>Payment options</strong>.</li>
                    <li>Select <strong>Manage payout method</strong>.</li>
                    <li>Choose a payout method or select <strong>Add bank account</strong>.</li>
                    <li>(Optional) Select <strong>Confirm as default</strong>.</li>
                </ol>
                
                <p>CROWD sends eligible payouts on the following business day.</p>
                
                <h2 id="organization">Complete your Organization Profile</h2>
                <p>CROWD uses Stripe to verify and process payments if your bank is located in Australia, Canada, the United Kingdom, or the United States. To ensure that CROWD can pay you promptly and securely, you must complete your Organization Profile. <a href="#" style="color: #d1410c;">Verify your financial information through Stripe</a> to prevent payout delays.</p>
                
                <h2 id="cancelled">If your event is cancelled or postponed</h2>
                <p>CROWD automatically holds your payout when you postpone or cancel your event. This allows you to easily refund ticket buyers.</p>
                
                <p><strong>Cancelled events:</strong> <a href="#" style="color: #d1410c;">CROWD Cancelled Events Policy</a> requires refunds when an event is cancelled.</p>
                
                <p><strong>Postponed Events:</strong> <a href="#" style="color: #d1410c;">CROWD's Postponed Events Policy</a> requires the following:</p>
                
                <ul>
                    <li>You have 90 days to set and communicate a new event date once you've postponed your event. If you don't have a new date after 90 days, you're required to issue a refund upon attendee request for the next 45 days and until a new date has been communicated.</li>
                    <li>Your payout won't process until the event takes place. If you rescheduled and hosted your event but haven't received your payout within the standard timeline, please <a href="#" style="color: #d1410c;">submit a payout request</a>.</li>
                </ul>
                
                <h2 id="trace-id">Contact your bank with the trace ID (U.S. only)</h2>
                <p>If your payout status shows as sent but you haven't received it within five business days, locate the Trace ID:</p>
                
                <ol class="steps-list">
                    <li>Go to <strong>Finance</strong> and select <strong>Payouts</strong>.</li>
                    <li>Select your payout.</li>
                    <li>Note the trace ID associated with the payout.</li>
                </ol>
                
                <p>Contact your bank and share the trace ID. This will help them track the payout and deposit the funds into your account.</p>
                
                <h2 id="resend">Resend your check payout (USD only)</h2>
                <p>Checks expire after 90 days. If your check has expired, you need to <a href="#" style="color: #d1410c;">reissue your payout</a>. If you haven't received your check after 10 business days, <a href="#" style="color: #d1410c;">contact us</a> to resend it.</p>
            </div>
        </div>

        <!-- Contact Section -->
        <div class="contact-section">
            <h2 class="contact-title">Still have questions?</h2>
            <a href="#" class="contact-btn">Contact us</a>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Use CROWD</h3>
                <ul>
                    <li><a href="#">Create events</a></li>
                    <li><a href="#">Community Guidelines</a></li>
                    <li><a href="#">Pricing</a></li>
                    <li><a href="#">Pricing Calculator</a></li>
                    <li><a href="#">Site status</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Browse resources</h3>
                <ul>
                    <li><a href="#">Organizer Resource Hub</a></li>
                    <li><a href="#">Reconvene virtual sessions for organizers</a></li>
                    <li><a href="#">Taxes</a></li>
                    <li><a href="#">Webinars for new organizers</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Download apps</h3>
                <ul>
                    <li><a href="#">CROWD app for Android</a></li>
                    <li><a href="#">CROWD app for iOS</a></li>
                    <li><a href="#">CROWD Organizer app</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Connect with us</h3>
                <ul>
                    <li><a href="#">Contact support</a></li>
                    <li><a href="#">Facebook</a></li>
                    <li><a href="#">Instagram</a></li>
                    <li><a href="#">X</a></li>
                    <li><a href="#">TikTok</a></li>
                </ul>
            </div>
        </div>
        
        <div class="footer-bottom">
            <div>
                <span>© 2025 CROWD</span>
                <div class="footer-links">
                    <a href="#">About</a>
                    <a href="#">Blog</a>
                    <a href="#">Help</a>
                    <a href="#">Careers</a>
                    <a href="#">Press</a>
                    <a href="#">Security</a>
                    <a href="#">Developers</a>
                    <a href="#">Terms</a>
                    <a href="#">Privacy</a>
                    <a href="#">Accessibility</a>
                    <a href="#">Cookies</a>
                    <a href="#">Manage Cookie Preferences</a>
                </div>
            </div>
            <select class="country-selector">
                <option>United States</option>
            </select>
        </div>
    </div>

    <!-- Floating Ask Question Button -->
    <button class="ask-question-btn">
        💬 Ask a question
    </button>

    <script>
        // Authentication state management
        let isAuthenticated = false;
        let currentUser = null;

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            checkAuthStatus();
        });

        // Check authentication status
        async function checkAuthStatus() {
            try {
                document.getElementById('authLoading').style.display = 'block';
                document.getElementById('loginBtn').style.display = 'none';
                document.getElementById('userProfile').style.display = 'none';

                const token = localStorage.getItem('token') || localStorage.getItem('authToken');
                const headers = {
                    'Content-Type': 'application/json'
                };
                
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }

                const response = await fetch('/api/auth/check', {
                    method: 'GET',
                    credentials: 'include',
                    headers: headers
                });

                if (response.ok) {
                    const userData = await response.json();
                    if (userData.isAuthenticated && userData.user) {
                        localStorage.setItem('currentUser', JSON.stringify(userData.user));
                        setAuthenticatedState(userData.user);
                    } else {
                        clearAuthData();
                        setUnauthenticatedState();
                    }
                } else {
                    clearAuthData();
                    setUnauthenticatedState();
                }
            } catch (error) {
                console.error('Auth check failed:', error);
                const token = localStorage.getItem('token') || localStorage.getItem('authToken');
                if (token) {
                    clearAuthData();
                }
                setUnauthenticatedState();
            }
        }

        // Set authenticated state
        function setAuthenticatedState(user) {
            isAuthenticated = true;
            currentUser = user;

            document.getElementById('authLoading').style.display = 'none';
            document.getElementById('loginBtn').style.display = 'none';
            document.getElementById('userProfile').style.display = 'flex';

            const displayName = user.firstName && user.lastName 
                ? `${user.firstName} ${user.lastName}` 
                : user.firstName || user.lastName || user.email || 'User';
            
            document.getElementById('userName').textContent = displayName;

            const initials = generateInitials(displayName);
            document.getElementById('userInitials').textContent = initials;

            const avatarColor = generateAvatarColor(user._id || user.email);
            document.getElementById('userAvatar').style.backgroundColor = avatarColor;
        }

        // Set unauthenticated state
        function setUnauthenticatedState() {
            isAuthenticated = false;
            currentUser = null;

            document.getElementById('authLoading').style.display = 'none';
            document.getElementById('userProfile').style.display = 'none';
            document.getElementById('loginBtn').style.display = 'block';
        }

        // Generate initials from name
        function generateInitials(name) {
            if (!name) return 'U';
            const words = name.trim().split(' ');
            if (words.length === 1) {
                return words[0].charAt(0).toUpperCase();
            } else {
                return (words[0].charAt(0) + words[words.length - 1].charAt(0)).toUpperCase();
            }
        }

        // Generate avatar color based on user identifier
        function generateAvatarColor(identifier) {
            const colors = [
                '#4285f4', '#ea4335', '#34a853', '#fbbc05',
                '#ff6d01', '#9c27b0', '#00bcd4', '#ff5722',
                '#795548', '#607d8b', '#e91e63', '#3f51b5'
            ];
            if (!identifier) return colors[0];
            let hash = 0;
            for (let i = 0; i < identifier.length; i++) {
                hash = identifier.charCodeAt(i) + ((hash << 5) - hash);
            }
            return colors[Math.abs(hash) % colors.length];
        }

        // Handle login
        async function handleLogin() {
            window.location.href = 'login.html';
        }

        // Handle logout
        async function handleLogout() {
            try {
                const token = localStorage.getItem('token') || localStorage.getItem('authToken');
                const headers = {
                    'Content-Type': 'application/json'
                };
                
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }

                await fetch('/api/auth/logout', {
                    method: 'POST',
                    credentials: 'include',
                    headers: headers
                });

                clearAuthData();
                setUnauthenticatedState();
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Logout error:', error);
                clearAuthData();
                setUnauthenticatedState();
                window.location.href = 'index.html';
            }
            document.getElementById('userDropdown').classList.remove('show');
        }

        // Toggle user dropdown
        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }

        // View profile
        function viewProfile() {
            window.location.href = 'Your account.html';
        }

        // Account settings
        function accountSettings() {
            window.location.href = 'Your account.html';
        }

        // Organizer dashboard
        function organizerDashboard() {
            if (currentUser && currentUser.role === 'organizer') {
                window.location.href = 'organizer-dashboard.html';
            } else {
                alert('Organizer access required');
            }
        }

        // Clear authentication data
        function clearAuthData() {
            localStorage.removeItem('token');
            localStorage.removeItem('authToken');
            localStorage.removeItem('currentUser');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('#userProfile')) {
                document.getElementById('userDropdown').classList.remove('show');
            }
        });

        // Periodic auth refresh
        setInterval(checkAuthStatus, 5 * 60 * 1000); // Check every 5 minutes
    </script>
</body>
</html>