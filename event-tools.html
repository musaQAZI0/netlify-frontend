<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Tools - CROWD</title>
    <link rel="stylesheet" href="event-tools-styles.css">
    <script src="https://cdn.jsdelivr.net/npm/qr-scanner@1.4.2/qr-scanner.umd.min.js"></script>
    <script src="https://unpkg.com/fabric@5.3.0/dist/fabric.min.js"></script>
    <style>
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes scanPulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="tools-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="#f05537">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                    <span>crowd</span>
                    <span class="tools-badge">Event Tools</span>
                </div>
                <div class="header-right">
                    <button class="back-btn" onclick="goBack()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M15 18l-6-6 6-6"/>
                        </svg>
                        Back
                    </button>
                    <div class="user-menu">
                        <div class="user-avatar" id="userAvatar">U</div>
                        <span class="user-name" id="userName">Loading...</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Tools Navigation -->
            <div class="tools-nav">
                <button class="tool-tab active" data-tool="scanner" onclick="switchTool('scanner')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M3 7V5a2 2 0 0 1 2-2h2"/>
                        <path d="M17 3h2a2 2 0 0 1 2 2v2"/>
                        <path d="M21 17v2a2 2 0 0 1-2 2h-2"/>
                        <path d="M7 21H5a2 2 0 0 1-2-2v-2"/>
                        <path d="M8 12h8"/>
                    </svg>
                    QR Scanner
                </button>
                <button class="tool-tab" data-tool="seating" onclick="switchTool('seating')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" x2="16" y1="2" y2="6"/>
                        <line x1="8" x2="8" y1="2" y2="6"/>
                        <line x1="3" x2="21" y1="10" y2="10"/>
                    </svg>
                    AI Seating
                </button>
                <button class="tool-tab" data-tool="venues" onclick="switchTool('venues')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                        <circle cx="12" cy="10" r="3"/>
                    </svg>
                    Venues
                </button>
                <button class="tool-tab" data-tool="influencers" onclick="switchTool('influencers')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                    Influencers
                </button>
            </div>

            <!-- QR Scanner Tool -->
            <div class="tool-panel active" id="scanner-panel">
                <div class="tool-header">
                    <h2>QR Code Ticket Scanner</h2>
                    <p>Scan tickets at the door to verify attendance and manage check-ins</p>
                </div>

                <div class="scanner-container">
                    <div class="scanner-main">
                        <div class="camera-container">
                            <video id="qr-video" class="scanner-video"></video>
                            <div class="scanner-overlay">
                                <div class="scan-frame">
                                    <div class="corner top-left"></div>
                                    <div class="corner top-right"></div>
                                    <div class="corner bottom-left"></div>
                                    <div class="corner bottom-right"></div>
                                </div>
                                <div class="scan-line"></div>
                            </div>
                            <div class="scanner-status" id="scanner-status">
                                <span class="status-text">Position QR code within the frame</span>
                            </div>
                        </div>

                        <div class="scanner-controls">
                            <button class="scanner-btn primary" id="start-scanner" onclick="startScanner()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <polygon points="5,3 19,12 5,21"/>
                                </svg>
                                Start Scanner
                            </button>
                            <button class="scanner-btn secondary" id="stop-scanner" onclick="stopScanner()" style="display: none;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <rect x="6" y="4" width="4" height="16"/>
                                    <rect x="14" y="4" width="4" height="16"/>
                                </svg>
                                Stop Scanner
                            </button>
                            <button class="scanner-btn" onclick="switchCamera()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M16 4h2a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
                                    <rect x="8" y="2" width="8" height="4" rx="1" ry="1"/>
                                </svg>
                                Switch Camera
                            </button>
                        </div>
                    </div>

                    <div class="scan-results">
                        <h3>Recent Scans</h3>
                        <div class="scan-stats">
                            <div class="stat-item">
                                <span class="stat-number" id="successful-scans">0</span>
                                <span class="stat-label">Successful</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number" id="failed-scans">0</span>
                                <span class="stat-label">Failed</span>
                            </div>
                        </div>
                        <div class="scan-list" id="scan-list">
                            <!-- Scan results will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Seating Chart Tool -->
            <div class="tool-panel" id="seating-panel">
                <div class="tool-header">
                    <h2>AI Seating Chart Generator</h2>
                    <p>Generate optimal seating arrangements based on guest compatibility and preferences</p>
                </div>

                <div class="seating-container">
                    <div class="seating-controls">
                        <div class="control-section">
                            <h4>Event Configuration</h4>
                            <div class="control-grid">
                                <div class="control-group">
                                    <label>Event Type</label>
                                    <select id="event-type">
                                        <option value="conference">Conference</option>
                                        <option value="wedding">Wedding</option>
                                        <option value="corporate">Corporate Event</option>
                                        <option value="gala">Gala Dinner</option>
                                        <option value="networking">Networking</option>
                                    </select>
                                </div>
                                <div class="control-group">
                                    <label>Total Guests</label>
                                    <input type="number" id="total-guests" value="50" min="10" max="500">
                                </div>
                                <div class="control-group">
                                    <label>Table Size</label>
                                    <select id="table-size">
                                        <option value="6">6 people per table</option>
                                        <option value="8" selected>8 people per table</option>
                                        <option value="10">10 people per table</option>
                                        <option value="12">12 people per table</option>
                                    </select>
                                </div>
                                <div class="control-group">
                                    <label>Room Layout</label>
                                    <select id="room-layout">
                                        <option value="rectangular" selected>Rectangular</option>
                                        <option value="circular">Circular</option>
                                        <option value="u-shape">U-Shape</option>
                                        <option value="theater">Theater Style</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="control-section">
                            <h4>AI Optimization Settings</h4>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="optimize-networking" checked>
                                    Optimize for networking
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="separate-competitors">
                                    Separate competitors
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="group-by-interest" checked>
                                    Group by interests
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="vip-placement" checked>
                                    VIP table placement
                                </label>
                            </div>
                        </div>

                        <div class="control-section">
                            <button class="generate-btn" onclick="generateSeatingChart()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                                    <path d="M2 17l10 5 10-5"/>
                                    <path d="M2 12l10 5 10-5"/>
                                </svg>
                                Generate AI Seating Chart
                            </button>
                        </div>
                    </div>

                    <div class="seating-chart">
                        <div class="chart-header">
                            <h4>Seating Arrangement</h4>
                            <div class="chart-actions">
                                <button class="chart-action" onclick="exportSeatingChart()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                        <polyline points="7,10 12,15 17,10"/>
                                        <line x1="12" x2="12" y1="15" y2="3"/>
                                    </svg>
                                    Export
                                </button>
                                <button class="chart-action" onclick="regenerateChart()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                        <polyline points="23,4 23,10 17,10"/>
                                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                                    </svg>
                                    Regenerate
                                </button>
                            </div>
                        </div>
                        <canvas id="seating-canvas" width="800" height="600"></canvas>
                        <div class="chart-legend">
                            <div class="legend-item">
                                <div class="legend-color vip"></div>
                                <span>VIP Tables</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color regular"></div>
                                <span>Regular Tables</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color stage"></div>
                                <span>Stage/Presentation Area</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Venue Directory Tool -->
            <div class="tool-panel" id="venues-panel">
                <div class="tool-header">
                    <h2>Venue Directory</h2>
                    <p>Browse and connect with venues available for hosting events</p>
                </div>

                <div class="directory-container">
                    <div class="directory-filters">
                        <div class="filter-section">
                            <h4>Search & Filter</h4>
                            <div class="search-bar">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <circle cx="11" cy="11" r="8"/>
                                    <path d="m21 21-4.35-4.35"/>
                                </svg>
                                <input type="text" placeholder="Search venues..." id="venue-search">
                            </div>
                            <div class="filter-grid">
                                <div class="filter-group">
                                    <label>Location</label>
                                    <select id="venue-location">
                                        <option value="">All Locations</option>
                                        <option value="new-york">New York</option>
                                        <option value="los-angeles">Los Angeles</option>
                                        <option value="chicago">Chicago</option>
                                        <option value="miami">Miami</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label>Venue Type</label>
                                    <select id="venue-type">
                                        <option value="">All Types</option>
                                        <option value="conference-center">Conference Center</option>
                                        <option value="hotel">Hotel</option>
                                        <option value="restaurant">Restaurant</option>
                                        <option value="outdoor">Outdoor Space</option>
                                        <option value="gallery">Gallery</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label>Capacity</label>
                                    <select id="venue-capacity">
                                        <option value="">Any Size</option>
                                        <option value="0-50">Up to 50</option>
                                        <option value="50-100">50-100</option>
                                        <option value="100-200">100-200</option>
                                        <option value="200+">200+</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label>Price Range</label>
                                    <select id="venue-price">
                                        <option value="">Any Price</option>
                                        <option value="budget">Budget ($)</option>
                                        <option value="mid-range">Mid-range ($$)</option>
                                        <option value="premium">Premium ($$$)</option>
                                        <option value="luxury">Luxury ($$$$)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="venue-grid" id="venue-grid">
                        <!-- Venues will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Influencer Directory Tool -->
            <div class="tool-panel" id="influencers-panel">
                <div class="tool-header">
                    <h2>Influencer Directory</h2>
                    <p>Connect with influencers to promote and enhance your events</p>
                </div>

                <div class="directory-container">
                    <div class="directory-filters">
                        <div class="filter-section">
                            <h4>Search & Filter</h4>
                            <div class="search-bar">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <circle cx="11" cy="11" r="8"/>
                                    <path d="m21 21-4.35-4.35"/>
                                </svg>
                                <input type="text" placeholder="Search influencers..." id="influencer-search">
                            </div>
                            <div class="filter-grid">
                                <div class="filter-group">
                                    <label>Category</label>
                                    <select id="influencer-category">
                                        <option value="">All Categories</option>
                                        <option value="lifestyle">Lifestyle</option>
                                        <option value="business">Business</option>
                                        <option value="tech">Technology</option>
                                        <option value="food">Food & Drink</option>
                                        <option value="travel">Travel</option>
                                        <option value="fitness">Fitness</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label>Followers</label>
                                    <select id="influencer-followers">
                                        <option value="">Any Size</option>
                                        <option value="micro">Micro (1K-10K)</option>
                                        <option value="mid">Mid-tier (10K-100K)</option>
                                        <option value="macro">Macro (100K-1M)</option>
                                        <option value="mega">Mega (1M+)</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label>Platform</label>
                                    <select id="influencer-platform">
                                        <option value="">All Platforms</option>
                                        <option value="instagram">Instagram</option>
                                        <option value="tiktok">TikTok</option>
                                        <option value="youtube">YouTube</option>
                                        <option value="linkedin">LinkedIn</option>
                                        <option value="twitter">Twitter</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label>Rate Range</label>
                                    <select id="influencer-rate">
                                        <option value="">Any Rate</option>
                                        <option value="0-500">$0 - $500</option>
                                        <option value="500-1000">$500 - $1,000</option>
                                        <option value="1000-5000">$1,000 - $5,000</option>
                                        <option value="5000+">$5,000+</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="influencer-grid" id="influencer-grid">
                        <!-- Influencers will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            API_BASE_URL: window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
                ? 'http://localhost:3000'
                : 'https://crowd-backend-zxxp.onrender.com',
            TOKEN_KEY: 'authToken'
        };

        let qrScanner = null;
        let seatingCanvas = null;
        let scanCount = { successful: 0, failed: 0 };

        // Utility functions
        function sanitizeInput(input) {
            if (typeof input !== 'string') return input;
            return input.trim().replace(/[<>\"'&]/g, function(match) {
                const htmlEscapes = {
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#39;',
                    '&': '&amp;'
                };
                return htmlEscapes[match];
            });
        }

        async function makeApiRequest(url, options = {}) {
            try {
                const response = await fetch(url, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                return await response.json();
            } catch (error) {
                console.error('API Request failed:', error);
                throw error;
            }
        }

        function getAuthToken() {
            return localStorage.getItem(CONFIG.TOKEN_KEY) || '';
        }

        // Authentication and initialization
        async function checkAuthentication() {
            try {
                const token = getAuthToken();
                if (!token) return false;

                const data = await makeApiRequest(`${CONFIG.API_BASE_URL}/api/auth/verify`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                return data.success;
            } catch (error) {
                return false;
            }
        }

        async function loadUserData() {
            try {
                const data = await makeApiRequest(`${CONFIG.API_BASE_URL}/api/auth/profile`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${getAuthToken()}`
                    }
                });

                if (data.success && data.user) {
                    const user = data.user;
                    const firstName = sanitizeInput(user.firstName || '');
                    const lastName = sanitizeInput(user.lastName || '');
                    const initials = (firstName.charAt(0) + lastName.charAt(0)).toUpperCase() || 'U';
                    const fullName = `${firstName} ${lastName}`.trim() || 'User';

                    document.getElementById('userAvatar').textContent = initials;
                    document.getElementById('userName').textContent = fullName;
                }
            } catch (error) {
                console.error('Failed to load user data:', error);
            }
        }

        // Tool switching
        function switchTool(toolName) {
            // Update tab states
            document.querySelectorAll('.tool-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tool="${toolName}"]`).classList.add('active');

            // Update panel visibility
            document.querySelectorAll('.tool-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.getElementById(`${toolName}-panel`).classList.add('active');

            // Initialize tool-specific functionality
            if (toolName === 'seating' && !seatingCanvas) {
                initializeSeatingCanvas();
            }
        }

        // QR Scanner functions
        async function startScanner() {
            try {
                const video = document.getElementById('qr-video');
                const startBtn = document.getElementById('start-scanner');
                const stopBtn = document.getElementById('stop-scanner');
                const status = document.getElementById('scanner-status');

                // Show loading state
                startBtn.style.display = 'none';
                stopBtn.style.display = 'inline-flex';
                status.querySelector('.status-text').textContent = 'Starting camera...';

                // Initialize QR scanner
                qrScanner = new QrScanner(video, result => {
                    handleScanResult(result.data);
                }, {
                    onDecodeError: error => {
                        console.log('QR scan error:', error);
                    },
                    highlightScanRegion: true,
                    highlightCodeOutline: true,
                });

                await qrScanner.start();
                status.querySelector('.status-text').textContent = 'Scanning... Position QR code within frame';

            } catch (error) {
                console.error('Error starting scanner:', error);
                document.getElementById('scanner-status').querySelector('.status-text').textContent = 'Error: ' + error.message;
            }
        }

        function stopScanner() {
            if (qrScanner) {
                qrScanner.stop();
                qrScanner.destroy();
                qrScanner = null;
            }

            document.getElementById('start-scanner').style.display = 'inline-flex';
            document.getElementById('stop-scanner').style.display = 'none';
            document.getElementById('scanner-status').querySelector('.status-text').textContent = 'Scanner stopped';
        }

        function switchCamera() {
            if (qrScanner) {
                qrScanner.setCamera('environment').catch(() => {
                    qrScanner.setCamera('user').catch(err => {
                        console.error('Camera switch failed:', err);
                    });
                });
            }
        }

        function handleScanResult(qrData) {
            console.log('QR Code scanned:', qrData);

            try {
                // Parse QR data (assuming it's JSON with ticket info)
                const ticketData = JSON.parse(qrData);

                if (ticketData.ticketId && ticketData.eventId) {
                    // Valid ticket format
                    scanCount.successful++;
                    addScanResult(ticketData, 'success');

                    // Play success sound or vibration
                    if (navigator.vibrate) {
                        navigator.vibrate(100);
                    }
                } else {
                    throw new Error('Invalid ticket format');
                }
            } catch (error) {
                // Invalid QR code
                scanCount.failed++;
                addScanResult({ data: qrData, error: error.message }, 'error');

                // Play error sound or vibration
                if (navigator.vibrate) {
                    navigator.vibrate([100, 50, 100]);
                }
            }

            updateScanStats();
        }

        function addScanResult(data, type) {
            const scanList = document.getElementById('scan-list');
            const resultDiv = document.createElement('div');
            resultDiv.className = `scan-result ${type}`;

            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'success' ? '✓' : '✗';
            const color = type === 'success' ? '#16a34a' : '#dc2626';

            resultDiv.innerHTML = `
                <div class="result-icon" style="color: ${color}">${icon}</div>
                <div class="result-info">
                    <div class="result-main">${type === 'success' ? `Ticket ${data.ticketId}` : 'Invalid QR Code'}</div>
                    <div class="result-time">${timestamp}</div>
                </div>
            `;

            scanList.insertBefore(resultDiv, scanList.firstChild);

            // Keep only last 10 results
            while (scanList.children.length > 10) {
                scanList.removeChild(scanList.lastChild);
            }
        }

        function updateScanStats() {
            document.getElementById('successful-scans').textContent = scanCount.successful;
            document.getElementById('failed-scans').textContent = scanCount.failed;
        }

        // AI Seating Chart functions
        function initializeSeatingCanvas() {
            const canvas = new fabric.Canvas('seating-canvas');
            seatingCanvas = canvas;

            canvas.setWidth(800);
            canvas.setHeight(600);
            canvas.setBackgroundColor('#f8fafc', canvas.renderAll.bind(canvas));

            // Add some sample elements
            generateSampleSeatingChart();
        }

        function generateSampleSeatingChart() {
            if (!seatingCanvas) return;

            seatingCanvas.clear();
            seatingCanvas.setBackgroundColor('#f8fafc', seatingCanvas.renderAll.bind(seatingCanvas));

            const totalGuests = parseInt(document.getElementById('total-guests').value) || 50;
            const tableSize = parseInt(document.getElementById('table-size').value) || 8;
            const numTables = Math.ceil(totalGuests / tableSize);

            // Create tables in a grid layout
            const cols = Math.ceil(Math.sqrt(numTables));
            const rows = Math.ceil(numTables / cols);
            const tableRadius = 30;
            const spacing = 120;

            for (let i = 0; i < numTables; i++) {
                const row = Math.floor(i / cols);
                const col = i % cols;

                const x = col * spacing + spacing;
                const y = row * spacing + spacing;

                // Create table
                const table = new fabric.Circle({
                    left: x,
                    top: y,
                    radius: tableRadius,
                    fill: i < 2 ? '#fbbf24' : '#3b82f6', // First 2 tables are VIP
                    stroke: '#1f2937',
                    strokeWidth: 2
                });

                // Add table number
                const tableNumber = new fabric.Text(`T${i + 1}`, {
                    left: x + tableRadius - 10,
                    top: y + tableRadius - 8,
                    fontSize: 12,
                    fill: 'white',
                    fontWeight: 'bold'
                });

                seatingCanvas.add(table);
                seatingCanvas.add(tableNumber);
            }

            // Add stage/presentation area
            const stage = new fabric.Rect({
                left: 50,
                top: 50,
                width: 200,
                height: 60,
                fill: '#ef4444',
                stroke: '#dc2626',
                strokeWidth: 2
            });

            const stageText = new fabric.Text('STAGE', {
                left: 130,
                top: 70,
                fontSize: 16,
                fill: 'white',
                fontWeight: 'bold'
            });

            seatingCanvas.add(stage);
            seatingCanvas.add(stageText);

            seatingCanvas.renderAll();
        }

        function generateSeatingChart() {
            // Show loading state
            const generateBtn = document.querySelector('.generate-btn');
            const originalText = generateBtn.innerHTML;
            generateBtn.innerHTML = `
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="spin">
                    <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                    <path d="M2 17l10 5 10-5"/>
                    <path d="M2 12l10 5 10-5"/>
                </svg>
                Generating...
            `;
            generateBtn.disabled = true;

            // Simulate AI processing delay
            setTimeout(() => {
                generateSampleSeatingChart();
                generateBtn.innerHTML = originalText;
                generateBtn.disabled = false;
            }, 2000);
        }

        function exportSeatingChart() {
            if (!seatingCanvas) return;

            const dataURL = seatingCanvas.toDataURL({
                format: 'png',
                quality: 1
            });

            const link = document.createElement('a');
            link.download = 'seating-chart.png';
            link.href = dataURL;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function regenerateChart() {
            generateSeatingChart();
        }

        // Directory functions
        function loadVenues() {
            const venueGrid = document.getElementById('venue-grid');

            // Sample venues data
            const venues = [
                {
                    name: "Grand Conference Center",
                    location: "New York, NY",
                    type: "Conference Center",
                    capacity: "500+",
                    price: "$$$",
                    rating: 4.8,
                    image: "https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=300&h=200&fit=crop"
                },
                {
                    name: "Skyline Hotel & Suites",
                    location: "Los Angeles, CA",
                    type: "Hotel",
                    capacity: "200-300",
                    price: "$$$$",
                    rating: 4.6,
                    image: "https://images.unsplash.com/photo-1564501049412-61c2a3083791?w=300&h=200&fit=crop"
                },
                // Add more sample venues...
            ];

            venueGrid.innerHTML = venues.map(venue => `
                <div class="directory-card">
                    <div class="card-image" style="background-image: url('${venue.image}')"></div>
                    <div class="card-content">
                        <h4>${venue.name}</h4>
                        <p class="card-location">📍 ${venue.location}</p>
                        <div class="card-details">
                            <span class="detail-tag">${venue.type}</span>
                            <span class="detail-tag">${venue.capacity} guests</span>
                            <span class="detail-tag">${venue.price}</span>
                        </div>
                        <div class="card-footer">
                            <span class="rating">⭐ ${venue.rating}</span>
                            <button class="contact-btn">Contact</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadInfluencers() {
            const influencerGrid = document.getElementById('influencer-grid');

            // Sample influencers data
            const influencers = [
                {
                    name: "Sarah Johnson",
                    category: "Lifestyle",
                    followers: "250K",
                    platform: "Instagram",
                    rate: "$500-1000",
                    engagement: "4.2%",
                    avatar: "https://images.unsplash.com/photo-1494790108755-2616b612b8e5?w=150&h=150&fit=crop&crop=face"
                },
                {
                    name: "Mike Chen",
                    category: "Tech",
                    followers: "180K",
                    platform: "YouTube",
                    rate: "$1000-2000",
                    engagement: "3.8%",
                    avatar: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face"
                },
                // Add more sample influencers...
            ];

            influencerGrid.innerHTML = influencers.map(influencer => `
                <div class="directory-card">
                    <div class="influencer-header">
                        <img src="${influencer.avatar}" alt="${influencer.name}" class="influencer-avatar">
                        <div class="influencer-info">
                            <h4>${influencer.name}</h4>
                            <p class="influencer-category">${influencer.category}</p>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="influencer-stats">
                            <div class="stat-item">
                                <span class="stat-value">${influencer.followers}</span>
                                <span class="stat-label">Followers</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value">${influencer.engagement}</span>
                                <span class="stat-label">Engagement</span>
                            </div>
                        </div>
                        <div class="card-details">
                            <span class="detail-tag">${influencer.platform}</span>
                            <span class="detail-tag">${influencer.rate}</span>
                        </div>
                        <div class="card-footer">
                            <button class="contact-btn primary">Connect</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Navigation
        function goBack() {
            window.history.back() || (window.location.href = 'dashboard-home.html');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async function() {
            const isAuthenticated = await checkAuthentication();
            if (!isAuthenticated) {
                window.location.href = 'login.html';
                return;
            }

            await loadUserData();
            loadVenues();
            loadInfluencers();

            // Set up event listeners for filters
            const filters = ['venue-search', 'venue-location', 'venue-type', 'venue-capacity', 'venue-price'];
            filters.forEach(filterId => {
                const element = document.getElementById(filterId);
                if (element) {
                    element.addEventListener('change', loadVenues);
                    element.addEventListener('input', loadVenues);
                }
            });

            const influencerFilters = ['influencer-search', 'influencer-category', 'influencer-followers', 'influencer-platform', 'influencer-rate'];
            influencerFilters.forEach(filterId => {
                const element = document.getElementById(filterId);
                if (element) {
                    element.addEventListener('change', loadInfluencers);
                    element.addEventListener('input', loadInfluencers);
                }
            });
        });

        // Cleanup
        window.addEventListener('beforeunload', () => {
            if (qrScanner) {
                qrScanner.destroy();
            }
        });
    </script>
</body>
</html>