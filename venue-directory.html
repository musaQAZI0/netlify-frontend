<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Venue Directory - CROWD</title>
    <link rel="stylesheet" href="venue-directory-styles.css">
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .loading {
            animation: fadeIn 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="venue-directory-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="#f05537">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                    <span>crowd</span>
                    <span class="directory-badge">Venue Directory</span>
                </div>
                <div class="header-right">
                    <button class="back-btn" onclick="goBack()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M15 18l-6-6 6-6"/>
                        </svg>
                        Back
                    </button>
                    <button class="add-venue-btn" onclick="addVenue()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <line x1="12" x2="12" y1="5" y2="19"/>
                            <line x1="5" x2="19" y1="12" y2="12"/>
                        </svg>
                        Add Venue
                    </button>
                    <div class="user-menu">
                        <div class="user-avatar" id="userAvatar">U</div>
                        <span class="user-name" id="userName">Loading...</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Hero Section -->
            <div class="hero-section">
                <div class="hero-content">
                    <h1>Find the Perfect Venue</h1>
                    <p class="hero-subtitle">Discover amazing venues for your next event. From intimate spaces to grand ballrooms, find the perfect setting for your occasion.</p>

                    <!-- Quick Search -->
                    <div class="quick-search">
                        <div class="search-bar-large">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="m21 21-4.35-4.35"/>
                            </svg>
                            <input type="text" placeholder="Search venues by name, location, or type..." id="hero-search">
                            <button class="search-btn" onclick="performQuickSearch()">Search</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filters and View Toggle -->
            <div class="controls-section">
                <div class="filters-container">
                    <div class="filter-tabs">
                        <button class="filter-tab active" data-category="all" onclick="filterByCategory('all')">All Venues</button>
                        <button class="filter-tab" data-category="conference" onclick="filterByCategory('conference')">Conference Centers</button>
                        <button class="filter-tab" data-category="hotel" onclick="filterByCategory('hotel')">Hotels</button>
                        <button class="filter-tab" data-category="restaurant" onclick="filterByCategory('restaurant')">Restaurants</button>
                        <button class="filter-tab" data-category="outdoor" onclick="filterByCategory('outdoor')">Outdoor</button>
                        <button class="filter-tab" data-category="unique" onclick="filterByCategory('unique')">Unique Spaces</button>
                    </div>

                    <div class="advanced-filters">
                        <button class="filters-toggle" onclick="toggleAdvancedFilters()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <polygon points="22,3 2,3 10,12.46 10,19 14,21 14,12.46"/>
                            </svg>
                            Filters
                            <span class="filter-count" id="filter-count" style="display: none;">0</span>
                        </button>

                        <div class="view-toggle">
                            <button class="view-btn active" data-view="grid" onclick="toggleView('grid')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <rect x="3" y="3" width="7" height="7"/>
                                    <rect x="14" y="3" width="7" height="7"/>
                                    <rect x="14" y="14" width="7" height="7"/>
                                    <rect x="3" y="14" width="7" height="7"/>
                                </svg>
                            </button>
                            <button class="view-btn" data-view="list" onclick="toggleView('list')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <line x1="8" x2="21" y1="6" y2="6"/>
                                    <line x1="8" x2="21" y1="12" y2="12"/>
                                    <line x1="8" x2="21" y1="18" y2="18"/>
                                    <line x1="3" x2="3.01" y1="6" y2="6"/>
                                    <line x1="3" x2="3.01" y1="12" y2="12"/>
                                    <line x1="3" x2="3.01" y1="18" y2="18"/>
                                </svg>
                            </button>
                            <button class="view-btn" data-view="map" onclick="toggleView('map')">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                    <circle cx="12" cy="10" r="3"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Advanced Filter Panel -->
                <div class="advanced-filter-panel" id="advanced-filters" style="display: none;">
                    <div class="filter-grid">
                        <div class="filter-group">
                            <label>Location</label>
                            <select id="location-filter">
                                <option value="">All Locations</option>
                                <option value="new-york">New York, NY</option>
                                <option value="los-angeles">Los Angeles, CA</option>
                                <option value="chicago">Chicago, IL</option>
                                <option value="miami">Miami, FL</option>
                                <option value="san-francisco">San Francisco, CA</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Capacity</label>
                            <select id="capacity-filter">
                                <option value="">Any Size</option>
                                <option value="0-25">1-25 guests</option>
                                <option value="25-50">25-50 guests</option>
                                <option value="50-100">50-100 guests</option>
                                <option value="100-200">100-200 guests</option>
                                <option value="200-500">200-500 guests</option>
                                <option value="500+">500+ guests</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Price Range</label>
                            <select id="price-filter">
                                <option value="">Any Price</option>
                                <option value="budget">Budget ($)</option>
                                <option value="moderate">Moderate ($$)</option>
                                <option value="upscale">Upscale ($$$)</option>
                                <option value="luxury">Luxury ($$$$)</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Amenities</label>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" value="wifi"> WiFi
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="parking"> Parking
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="catering"> Catering
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" value="av-equipment"> A/V Equipment
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="filter-actions">
                        <button class="clear-filters-btn" onclick="clearFilters()">Clear All</button>
                        <button class="apply-filters-btn" onclick="applyFilters()">Apply Filters</button>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div class="results-section">
                <div class="results-header">
                    <h2 id="results-title">All Venues</h2>
                    <div class="results-meta">
                        <span id="results-count">Loading...</span>
                        <div class="sort-dropdown">
                            <select id="sort-select" onchange="sortVenues()">
                                <option value="featured">Featured</option>
                                <option value="name">Name A-Z</option>
                                <option value="price-low">Price: Low to High</option>
                                <option value="price-high">Price: High to Low</option>
                                <option value="rating">Highest Rated</option>
                                <option value="capacity">Capacity</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Grid View -->
                <div class="venues-grid" id="venues-grid">
                    <!-- Venues will be populated here -->
                </div>

                <!-- List View -->
                <div class="venues-list" id="venues-list" style="display: none;">
                    <!-- List view venues will be populated here -->
                </div>

                <!-- Map View -->
                <div class="venues-map" id="venues-map" style="display: none;">
                    <div id="map-container" style="height: 600px; border-radius: 12px;"></div>
                </div>

                <!-- Loading State -->
                <div class="loading-state" id="loading-state" style="display: none;">
                    <div class="spinner"></div>
                    <p>Loading venues...</p>
                </div>

                <!-- Empty State -->
                <div class="empty-state" id="empty-state" style="display: none;">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="#94a3b8">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="m21 21-4.35-4.35"/>
                    </svg>
                    <h3>No venues found</h3>
                    <p>Try adjusting your filters or search terms.</p>
                    <button class="clear-search-btn" onclick="clearSearch()">Clear Search</button>
                </div>
            </div>

            <!-- Pagination -->
            <div class="pagination" id="pagination" style="display: none;">
                <button class="page-btn" id="prev-btn" onclick="previousPage()" disabled>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M15 18l-6-6 6-6"/>
                    </svg>
                    Previous
                </button>
                <div class="page-numbers" id="page-numbers">
                    <!-- Page numbers will be populated here -->
                </div>
                <button class="page-btn" id="next-btn" onclick="nextPage()">
                    Next
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M9 18l6-6-6-6"/>
                    </svg>
                </button>
            </div>
        </main>
    </div>

    <!-- Venue Detail Modal -->
    <div class="modal-overlay" id="venue-modal" style="display: none;" onclick="closeVenueModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3 id="modal-venue-name">Venue Name</h3>
                <button class="modal-close" onclick="closeVenueModal()">√ó</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Venue details will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            API_BASE_URL: window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
                ? 'http://localhost:3000'
                : 'https://crowd-backend-zxxp.onrender.com',
            TOKEN_KEY: 'authToken'
        };

        let currentView = 'grid';
        let currentCategory = 'all';
        let currentPage = 1;
        let venuesPerPage = 12;
        let allVenues = [];
        let filteredVenues = [];
        let map = null;

        // Sample venues data
        const sampleVenues = [
            {
                id: 1,
                name: "Grand Conference Center",
                location: "New York, NY",
                address: "123 Business Ave, New York, NY 10001",
                category: "conference",
                capacity: { min: 50, max: 500 },
                priceRange: "upscale",
                rating: 4.8,
                reviewCount: 127,
                description: "A premier conference center in the heart of Manhattan, perfect for corporate events and large gatherings.",
                amenities: ["wifi", "parking", "catering", "av-equipment"],
                images: ["https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=400&h=300&fit=crop"],
                coordinates: [40.7589, -73.9851],
                contact: {
                    phone: "(555) 123-4567",
                    email: "info@grandconference.com",
                    website: "www.grandconference.com"
                },
                featured: true
            },
            {
                id: 2,
                name: "Skyline Hotel & Suites",
                location: "Los Angeles, CA",
                address: "456 Sunset Blvd, Los Angeles, CA 90028",
                category: "hotel",
                capacity: { min: 25, max: 300 },
                priceRange: "luxury",
                rating: 4.6,
                reviewCount: 89,
                description: "Luxury hotel with stunning city views and elegant event spaces for weddings and corporate functions.",
                amenities: ["wifi", "parking", "catering"],
                images: ["https://images.unsplash.com/photo-1564501049412-61c2a3083791?w=400&h=300&fit=crop"],
                coordinates: [34.0522, -118.2437],
                contact: {
                    phone: "(555) 987-6543",
                    email: "events@skylinehotel.com",
                    website: "www.skylinehotel.com"
                },
                featured: true
            },
            {
                id: 3,
                name: "Riverside Gardens",
                location: "Miami, FL",
                address: "789 River Dr, Miami, FL 33101",
                category: "outdoor",
                capacity: { min: 20, max: 200 },
                priceRange: "moderate",
                rating: 4.9,
                reviewCount: 156,
                description: "Beautiful outdoor venue with waterfront views, perfect for weddings and social gatherings.",
                amenities: ["parking", "catering"],
                images: ["https://images.unsplash.com/photo-1519167758481-83f550bb49b3?w=400&h=300&fit=crop"],
                coordinates: [25.7617, -80.1918],
                contact: {
                    phone: "(555) 456-7890",
                    email: "book@riversidegardens.com",
                    website: "www.riversidegardens.com"
                },
                featured: false
            },
            // Add more sample venues...
        ];

        // Utility functions
        function sanitizeInput(input) {
            if (typeof input !== 'string') return input;
            return input.trim().replace(/[<>\"'&]/g, function(match) {
                const htmlEscapes = {
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#39;',
                    '&': '&amp;'
                };
                return htmlEscapes[match];
            });
        }

        async function makeApiRequest(url, options = {}) {
            try {
                const response = await fetch(url, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                return await response.json();
            } catch (error) {
                console.error('API Request failed:', error);
                throw error;
            }
        }

        function getAuthToken() {
            return localStorage.getItem(CONFIG.TOKEN_KEY) || '';
        }

        // Authentication and initialization
        async function checkAuthentication() {
            try {
                const token = getAuthToken();
                if (!token) return false;

                const data = await makeApiRequest(`${CONFIG.API_BASE_URL}/api/auth/verify`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                return data.success;
            } catch (error) {
                return false;
            }
        }

        async function loadUserData() {
            try {
                const data = await makeApiRequest(`${CONFIG.API_BASE_URL}/api/auth/profile`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${getAuthToken()}`
                    }
                });

                if (data.success && data.user) {
                    const user = data.user;
                    const firstName = sanitizeInput(user.firstName || '');
                    const lastName = sanitizeInput(user.lastName || '');
                    const initials = (firstName.charAt(0) + lastName.charAt(0)).toUpperCase() || 'U';
                    const fullName = `${firstName} ${lastName}`.trim() || 'User';

                    document.getElementById('userAvatar').textContent = initials;
                    document.getElementById('userName').textContent = fullName;
                }
            } catch (error) {
                console.error('Failed to load user data:', error);
            }
        }

        // Venue functions
        function loadVenues() {
            // Use sample data for now - replace with actual API call
            allVenues = sampleVenues;
            filteredVenues = [...allVenues];
            updateResultsCount();
            renderVenues();
        }

        function renderVenues() {
            const startIndex = (currentPage - 1) * venuesPerPage;
            const endIndex = startIndex + venuesPerPage;
            const venuesToShow = filteredVenues.slice(startIndex, endIndex);

            if (currentView === 'grid') {
                renderGridView(venuesToShow);
            } else if (currentView === 'list') {
                renderListView(venuesToShow);
            } else if (currentView === 'map') {
                renderMapView(filteredVenues);
            }

            updatePagination();
        }

        function renderGridView(venues) {
            const grid = document.getElementById('venues-grid');

            if (venues.length === 0) {
                showEmptyState();
                return;
            }

            hideEmptyState();

            grid.innerHTML = venues.map(venue => `
                <div class="venue-card" onclick="openVenueModal(${venue.id})">
                    <div class="venue-image" style="background-image: url('${venue.images[0]}')">
                        ${venue.featured ? '<div class="featured-badge">Featured</div>' : ''}
                        <div class="venue-price">${getPriceDisplay(venue.priceRange)}</div>
                    </div>
                    <div class="venue-content">
                        <h3 class="venue-name">${venue.name}</h3>
                        <p class="venue-location">üìç ${venue.location}</p>
                        <div class="venue-details">
                            <span class="venue-capacity">üë• ${venue.capacity.min}-${venue.capacity.max} guests</span>
                            <span class="venue-category">${getCategoryDisplay(venue.category)}</span>
                        </div>
                        <div class="venue-amenities">
                            ${venue.amenities.slice(0, 3).map(amenity => `<span class="amenity-tag">${getAmenityDisplay(amenity)}</span>`).join('')}
                            ${venue.amenities.length > 3 ? `<span class="amenity-more">+${venue.amenities.length - 3}</span>` : ''}
                        </div>
                        <div class="venue-footer">
                            <div class="venue-rating">
                                <span class="rating-stars">‚≠ê</span>
                                <span class="rating-score">${venue.rating}</span>
                                <span class="rating-count">(${venue.reviewCount})</span>
                            </div>
                            <button class="contact-venue-btn" onclick="event.stopPropagation(); contactVenue(${venue.id})">Contact</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderListView(venues) {
            const list = document.getElementById('venues-list');

            if (venues.length === 0) {
                showEmptyState();
                return;
            }

            hideEmptyState();

            list.innerHTML = venues.map(venue => `
                <div class="venue-list-item" onclick="openVenueModal(${venue.id})">
                    <div class="venue-list-image" style="background-image: url('${venue.images[0]}')">
                        ${venue.featured ? '<div class="featured-badge">Featured</div>' : ''}
                    </div>
                    <div class="venue-list-content">
                        <div class="venue-list-main">
                            <h3 class="venue-name">${venue.name}</h3>
                            <p class="venue-location">üìç ${venue.location}</p>
                            <p class="venue-description">${venue.description}</p>
                            <div class="venue-details">
                                <span class="venue-capacity">üë• ${venue.capacity.min}-${venue.capacity.max} guests</span>
                                <span class="venue-category">${getCategoryDisplay(venue.category)}</span>
                                <span class="venue-price">${getPriceDisplay(venue.priceRange)}</span>
                            </div>
                        </div>
                        <div class="venue-list-actions">
                            <div class="venue-rating">
                                <span class="rating-stars">‚≠ê</span>
                                <span class="rating-score">${venue.rating}</span>
                                <span class="rating-count">(${venue.reviewCount})</span>
                            </div>
                            <button class="contact-venue-btn" onclick="event.stopPropagation(); contactVenue(${venue.id})">Contact</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderMapView(venues) {
            if (!map) {
                initializeMap();
            }

            // Clear existing markers
            map.eachLayer(layer => {
                if (layer instanceof L.Marker) {
                    map.removeLayer(layer);
                }
            });

            // Add markers for venues
            venues.forEach(venue => {
                if (venue.coordinates) {
                    const marker = L.marker(venue.coordinates).addTo(map);
                    marker.bindPopup(`
                        <div class="map-popup">
                            <h4>${venue.name}</h4>
                            <p>${venue.location}</p>
                            <p>üë• ${venue.capacity.min}-${venue.capacity.max} guests</p>
                            <p>‚≠ê ${venue.rating} (${venue.reviewCount} reviews)</p>
                            <button onclick="openVenueModal(${venue.id})" class="popup-view-btn">View Details</button>
                        </div>
                    `);
                }
            });

            // Fit map to show all markers
            if (venues.length > 0) {
                const group = new L.featureGroup(venues.filter(v => v.coordinates).map(v => L.marker(v.coordinates)));
                map.fitBounds(group.getBounds().pad(0.1));
            }
        }

        function initializeMap() {
            map = L.map('map-container').setView([39.8283, -98.5795], 4); // Center of US
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
        }

        // Filter and search functions
        function filterByCategory(category) {
            currentCategory = category;
            currentPage = 1;

            // Update tab states
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-category="${category}"]`).classList.add('active');

            applyFilters();
        }

        function applyFilters() {
            let filtered = [...allVenues];

            // Category filter
            if (currentCategory !== 'all') {
                filtered = filtered.filter(venue => venue.category === currentCategory);
            }

            // Location filter
            const locationFilter = document.getElementById('location-filter')?.value;
            if (locationFilter) {
                filtered = filtered.filter(venue => venue.location.toLowerCase().includes(locationFilter.toLowerCase()));
            }

            // Capacity filter
            const capacityFilter = document.getElementById('capacity-filter')?.value;
            if (capacityFilter) {
                const [min, max] = capacityFilter.split('-').map(n => parseInt(n.replace('+', '')) || Infinity);
                filtered = filtered.filter(venue => {
                    if (capacityFilter.includes('+')) {
                        return venue.capacity.max >= min;
                    }
                    return venue.capacity.max >= min && venue.capacity.min <= (max || min);
                });
            }

            // Price filter
            const priceFilter = document.getElementById('price-filter')?.value;
            if (priceFilter) {
                filtered = filtered.filter(venue => venue.priceRange === priceFilter);
            }

            // Amenities filter
            const selectedAmenities = Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.value);
            if (selectedAmenities.length > 0) {
                filtered = filtered.filter(venue =>
                    selectedAmenities.every(amenity => venue.amenities.includes(amenity))
                );
            }

            // Search filter
            const searchTerm = document.getElementById('hero-search')?.value.toLowerCase();
            if (searchTerm) {
                filtered = filtered.filter(venue =>
                    venue.name.toLowerCase().includes(searchTerm) ||
                    venue.location.toLowerCase().includes(searchTerm) ||
                    venue.description.toLowerCase().includes(searchTerm)
                );
            }

            filteredVenues = filtered;
            currentPage = 1;
            updateResultsCount();
            updateFilterCount();
            renderVenues();
        }

        function clearFilters() {
            // Reset all filter inputs
            document.getElementById('location-filter').value = '';
            document.getElementById('capacity-filter').value = '';
            document.getElementById('price-filter').value = '';
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.getElementById('hero-search').value = '';

            // Reset category to all
            currentCategory = 'all';
            document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector('[data-category="all"]').classList.add('active');

            applyFilters();
        }

        function sortVenues() {
            const sortBy = document.getElementById('sort-select').value;

            filteredVenues.sort((a, b) => {
                switch (sortBy) {
                    case 'name':
                        return a.name.localeCompare(b.name);
                    case 'price-low':
                        return getPriceValue(a.priceRange) - getPriceValue(b.priceRange);
                    case 'price-high':
                        return getPriceValue(b.priceRange) - getPriceValue(a.priceRange);
                    case 'rating':
                        return b.rating - a.rating;
                    case 'capacity':
                        return b.capacity.max - a.capacity.max;
                    case 'featured':
                    default:
                        return (b.featured ? 1 : 0) - (a.featured ? 1 : 0);
                }
            });

            renderVenues();
        }

        // Helper functions
        function getPriceDisplay(priceRange) {
            const prices = {
                'budget': '$',
                'moderate': '$$',
                'upscale': '$$$',
                'luxury': '$$$$'
            };
            return prices[priceRange] || '$$';
        }

        function getPriceValue(priceRange) {
            const values = {
                'budget': 1,
                'moderate': 2,
                'upscale': 3,
                'luxury': 4
            };
            return values[priceRange] || 2;
        }

        function getCategoryDisplay(category) {
            const categories = {
                'conference': 'Conference Center',
                'hotel': 'Hotel',
                'restaurant': 'Restaurant',
                'outdoor': 'Outdoor Space',
                'unique': 'Unique Space'
            };
            return categories[category] || category;
        }

        function getAmenityDisplay(amenity) {
            const amenities = {
                'wifi': 'WiFi',
                'parking': 'Parking',
                'catering': 'Catering',
                'av-equipment': 'A/V Equipment'
            };
            return amenities[amenity] || amenity;
        }

        function updateResultsCount() {
            document.getElementById('results-count').textContent = `${filteredVenues.length} venues found`;

            const title = currentCategory === 'all' ? 'All Venues' : getCategoryDisplay(currentCategory);
            document.getElementById('results-title').textContent = title;
        }

        function updateFilterCount() {
            const activeFilters = [
                document.getElementById('location-filter')?.value,
                document.getElementById('capacity-filter')?.value,
                document.getElementById('price-filter')?.value,
                ...Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(() => true),
                document.getElementById('hero-search')?.value
            ].filter(Boolean).length;

            const filterCount = document.getElementById('filter-count');
            if (activeFilters > 0) {
                filterCount.textContent = activeFilters;
                filterCount.style.display = 'inline';
            } else {
                filterCount.style.display = 'none';
            }
        }

        // View and UI functions
        function toggleView(view) {
            currentView = view;

            // Update view buttons
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-view="${view}"]`).classList.add('active');

            // Show/hide appropriate containers
            document.getElementById('venues-grid').style.display = view === 'grid' ? 'grid' : 'none';
            document.getElementById('venues-list').style.display = view === 'list' ? 'block' : 'none';
            document.getElementById('venues-map').style.display = view === 'map' ? 'block' : 'none';

            renderVenues();
        }

        function toggleAdvancedFilters() {
            const panel = document.getElementById('advanced-filters');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        function showEmptyState() {
            document.getElementById('empty-state').style.display = 'block';
        }

        function hideEmptyState() {
            document.getElementById('empty-state').style.display = 'none';
        }

        function showLoading() {
            document.getElementById('loading-state').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loading-state').style.display = 'none';
        }

        // Modal functions
        function openVenueModal(venueId) {
            const venue = allVenues.find(v => v.id === venueId);
            if (!venue) return;

            document.getElementById('modal-venue-name').textContent = venue.name;
            document.getElementById('modal-body').innerHTML = `
                <div class="modal-venue-details">
                    <div class="modal-image" style="background-image: url('${venue.images[0]}')"></div>
                    <div class="modal-info">
                        <div class="venue-header">
                            <h4>${venue.name}</h4>
                            <div class="venue-rating">
                                <span class="rating-stars">‚≠ê</span>
                                <span class="rating-score">${venue.rating}</span>
                                <span class="rating-count">(${venue.reviewCount} reviews)</span>
                            </div>
                        </div>
                        <p class="venue-address">üìç ${venue.address}</p>
                        <p class="venue-description">${venue.description}</p>

                        <div class="venue-specs">
                            <div class="spec-item">
                                <strong>Capacity:</strong> ${venue.capacity.min}-${venue.capacity.max} guests
                            </div>
                            <div class="spec-item">
                                <strong>Category:</strong> ${getCategoryDisplay(venue.category)}
                            </div>
                            <div class="spec-item">
                                <strong>Price Range:</strong> ${getPriceDisplay(venue.priceRange)}
                            </div>
                        </div>

                        <div class="venue-amenities-full">
                            <strong>Amenities:</strong>
                            <div class="amenities-list">
                                ${venue.amenities.map(amenity => `<span class="amenity-tag">${getAmenityDisplay(amenity)}</span>`).join('')}
                            </div>
                        </div>

                        <div class="venue-contact">
                            <strong>Contact Information:</strong>
                            <p>üìû ${venue.contact.phone}</p>
                            <p>‚úâÔ∏è ${venue.contact.email}</p>
                            <p>üåê ${venue.contact.website}</p>
                        </div>

                        <div class="modal-actions">
                            <button class="btn-primary" onclick="contactVenue(${venue.id})">Contact Venue</button>
                            <button class="btn-secondary" onclick="bookVenue(${venue.id})">Request Booking</button>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('venue-modal').style.display = 'flex';
        }

        function closeVenueModal() {
            document.getElementById('venue-modal').style.display = 'none';
        }

        // Action functions
        function contactVenue(venueId) {
            const venue = allVenues.find(v => v.id === venueId);
            if (venue) {
                window.open(`mailto:${venue.contact.email}?subject=Event Inquiry - ${venue.name}`);
            }
        }

        function bookVenue(venueId) {
            // Implement booking functionality
            alert('Booking functionality coming soon!');
        }

        function addVenue() {
            // Implement add venue functionality
            alert('Add venue functionality coming soon!');
        }

        function performQuickSearch() {
            applyFilters();
        }

        function clearSearch() {
            document.getElementById('hero-search').value = '';
            clearFilters();
        }

        // Pagination functions
        function updatePagination() {
            const totalPages = Math.ceil(filteredVenues.length / venuesPerPage);
            const pagination = document.getElementById('pagination');

            if (totalPages <= 1) {
                pagination.style.display = 'none';
                return;
            }

            pagination.style.display = 'flex';

            // Update prev/next buttons
            document.getElementById('prev-btn').disabled = currentPage === 1;
            document.getElementById('next-btn').disabled = currentPage === totalPages;

            // Update page numbers
            const pageNumbers = document.getElementById('page-numbers');
            let pages = '';

            for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) {
                pages += `<button class="page-number ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
            }

            pageNumbers.innerHTML = pages;
        }

        function goToPage(page) {
            currentPage = page;
            renderVenues();
        }

        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                renderVenues();
            }
        }

        function nextPage() {
            const totalPages = Math.ceil(filteredVenues.length / venuesPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                renderVenues();
            }
        }

        // Navigation
        function goBack() {
            window.history.back() || (window.location.href = 'overview-dashboard.html');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async function() {
            const isAuthenticated = await checkAuthentication();
            if (!isAuthenticated) {
                window.location.href = 'login.html';
                return;
            }

            await loadUserData();
            loadVenues();

            // Set up event listeners
            document.getElementById('hero-search').addEventListener('input', applyFilters);

            // Filter change listeners
            ['location-filter', 'capacity-filter', 'price-filter'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', applyFilters);
                }
            });

            // Amenity checkbox listeners
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', applyFilters);
            });
        });
    </script>
</body>
</html>