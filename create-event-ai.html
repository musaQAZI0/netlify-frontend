<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create an event with AI - Crowd</title>
    <link rel="stylesheet" href="create-event-ai-styles.css">
    <script src="js/data-manager.js"></script>
</head>
<body>
    <div class="create-event-container">
        <div class="logo">
            <img src="logo.jpg" alt="Crowd Logo" class="logo-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div style="display: none; align-items: center; gap: 0.25rem;">
                <span class="logo-icon">üéüÔ∏è</span>
                <span class="logo-text">crowd</span>
            </div>
        </div>

        <div class="form-container">
            <div class="form-header">
                <h1>Create an event with AI</h1>
                <p>Answer a few questions about your event and our AI creation tool will use internal data to build an event page. You can still <a href="#">create an event without AI</a>.</p>
            </div>

            <div id="errorMessage" class="error-message" style="display: none;"></div>
            <div id="successMessage" class="success-message" style="display: none;"></div>

            <form class="event-form" onsubmit="handleEventCreation(event)">
                <div class="form-group">
                    <label for="eventTitle">What's the name of your event?</label>
                    <p class="field-description">This will be your event's title. Your title will be used to help create your event's summary, description, category, and tags ‚Äì so be specific!</p>
                    <input type="text" id="eventTitle" placeholder="Event title" required>
                </div>

                <div class="form-group">
                    <label>When does your event start and end?</label>
                    <div class="datetime-fields">
                        <div class="date-field">
                            <label for="eventDate">Date</label>
                            <input type="date" id="eventDate" required>
                        </div>
                        <div class="time-field">
                            <label for="startTime">Start time</label>
                            <input type="time" id="startTime" value="10:00" required>
                        </div>
                        <div class="time-field">
                            <label for="endTime">End time</label>
                            <input type="time" id="endTime" value="12:00" required>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="eventLocation">Where is it located?</label>
                    <input type="text" id="eventLocation" placeholder="Enter location" required>
                </div>

                <div class="form-group">
                    <label>How much do you want to charge for tickets?</label>
                    <p class="field-description">Our tool can only generate one General Admission ticket for now. You can edit and add more ticket types later.</p>
                    <div class="price-field">
                        <input type="number" id="ticketPrice" placeholder="0.00" step="0.01" min="0">
                        <div class="free-toggle">
                            <input type="checkbox" id="freeTickets">
                            <label for="freeTickets">My tickets are free</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="eventCapacity">What's the capacity for your event?</label>
                    <p class="field-description">Event capacity is the total number of tickets you're willing to sell.</p>
                    <input type="number" id="eventCapacity" placeholder="0" min="1" required>
                </div>

                <div class="form-actions">
                    <button type="button" class="exit-btn" onclick="window.location.href='organizer-dashboard.html'">Exit</button>
                    <button type="submit" class="create-btn" id="createBtn">Create event</button>
                </div>
            </form>
        </div>
    </div>

    <style>
        .error-message {
            background: #fef2f2;
            color: #dc2626;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            border: 1px solid #fecaca;
            font-size: 14px;
        }

        .success-message {
            background: #f0fdf4;
            color: #166534;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            border: 1px solid #bbf7d0;
            font-size: 14px;
        }

        .create-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
    </style>

    <script>
        // Check authentication
        document.addEventListener('DOMContentLoaded', function() {
            if (!window.dataManager.isAuthenticated()) {
                window.location.href = 'login.html';
                return;
            }

            // Set default date to tomorrow
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('eventDate').value = tomorrow.toISOString().split('T')[0];
        });

        // Handle free tickets toggle
        document.getElementById('freeTickets').addEventListener('change', function() {
            const priceInput = document.getElementById('ticketPrice');
            if (this.checked) {
                priceInput.value = '0.00';
                priceInput.disabled = true;
            } else {
                priceInput.disabled = false;
            }
        });

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            
            const successDiv = document.getElementById('successMessage');
            successDiv.style.display = 'none';
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.style.display = 'none';
        }

        function hideMessages() {
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
        }

        async function handleEventCreation(event) {
            event.preventDefault();
            hideMessages();

            const title = document.getElementById('eventTitle').value.trim();
            const date = document.getElementById('eventDate').value;
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            const location = document.getElementById('eventLocation').value.trim();
            const ticketPrice = document.getElementById('freeTickets').checked ? 0 : parseFloat(document.getElementById('ticketPrice').value) || 0;
            const isFree = document.getElementById('freeTickets').checked;
            const capacity = parseInt(document.getElementById('eventCapacity').value);
            const createBtn = document.getElementById('createBtn');

            // Validation
            if (!title || !date || !location || !capacity) {
                showError('Please fill in all required fields.');
                return;
            }

            // Validate date is not in the past
            const eventDate = new Date(date);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            if (eventDate < today) {
                showError('Event date cannot be in the past.');
                return;
            }

            // Validate time
            if (startTime >= endTime) {
                showError('End time must be after start time.');
                return;
            }

            // Show loading state
            createBtn.textContent = 'Creating Event...';
            createBtn.disabled = true;
            document.querySelector('.event-form').classList.add('loading');

            try {
                // Create event data
                const eventData = {
                    title,
                    date,
                    startTime,
                    endTime,
                    location,
                    ticketPrice,
                    isFree,
                    capacity,
                    status: 'draft',
                    sold: 0,
                    gross: 0,
                    // AI-generated content based on title
                    description: `Join us for an exciting event: ${title}! This promises to be an unforgettable experience.`,
                    overviewDescription: `Welcome to ${title}! Join us for an exciting gathering that brings together like-minded individuals for an amazing experience.`,
                    whyAttend: `This event offers unique opportunities to connect, learn, and enjoy. Don't miss out on what promises to be an incredible experience.`,
                    howToParticipate: `Simply register for your tickets and join us at the specified time and location. We'll provide all the details you need closer to the event date.`,
                    closingMessage: `We look forward to seeing you at ${title}. It's going to be amazing!`
                };

                // Create event using data manager
                const createdEvent = window.dataManager.createEvent(eventData);
                
                showSuccess('Event created successfully! Redirecting to preview...');
                
                // Store for preview and redirect
                localStorage.setItem('editingEvent', JSON.stringify(createdEvent));
                
                setTimeout(() => {
                    window.location.href = 'event-preview.html';
                }, 1500);

            } catch (error) {
                console.error('Event creation error:', error);
                showError(error.message || 'Failed to create event. Please try again.');
            } finally {
                // Reset button state
                createBtn.textContent = 'Create event';
                createBtn.disabled = false;
                document.querySelector('.event-form').classList.remove('loading');
            }
        }
    </script>
</body>
</html>
