<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Google Places API</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-container {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            margin: 10px 0;
        }
        .results {
            background: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            min-height: 100px;
        }
        .error { color: #d32f2f; }
        .success { color: #388e3c; }
        .info { color: #1976d2; }
    </style>
</head>
<body>
    <h1>üó∫Ô∏è Google Places API Test</h1>
    
    <div class="test-container">
        <h2>API Status Check</h2>
        <div id="apiStatus" class="results">Checking API status...</div>
    </div>

    <div class="test-container">
        <h2>Autocomplete Test (USA Only)</h2>
        <p>Try searching for: "New York", "Los Angeles", "Chicago", "McDonald's"</p>
        <input type="text" id="testInput" placeholder="Search for places in USA...">
        <div id="testResults" class="results">Start typing above to see suggestions...</div>
    </div>

    <div class="test-container">
        <h2>Manual Service Test</h2>
        <button onclick="testAutocompleteService()">Test Autocomplete Service</button>
        <div id="serviceResults" class="results">Click test button above...</div>
    </div>

    <div class="test-container">
        <h2>Troubleshooting Guide</h2>
        <div id="troubleshooting">
            <h3>If autocomplete isn't working:</h3>
            <ol>
                <li><strong>Enable APIs in Google Cloud Console:</strong>
                    <ul>
                        <li>Go to <a href="https://console.cloud.google.com/">Google Cloud Console</a></li>
                        <li>APIs & Services ‚Üí Library</li>
                        <li>Enable "Places API" (legacy)</li>
                        <li>Enable "Places API (New)"</li>
                    </ul>
                </li>
                <li><strong>Check API Key Restrictions:</strong>
                    <ul>
                        <li>Go to Credentials in Google Cloud Console</li>
                        <li>Edit your API key</li>
                        <li>Under "Application restrictions" ‚Üí HTTP referrers</li>
                        <li>Add: <code>http://localhost:3000/*</code></li>
                    </ul>
                </li>
                <li><strong>Verify Billing:</strong>
                    <ul>
                        <li>Even though it's free, you may need billing enabled</li>
                        <li>Go to Billing in Google Cloud Console</li>
                    </ul>
                </li>
            </ol>
        </div>
    </div>

    <!-- Google Places API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAiq2Anse5vuEDCI3oKqD2iezo1MfoOiVk&libraries=places&loading=async&callback=initTest" async defer></script>

    <script>
        let autocomplete;

        function initTest() {
            const statusDiv = document.getElementById('apiStatus');
            const testInput = document.getElementById('testInput');
            const resultsDiv = document.getElementById('testResults');

            // Check API status
            if (window.google && window.google.maps && window.google.maps.places) {
                statusDiv.innerHTML = '<span class="success">‚úÖ Google Places API loaded successfully</span>';
                
                try {
                    // Initialize autocomplete
                    autocomplete = new google.maps.places.Autocomplete(testInput, {
                        types: ['establishment', 'geocode'],
                        componentRestrictions: { country: 'us' },
                        fields: ['place_id', 'name', 'formatted_address', 'address_components', 'geometry']
                    });

                    // Listen for place selection
                    autocomplete.addListener('place_changed', () => {
                        const place = autocomplete.getPlace();
                        if (place.geometry) {
                            resultsDiv.innerHTML = `
                                <span class="success">‚úÖ Place selected:</span><br>
                                <strong>Name:</strong> ${place.name || 'N/A'}<br>
                                <strong>Address:</strong> ${place.formatted_address}<br>
                                <strong>Place ID:</strong> ${place.place_id}<br>
                                <strong>Coordinates:</strong> ${place.geometry.location.lat()}, ${place.geometry.location.lng()}
                            `;
                        } else {
                            resultsDiv.innerHTML = '<span class="error">‚ùå No location data for this place</span>';
                        }
                    });

                    statusDiv.innerHTML += '<br><span class="success">‚úÖ Autocomplete initialized for USA only</span>';
                    
                } catch (error) {
                    statusDiv.innerHTML += `<br><span class="error">‚ùå Error initializing: ${error.message}</span>`;
                }
                
            } else {
                statusDiv.innerHTML = '<span class="error">‚ùå Google Places API not loaded</span>';
            }

            // Test input changes
            testInput.addEventListener('input', (e) => {
                if (e.target.value.length > 2) {
                    resultsDiv.innerHTML = `<span class="info">üîç Searching for: "${e.target.value}"</span>`;
                }
            });
        }

        function testAutocompleteService() {
            const serviceResults = document.getElementById('serviceResults');
            serviceResults.innerHTML = '<span class="info">üîÑ Testing autocomplete service...</span>';

            if (!window.google || !window.google.maps || !window.google.maps.places) {
                serviceResults.innerHTML = '<span class="error">‚ùå Google Places API not available</span>';
                return;
            }

            const service = new google.maps.places.AutocompleteService();
            
            // Test with multiple queries to ensure it works
            const testQueries = [
                'New York restaurant',
                'Los Angeles hotel',
                'McDonald\'s Chicago',
                'Starbucks'
            ];

            let testResults = '';
            let testsCompleted = 0;

            testQueries.forEach((query, index) => {
                service.getPlacePredictions({
                    input: query,
                    componentRestrictions: { country: 'us' },
                    types: ['establishment', 'geocode']
                }, (predictions, status) => {
                    testsCompleted++;
                    
                    if (status === google.maps.places.PlacesServiceStatus.OK && predictions) {
                        testResults += `
                            <div style="margin: 10px 0; padding: 10px; background: #e8f5e8; border: 1px solid #4caf50; border-radius: 4px;">
                                <strong>‚úÖ Test ${index + 1}: "${query}"</strong><br>
                                Found ${predictions.length} results:<br>
                                ${predictions.slice(0, 2).map(p => `‚Ä¢ ${p.description}`).join('<br>')}
                            </div>
                        `;
                    } else {
                        testResults += `
                            <div style="margin: 10px 0; padding: 10px; background: #ffebee; border: 1px solid #f44336; border-radius: 4px;">
                                <strong>‚ùå Test ${index + 1}: "${query}"</strong><br>
                                Status: ${status}<br>
                                Error: Service failed
                            </div>
                        `;
                    }

                    if (testsCompleted === testQueries.length) {
                        serviceResults.innerHTML = `
                            <h4>Autocomplete Service Test Results:</h4>
                            ${testResults}
                            <div style="margin-top: 15px; padding: 10px; background: #f0f0f0; border-radius: 4px;">
                                <strong>Next Steps:</strong><br>
                                ${testResults.includes('‚úÖ') ? 
                                    'üéâ API is working! If autocomplete widget isn\'t showing suggestions, try refreshing the page or clearing browser cache.' :
                                    '‚ö†Ô∏è Enable both "Places API" and "Places API (New)" in Google Cloud Console, then check API key restrictions.'
                                }
                            </div>
                        `;
                    }
                });
            });
        }

        // Error handling
        window.addEventListener('error', (e) => {
            console.error('Page error:', e.error);
        });
    </script>
</body>
</html>