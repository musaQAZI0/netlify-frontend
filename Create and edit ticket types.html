<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create and edit ticket types - CROWD Help Center</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
        }

        /* Header */
        .header {
            background: white;
            padding: 12px 20px;
            border-bottom: 1px solid #e6e6e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #d1410c;
        }

        .help-center-text {
            color: #666;
            font-size: 16px;
        }

        .search-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .search-bar {
            position: relative;
        }

        .search-input {
            padding: 8px 12px 8px 35px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 300px;
            font-size: 14px;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #333;
            font-size: 14px;
            position: relative;
        }

        /* Loading Spinner */
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #d1410c;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Logged-out state */
        .login-btn {
            background: #d1410c;
            color: white;
            padding: 8px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
            display: inline-block;
            transition: background-color 0.2s;
        }

        .login-btn:hover {
            background: #b8360a;
        }

        /* Logged-in state */
        .user-profile {
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .user-profile:hover {
            background: #f5f5f5;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #d1410c;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }

        .user-name {
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }

        .dropdown-arrow {
            font-size: 10px;
            color: #666;
            transition: transform 0.2s;
        }

        .user-profile.active .dropdown-arrow {
            transform: rotate(180deg);
        }

        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #e6e6e6;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            min-width: 160px;
            z-index: 1000;
            display: none;
        }

        .user-dropdown.show {
            display: block;
        }

        .dropdown-item {
            padding: 10px 15px;
            cursor: pointer;
            font-size: 14px;
            color: #333;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: #f5f5f5;
        }

        /* Hidden states */
        .logged-out-only {
            display: block;
        }

        .logged-in-only {
            display: none;
        }

        body.user-logged-in .logged-out-only {
            display: none;
        }

        body.user-logged-in .logged-in-only {
            display: flex;
        }

        /* Main Content */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .breadcrumb {
            margin-bottom: 20px;
        }

        .breadcrumb a {
            color: #d1410c;
            text-decoration: none;
            font-size: 14px;
        }

        .breadcrumb::before {
            content: "< ";
            color: #d1410c;
        }

        .main-title {
            font-size: 32px;
            font-weight: bold;
            color: #39364f;
            margin-bottom: 40px;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 40px;
        }

        /* Sidebar */
        .sidebar {
            background: transparent;
        }

        .sidebar-section {
            margin-bottom: 30px;
        }

        .sidebar-title {
            font-size: 16px;
            font-weight: 600;
            color: #39364f;
            margin-bottom: 15px;
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 0;
            color: #d1410c;
            text-decoration: none;
            font-size: 14px;
        }

        .sidebar-item:hover {
            color: #b8360a;
        }

        .sidebar-item.active {
            font-weight: 600;
        }

        .sidebar-icon {
            width: 16px;
            height: 16px;
        }

        /* Main Content Area */
        .main-content {
            background: white;
            padding: 40px;
            border-radius: 8px;
        }

        .content-section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 600;
            color: #39364f;
            margin-bottom: 20px;
        }

        .intro-text {
            margin-bottom: 30px;
            color: #555;
            font-size: 16px;
            line-height: 1.6;
        }

        .organizing-tag {
            background: #f0f0f0;
            color: #666;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            display: inline-block;
            margin-bottom: 20px;
        }

        .toc {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .toc h3 {
            margin-bottom: 16px;
            color: #39364f;
            font-size: 18px;
            font-weight: 600;
        }

        .toc ol {
            padding-left: 20px;
        }

        .toc li {
            margin-bottom: 8px;
        }

        .toc a {
            color: #d1410c;
            text-decoration: none;
        }

        .toc a:hover {
            text-decoration: underline;
        }

        .section h2 {
            font-size: 20px;
            margin-bottom: 16px;
            color: #39364f;
            font-weight: 600;
        }

        .section h3 {
            font-size: 18px;
            font-weight: 600;
            margin: 30px 0 15px 0;
            color: #333;
        }

        .section p {
            margin-bottom: 16px;
            color: #555;
            line-height: 1.6;
        }

        .highlight-box {
            background: #f8f9fa;
            border-left: 4px solid #4285f4;
            padding: 15px;
            margin: 20px 0;
        }

        .ticket-types {
            margin: 20px 0;
        }

        .ticket-type {
            margin-bottom: 15px;
        }

        .ticket-type strong {
            color: #333;
        }

        .field-list {
            margin: 20px 0;
        }

        .field-item {
            margin-bottom: 15px;
        }

        .field-name {
            font-weight: 600;
            color: #333;
        }

        /* Contact Section */
        .contact-section {
            text-align: center;
            margin: 60px 0;
            background: white;
            padding: 40px;
            border-radius: 8px;
        }

        .contact-title {
            font-size: 24px;
            font-weight: 600;
            color: #39364f;
            margin-bottom: 30px;
        }

        .contact-btn {
            background: #d1410c;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }

        .contact-btn:hover {
            background: #b8360a;
        }

        /* Footer */
        .footer {
            background: #39364f;
            color: white;
            padding: 40px 20px 20px;
            margin-top: 60px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 40px;
            margin-bottom: 30px;
        }

        .footer-section h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section li {
            margin-bottom: 8px;
        }

        .footer-section a {
            color: #ccc;
            text-decoration: none;
            font-size: 14px;
        }

        .footer-section a:hover {
            color: white;
        }

        .footer-bottom {
            max-width: 1200px;
            margin: 0 auto;
            padding-top: 20px;
            border-top: 1px solid #555;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #ccc;
        }

        .footer-links {
            display: flex;
            gap: 20px;
        }

        .country-selector {
            background: transparent;
            border: 1px solid #555;
            color: #ccc;
            padding: 5px 10px;
            border-radius: 4px;
        }

        .ask-question-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #d1410c;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(209, 65, 12, 0.3);
        }

        .ask-question-btn:hover {
            background: #b8360a;
        }

        @media (max-width: 768px) {
            .content-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .footer-content {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }
            
            .search-input {
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="logo-section">
            <div class="logo"><img src="logo.jpg" alt="Logo" style="height: 24px; width: auto; vertical-align: middle;"></div>
            <div class="help-center-text">Help Center</div>
        </div>
        <div class="search-section">
            <div class="search-bar">
                <span class="search-icon">🔍</span>
                <input type="text" class="search-input" placeholder="Search help articles">
            </div>
            <div class="user-section">
                <!-- Loading Spinner (shown during auth check) -->
                <div id="authLoading" class="loading-spinner"></div>

                <!-- Login Button (shown when not authenticated) -->
                <button id="loginBtn" class="login-btn" onclick="handleLogin()" style="display: none;">
                    Login
                </button>

                <!-- User Profile (shown when authenticated) -->
                <div id="userProfile" class="user-profile" onclick="toggleUserDropdown()" style="display: none;">
                    <div id="userAvatar" class="user-avatar">
                        <span id="userInitials">U</span>
                    </div>
                    <span id="userName">User</span>
                    <span>▼</span>

                    <!-- User Dropdown Menu -->
                    <div id="userDropdown" class="user-dropdown">
                        <a href="#" onclick="viewProfile()">View Profile</a>
                        <a href="#" onclick="accountSettings()">Account Settings</a>
                        <a href="#" onclick="organizerDashboard()">Organizer Dashboard</a>
                        <a href="#" onclick="handleLogout()">Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <div class="breadcrumb">
            <a href="../Help_center.html">Help Center</a>
        </div>

        <h1 class="main-title">Create and edit ticket types</h1>

        <div class="content-grid">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="sidebar-section">
                    <div class="sidebar-title">Organizing an event topics</div>
                    
                    <a href="#" class="sidebar-item">
                        <span class="sidebar-icon">📅</span>
                        Creating an event
                    </a>
                    
                    <a href="Add images and video to your event.html" class="sidebar-item">
                        <span class="sidebar-icon">🖼️</span>
                        Add images and video
                    </a>
                    
                    <a href="#" class="sidebar-item active">
                        <span class="sidebar-icon">🎫</span>
                        Create and edit ticket types
                    </a>
                    
                    <a href="Managing orders.html" class="sidebar-item">
                        <span class="sidebar-icon">📋</span>
                        Managing orders
                    </a>
                    
                    <a href="Issue a full or partial refund.html" class="sidebar-item">
                        <span class="sidebar-icon">💰</span>
                        Issue refunds
                    </a>
                    
                    <a href="#" class="sidebar-item">
                        <span class="sidebar-icon">📢</span>
                        Marketing an event
                    </a>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <div class="organizing-tag">Organizing an event</div>
                
                <p class="intro-text">
                    To create tickets for your event, go to <strong>Add tickets</strong> and select <strong>Add more tickets</strong>. You can make paid, free, and donation ticket types. If your tickets aren't available, review your ticket settings to confirm that your tickets are visible and on-sale. For reserved seating events, follow <a href="#" style="color: #d1410c; text-decoration: none;">these steps</a> instead to create a seating map and tickets.
                </p>

                <div class="toc">
                    <h3>In this article</h3>
                    <ol>
                        <li><a href="#creating-new">Creating new ticket types</a></li>
                        <li><a href="#updating-existing">Updating existing ticket types</a></li>
                        <li><a href="#troubleshooting">Troubleshooting issues with tickets</a></li>
                    </ol>
                </div>

                <div class="section" id="creating-new">
                    <h2>Creating new ticket types</h2>

                    <h3>1. Go to your event dashboard.</h3>
                    <p>Log in to your Crowd account and go to Events. Then select your event.</p>

                    <h3>2. Go to "Add tickets."</h3>
                    <p>If you haven't created tickets yet:</p>
                    <ul style="margin-left: 20px;">
                        <li>Choose to copy tickets or create new ones.</li>
                        <li>Optional: Create a section for your tickets.</li>
                    </ul>

                    <p>Copying tickets will copy all ticket types, add-ons, promo codes, and holds from the previous event. The sales dates on copied tickets are based on your new event's date and time. All other settings will be the same.</p>

                    <div class="highlight-box">
                        When you create an event with sections, each section will have its own section capacity. To create an event with sections, select <strong>Create section</strong> before you make your first ticket type. Tickets in one section won't affect the other sections, so one section can be sold out while other sections still have tickets available. The total capacity of your event will be the sum of each section.
                    </div>

                    <h3>3. Select "Add more tickets" and choose your ticket type.</h3>

                    <div class="ticket-types">
                        <p>There are three types of tickets:</p>
                        <div class="ticket-type">
                            <strong>Paid:</strong> The ticket costs a set amount.
                        </div>
                        <div class="ticket-type">
                            <strong>Free:</strong> The ticket doesn't cost anything.
                        </div>
                        <div class="ticket-type">
                            <strong>Donation:</strong> The buyer determines the price of this ticket.
                        </div>
                    </div>

                    <h3>4. Enter basic information for your ticket.</h3>

                    <div class="field-list">
                        <div class="field-item">
                            <span class="field-name">Name:</span> Name of the ticket type (like "General admission" or "Early bird").
                        </div>
                        <div class="field-item">
                            <span class="field-name">Available quantity:</span> The total number of tickets available for this ticket type.
                        </div>
                        <div class="field-item">
                            <span class="field-name">Price</span> (paid tickets only): The price of your tickets. Select <strong>How fees work</strong> to review your Ticketing Fees.
                        </div>
                        <div class="field-item">
                            <span class="field-name">Absorb fees</span> (optional): By default, Ticketing Fees are paid by the attendee. Select <strong>Absorb fees</strong> to pay for the Ticketing Fees from your ticket sales instead. Attendees will only pay the price you set.
                        </div>
                        <div class="field-item">
                            <span class="field-name">Sales dates:</span> The dates and times your tickets are on sale. Before your sales start date and after your sales end date, the tickets won't be available. You can also choose to have sales start after another ticket type is no longer available.
                        </div>
                    </div>

                    <p>If your event is a <a href="#" style="color: #d1410c; text-decoration: none;">recurring event</a>, you can't set a specific start or end date for ticket sales. Instead, you choose when to end sales relative to your event date and time. For example, you can end sales an hour or a day before your events start.</p>

                    <h3>5. Optional: Choose your advanced settings.</h3>
                    <p>Select <strong>Advanced settings</strong> to customize your ticket.</p>

                    <div class="field-list">
                        <div class="field-item">
                            <span class="field-name">Sales end date visibility:</span> By default, the sales end date of your tickets appears during checkout. Un-check "Show ticket sale end dates and sale status at checkout" to hide this.
                        </div>
                        <div class="field-item">
                            <span class="field-name">Description:</span> Add a description if you need to include more information about this ticket type.
                        </div>
                        <div class="field-item">
                            <span class="field-name">Visibility:</span> Choose to hide your ticket or keep it visible. Attendees can't register for a hidden ticket unless they have a <a href="#" style="color: #d1410c; text-decoration: none;">promotional code</a> that reveals it.
                        </div>
                        <div class="field-item">
                            <span class="field-name">Tickets per order:</span> The minimum and maximum amount of this ticket type purchasers can buy at once. Use this to create <a href="#" style="color: #d1410c; text-decoration: none;">group offers</a> or limit the amount of tickets per order.
                        </div>
                        <div class="field-item">
                            <span class="field-name">Sales channel:</span> Choose where attendees can buy this ticket type. If you change it to <strong>At the door only</strong>, these tickets are only available when you <a href="#" style="color: #d1410c; text-decoration: none;">sell them with the Crowd Organizer app</a>.
                        </div>
                        <div class="field-item">
                            <span class="field-name">Ticket Delivery Method:</span> Choose how attendees can receive their tickets. Attendees who choose <strong>eTicket</strong> will get the ticket on the Crowd app. If attendees choose <strong>Will Call</strong>, you'll need to <a href="#" style="color: #d1410c; text-decoration: none;">print out tickets</a> that they can pick up at the event.
                        </div>
                    </div>

                    <h3>6. Select "Save."</h3>

                    <h3>7. Customize your checkout settings.</h3>
                    <p>From <strong>Add tickets</strong>, go to <strong>Settings</strong>. There, you can:</p>

                    <ul style="margin-left: 20px;">
                        <li>Publicly display the number of tickets remaining.</li>
                        <li>Change to a "registration" event instead of a "ticketed" event. This will update the way Crowd refers to your event. Free events use registration language.</li>
                        <li>Enter a message to display after ticket sales end.</li>
                    </ul>
                </div>

                <div class="section" id="updating-existing">
                    <h2>Updating existing ticket types</h2>
                    <p>To update your tickets, go back to <strong>Add tickets</strong>. Select the three-dot icon next to your ticket type and choose from the following options:</p>

                    <div class="field-list">
                        <div class="field-item">
                            <span class="field-name">Edit:</span> change your ticket settings. Changing name or pricing settings will only apply to future sales.
                        </div>
                        <div class="field-item">
                            <span class="field-name">Copy:</span> create a new ticket type with the same settings.
                        </div>
                        <div class="field-item">
                            <span class="field-name">Delete:</span> remove the ticket type.
                        </div>
                    </div>

                    <p>You won't be able to delete a ticket type after it has had any sales (even ones that are cancelled or refunded).</p>
                </div>

                <div class="section" id="troubleshooting">
                    <h2>Troubleshooting issues with tickets</h2>
                    <p>If your tickets aren't on sale but should be, go back to <strong>Add tickets</strong> and select your ticket type. Check the following:</p>

                    <ul style="margin-left: 20px;">
                        <li>Check the sales dates for your tickets. If it's before your ticket sales start date or after your ticket sales end date, your tickets will be unavailable.</li>
                        <li>If your tickets are sold out, increase the <strong>Available quantity</strong> in your ticket settings. You may also need to <a href="#" style="color: #d1410c; text-decoration: none;">increase your event capacity</a>.</li>
                        <li>Confirm your tickets are visible (under <strong>Advanced settings</strong>). Hidden tickets require a <a href="#" style="color: #d1410c; text-decoration: none;">promotional code</a>.</li>
                        <li>Set the <strong>Sales channel</strong> to <strong>Everywhere</strong> or <strong>Online only</strong> (under <strong>Advanced settings</strong>). <strong>At the door only</strong> tickets won't appear in the online listing (but will appear when you <a href="#" style="color: #d1410c; text-decoration: none;">sell tickets with the Crowd Organizer app</a>).</li>
                    </ul>

                    <h3>Related articles</h3>
                    <div>
                        <a href="#" style="color: #d1410c; text-decoration: none;">Sell merchandise and other extras with add-ons</a><br>
                        <a href="#" style="color: #d1410c; text-decoration: none;">Change your event capacity</a><br>
                        <a href="#" style="color: #d1410c; text-decoration: none;">Create tickets in Crowd's new recurring event experience</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact Section -->
        <div class="contact-section">
            <h2 class="contact-title">Still have questions?</h2>
            <a href="#" class="contact-btn">Contact us</a>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Use CROWD</h3>
                <ul>
                    <li><a href="#">Create events</a></li>
                    <li><a href="#">Community Guidelines</a></li>
                    <li><a href="#">Pricing</a></li>
                    <li><a href="#">Pricing Calculator</a></li>
                    <li><a href="#">Site status</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Browse resources</h3>
                <ul>
                    <li><a href="#">Organizer Resource Hub</a></li>
                    <li><a href="#">Reconvene virtual sessions for organizers</a></li>
                    <li><a href="#">Taxes</a></li>
                    <li><a href="#">Webinars for new organizers</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Download apps</h3>
                <ul>
                    <li><a href="#">CROWD app for Android</a></li>
                    <li><a href="#">CROWD app for iOS</a></li>
                    <li><a href="#">CROWD Organizer app</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Connect with us</h3>
                <ul>
                    <li><a href="#">Contact support</a></li>
                    <li><a href="#">Facebook</a></li>
                    <li><a href="#">Instagram</a></li>
                    <li><a href="#">X</a></li>
                    <li><a href="#">TikTok</a></li>
                </ul>
            </div>
        </div>
        
        <div class="footer-bottom">
            <div>
                <span>© 2025 CROWD</span>
                <div class="footer-links">
                    <a href="#">About</a>
                    <a href="#">Blog</a>
                    <a href="#">Help</a>
                    <a href="#">Careers</a>
                    <a href="#">Press</a>
                    <a href="#">Security</a>
                    <a href="#">Developers</a>
                    <a href="#">Terms</a>
                    <a href="#">Privacy</a>
                    <a href="#">Accessibility</a>
                    <a href="#">Cookies</a>
                    <a href="#">Manage Cookie Preferences</a>
                </div>
            </div>
            <select class="country-selector">
                <option>United States</option>
            </select>
        </div>
    </div>

    <!-- Floating Ask Question Button -->
    <button class="ask-question-btn">
        💬 Ask a question
    </button>

    <script>
        // Authentication state management
        let isAuthenticated = false;
        let currentUser = null;

        // Initialize auth check on page load
        document.addEventListener('DOMContentLoaded', function () {
            checkAuthStatus();

            // Close dropdown when clicking outside
            document.addEventListener('click', function (event) {
                const userProfile = document.getElementById('userProfile');
                const userDropdown = document.getElementById('userDropdown');

                if (userProfile && userDropdown && !userProfile.contains(event.target) && !userDropdown.contains(event.target)) {
                    userDropdown.classList.remove('show');
                }
            });

            // Make sidebar items clickable
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.addEventListener('click', function (e) {
                    if (!this.href || this.href.includes('#')) {
                        e.preventDefault();
                    }
                    document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        });

        // Check authentication status
        async function checkAuthStatus() {
            try {
                showLoadingSpinner();

                // Get token from localStorage
                const token = localStorage.getItem('token') || localStorage.getItem('authToken');
                const headers = {
                    'Content-Type': 'application/json'
                };
                
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }

                const response = await fetch('/api/auth/check', {
                    method: 'GET',
                    credentials: 'include',
                    headers: headers
                });

                if (response.ok) {
                    const userData = await response.json();
                    if (userData.isAuthenticated && userData.user) {
                        setAuthenticatedState(userData.user);
                    } else {
                        setUnauthenticatedState();
                    }
                } else {
                    setUnauthenticatedState();
                }
            } catch (error) {
                console.error('Auth check failed:', error);
                setUnauthenticatedState();
            }
        }

        // Set authenticated state
        function setAuthenticatedState(user) {
            isAuthenticated = true;
            currentUser = user;

            // Update UI elements
            document.getElementById('authLoading').style.display = 'none';
            document.getElementById('loginBtn').style.display = 'none';
            document.getElementById('userProfile').style.display = 'flex';

            // Update user information
            const displayName = user.firstName && user.lastName 
                ? `${user.firstName} ${user.lastName}` 
                : user.firstName || user.lastName || user.email || 'User';
            
            document.getElementById('userName').textContent = displayName;

            // Generate initials from name or email
            const initials = generateInitials(displayName);
            document.getElementById('userInitials').textContent = initials;

            // Update avatar background color based on user ID or email
            const avatarColor = generateAvatarColor(user._id || user.email);
            document.getElementById('userAvatar').style.backgroundColor = avatarColor;
        }

        // Set unauthenticated state
        function setUnauthenticatedState() {
            isAuthenticated = false;
            currentUser = null;

            // Update UI elements
            document.getElementById('authLoading').style.display = 'none';
            document.getElementById('userProfile').style.display = 'none';
            document.getElementById('loginBtn').style.display = 'block';
        }

        // Show loading spinner
        function showLoadingSpinner() {
            document.getElementById('authLoading').style.display = 'block';
            document.getElementById('loginBtn').style.display = 'none';
            document.getElementById('userProfile').style.display = 'none';
        }

        // Generate initials from name
        function generateInitials(name) {
            if (!name) return 'U';

            const words = name.trim().split(' ');
            if (words.length === 1) {
                return words[0].charAt(0).toUpperCase();
            } else {
                return (words[0].charAt(0) + words[words.length - 1].charAt(0)).toUpperCase();
            }
        }

        // Generate avatar color based on user identifier
        function generateAvatarColor(identifier) {
            const colors = [
                '#4285f4', '#ea4335', '#34a853', '#fbbc05',
                '#ff6d01', '#9c27b0', '#00bcd4', '#ff5722',
                '#795548', '#607d8b', '#e91e63', '#3f51b5'
            ];

            if (!identifier) return colors[0];

            let hash = 0;
            for (let i = 0; i < identifier.length; i++) {
                hash = identifier.charCodeAt(i) + ((hash << 5) - hash);
            }

            return colors[Math.abs(hash) % colors.length];
        }

        // Handle login button click
        async function handleLogin() {
            try {
                window.location.href = '/login.html';
            } catch (error) {
                console.error('Login error:', error);
                alert('Login failed. Please try again.');
            }
        }

        // Handle logout
        async function handleLogout() {
            try {
                const token = localStorage.getItem('token') || localStorage.getItem('authToken');
                const headers = {
                    'Content-Type': 'application/json'
                };
                
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }

                const response = await fetch('/api/auth/logout', {
                    method: 'POST',
                    credentials: 'include',
                    headers: headers
                });

                // Clear tokens from localStorage
                localStorage.removeItem('token');
                localStorage.removeItem('authToken');
                localStorage.removeItem('currentUser');
                setUnauthenticatedState();
            } catch (error) {
                console.error('Logout error:', error);
                // Force logout on client side even if server request fails
                localStorage.removeItem('token');
                localStorage.removeItem('authToken');
                localStorage.removeItem('currentUser');
                setUnauthenticatedState();
            }

            // Close dropdown
            document.getElementById('userDropdown').classList.remove('show');
        }

        // Toggle user dropdown menu
        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }

        // User profile actions
        function viewProfile() {
            console.log('View profile clicked');
            window.location.href = '/profile';
            document.getElementById('userDropdown').classList.remove('show');
        }

        function accountSettings() {
            console.log('Account settings clicked');
            window.location.href = '/settings';
            document.getElementById('userDropdown').classList.remove('show');
        }

        function organizerDashboard() {
            console.log('Organizer dashboard clicked');
            window.location.href = '/organizer';
            document.getElementById('userDropdown').classList.remove('show');
        }

        // Optional: Refresh auth status periodically
        setInterval(checkAuthStatus, 5 * 60 * 1000); // Check every 5 minutes
    </script>
</body>
</html>